{"version":3,"sources":["web/i18n/provider.js","web/i18n/index.js","web/ducks/app.js","web/lib/settings.js","web/lib/sdmx/annotations.js","web/lib/sdmx/structure.js","web/lib/sdmx/dataflows.js","web/lib/sdmx/hierarchy.js","web/lib/sdmx/index.js","web/lib/utils/index.js","web/selectors/vis.js","web/selectors/sdmx.js","web/ducks/vis.js","web/selectors/app.js","web/api/formatMapper.js","web/api/formatMapper_istat.js","web/api/formatMapper_eurostat.js","web/lib/excel/index.js","web/api/sdmx.js","web/ducks/sdmx.js","web/core/reducer.js","web/core/middlewares.js","web/core/store.js","web/theme/theme.js","web/theme/index.js","web/components/Error.js","web/hocs/withResponsiveness.js","web/components/FilterPeriod/index.js","web/components/FilterSelection/index.js","web/components/Filters/index.js","web/components/Lastnobs/index.js","web/components/DataflowNavigator/index.js","web/components/NarrowFilters/index.js","web/lib/layout/index.js","web/selectors/table.js","web/components/TableConfig/TableConfig.js","web/components/TableConfig/index.js","web/components/Toolbar/menus.js","web/components/Toolbar/actions.js","web/components/Toolbar/index.js","web/components/Tools/Tools.js","web/components/Tools/index.js","web/components/FooterUnicef/index.js","web/components/Table/Cell.js","web/components/ToolbarUnicef/menus.js","web/components/ToolbarUnicef/actions.js","web/components/ToolbarUnicef/index.js","web/components/TableMessageUnicef/index.js","web/components/Table/Table.js","web/components/Table/index.js","web/components/Chart/index.js","web/components/Viewer/config.js","web/components/Map/MapSubfilterSummary.js","web/components/Map/MapFilterGroup.js","web/components/Map/Map.js","web/components/Map/MapHelpers.js","web/components/Map/index.js","web/components/Viewer/index.js","web/components/Footnotes/Footnotes.js","web/components/Footnotes/index.js","web/components/Main/Main.js","web/components/Main/index.js","web/components/HierarchicalCodelist/index.js","web/components/App/App.js","web/components/App/index.js","web/index.js","web/assets/data-explorer-logo.png"],"names":["Provider","_ref","localeId","messages","children","react_default","a","createElement","index_es","locale","key","React","Children","only","model","concat","setPending","id","is","type","payload","sdmx","R","window","SETTINGS","getDatasource","sdmxRange","sdmxPeriod","sdmxPeriodBoundaries","sdmxPeriodBoundariesMinMax","min","max","getSdmxAttribute","Array","chart","chartOptions","getIndicatorProfileUrl","getIndicatorCodelistID","getHideTotalLabel","getRoundData","showDataflowNavigator","getStickyDims","getDataflowsOnEvidence","_getMapSettings","df","DATAFLOW","agencyId","dataflowId","map","getMapRefAreaDimId","mapSettings","ref_area_dim_id","isValidNumber","Number","NaN","getIsSelected","index","annotations","selection","Boolean","md5","sdmx_structure","structure","lang","dimensions","conceptSchemes","dataflow","data","codelists","getCodelists","getLocalisedName","getDataflow","agencyID","rest","Object","objectWithoutProperties","objectSpread","code","name","acc","dimension","getConceptIdentity","conceptIdentity","getUrnToParse","conceptIdentityUrnToParse","conceptIdentityRepresentationCode","conceptScheme","_ref2","version","getSdmxId","sdmxId","getConceptScheme","getConcepts","concepts","getConcept","concept","getId","forced","getForcedDims","getLocalRepresentation","localRepresentation","getLink","i","length","value","getCodeList","_ref3","codes","getSortedCodes","parsedDimension","roles","conceptRoles","values","_ref4","parent","_ref4$annotations","parentId","isDefaultSelected","label","link","localisedCodes","toConsumableArray","dataflowAnnotations","getDimensions","ref","dsds","dsdId","split","agency","v","slice","dsd","filter","el","ret","dataStructureComponents","dimensionList","forEach","push","sdmx_dataflows","dataflowsParser","dataflows","element","dataStructures","isFinal","getReferencedCodeLabel","refCodelist","codelistAliasRef","codeID","getCodesHierarchy","c","hierarchicalCodes","urnToStructureId","urn","structureID","sdmx_hierarchy","hierarchyParser","hierarchicalCodelists","refCodelists","includedCL","includedCodelists","k","hasOwnProperty","strId","cl","hierarchy","hierarchies","h","node","getHierarchy","getConfig","_ref5","configArgs","Error","_R$prop4","datasourceId","datasource","isStructure","keyword","identifiers","dataquery","url","getDataUrl","_ref6","requestArgs","period","params","qs","stringify","startPeriod","endPeriod","addQueryPrefix","getFilename","add_remove_filters","filterId","clickedValue","filterIndex","safeDataquery","dotSplitted","newDimensionQuery","includes","idx","indexOf","splice","join","greaterThanOne","getDimensionsIds","d","rules","isTimeDimension","getUniq","array1","array2","withIndex","keysMap","obj","dimensionFormats","dimensionValueDisplay","both","getVis","getPeriod","createSelector","getLastnobservations","getViewer","getAction","getDisplay","getFilter","getDataquery","getIsFullscreen","getTimeDimensionInverted","getLayout","getDimensionGetter","getDimensionFormat","getHelpUrl","getDownloadFullEnabled","getSdmx","getData","getDataLimited","keys","dataSets","observations","limited","returnedKeyCount","limitedTo","getDataLimitedCount","getDataflows","getMap","getVisDataquery","getCustomAttributes","format","flagsSet","Set","attrs","memo","rattr","attr","isFootnote","has","flags","footnotes","getFilters","filters","valueIdsSet","getSelection","getCustomSort","struct","e","JSON","parse","console","log","CHANGE_LASTNOBS","CHANGE_DATAQUERY","LOAD_MAP","changeViewer","viewerId","changeAction","actionId","changeDataflow","changeLayout","layout","changeDataquery","valueId","dispatch","getState","getApp","getLocale","getPending","getIsPending","getIsRtl","addLinkAnnotation","cl_id","indicator_codelist_id","renameKey","object","oldKey","newKey","convertName2","map_struct_component","comp","mapStructure","s","m","node_catScheme","references","startsWith","x","getKeyStartsWith","items","n","toAdd","names","parents","add","size","getDimensionById","dims","updateIndex","dimval","__index","idxToString","createDataRow","header","section","datarow","curated","obs","attribs","hidx","secidx","valIdx","rowDimVals","row","dataStartIdx","rowAttribs","dr","h2","headerIndex","sec","sectionIndex","valIndex","lev1","lev2","lev3","att","createFootnotes","changeCellStyle","cell","style","fill","pattern","fgColor","argb","isBold","bold","font","color","generateExcel","asyncToGenerator","regenerator_default","mark","_callee","timeDimensionInverted","excel_styles","sections","rows","lastAttribKey","obs_keys","timeDim","timeSort","timeSortInv","layout2","datakeys","_i","_Object$entries","curLay","rowLen","rowDimsLen","workbook","sheet","rnum","col_shift","r","buf","wrap","_context","prev","next","rowDim","rowDimValue","footnotesSection","observation","attributes","o","oidx","vidx","keyPosition","find","b","start","sort","entries","slicedToArray","getCuratedData","getSortedLayout","sectionsData","headerData","ExcelJS","Workbook","addWorksheet","addRow","getCell","sectionText","secHead","rowData","cellCount","note","f","xlsx","writeBuffer","sent","abrupt","stop","_x","_x2","_x3","apply","this","arguments","csvToArray","text","l","p","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","done","err","return","generateExcelLong","_callee2","parsed","_context2","_x4","sdmxMapperDataflows","sdmxMapperHierarchy","methods","getStructure","_R$prop3","getFusionConfig","qStringParams","detail","acceptParam","FUSION","Accept-Language","EUROSTAT","Accept","istat","addForcedDims","forcedDims","sdmxMapperStruct","meta","cs","links","fm_eurostat","fm_istat","axios","get","headers","then","structureParser","_getConfig","lastnobservations","sdmxMapperData","roundData","dataset","series","isNaN","parseFloat","toFixed","fm","dimensionAtObservation","v8Transformer","getDataFile","responseType","response","blob","Blob","FileSaver","saveAs","_ref7","_ref8","getDataflowsConfig","includeMetadata","_ref9","ag","config","getHierarchyUrl","getExcelDataFile","_getConfig3","yStart","yEnd","getExcelDataFileLong","accept","backendId","_ref10","main","_ref11","method","error","_ref12","_ref13","fn","HANDLE_DATA","CHANGE_MAP_FILTERS","request","ctx","pendingId","sdmxApi","res","catch","errorCode","statusCode","status","pushLog","requestData","shouldRequestStructure","Promise","resolve","requestStructure","dqParts","dimCodes","_loop","some","cleanDataQueryAgainstStructure","df_annot","title","trim","replace","layout_annotation_to_array","initialLayout","document","getElementById","dispatchEvent","CustomEvent","nodata","nolayout","requestDataFile","isDownloadAllData","combineReducers","app","state","action","new_filter_map_state","map_selection","currSel","findIndex","map_filters_state_helper","val","vis","isFullscreen","isTimeDimensionInverted","_ret","dimVals","linkedNodes","requestDataMiddleware","future","withLogger","middlewares","Colors","Formats","theme","rtl","createMuiTheme","overrides","MuiButton","textTransform","palette","primary","mainAlpha","light","dark","contrastText","secondary","hover","selected","active","typography","fontFamily","raisedButton","textColor","primaryTextColor","default","backgroundColor","configLabelBG","configLabelCol","appSize","appMinSize","itemMinSize","scopeListContainer","maxHeight","scopeList","divider","direction","useNextVariants","configLabel","fontSize","configButtonRegular","fontWeight","configButtonSelected","panelSummary","panelIcon","configInputs","alert","table","yBg","yBgHover","yBgActive","yFontHeader","yFont","zBg","zBgHover","zBgActive","zFontHeader","zFont","xBg","xBgHeader","xBgHover","xBgActive","xFontHeader","xFont","oFont","sBg","jss","create","plugins","jssPreset","generateClassName","createGenerateClassName","isRtl","JssProvider_default","styles","muiTheme","glamorous_esm","mergeDeepRight","mainTheme","ErrorBoundary","props","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","hasError","setState","build","isHome","logo","Component","Narrow","react_responsive_default","assign","query","Default","compose","connect","createStructuredSelector","changePeriod","withProps","titleLabel","tagLabel","periodBoundaries","options","labelStepSize","pure","DEFilterPeriod","changeFilters","clearAllLabel","blankLabel","noScroll","VXFiltersCurrent","Filter","VXScopeList","injectIntl","activePanelId","changeSelection","onChangeActivePanel","intl","optionsSpotlight","hasClearAll","mainPlaceholder","formatMessage","secondaryPlaceholder","spotlight","engine","spotlightScopeListEngine","placeholder","fields","vx.spotlight.field.label","accessor","isSelected","topElementComponent","VXSpotlight","parentProps","TopElementComponent","Lastnobs","className","checked","lastnobs","onChange","changeLastnobs","lastn","createLink","df_id","stickyDims","dq","dim","sel","elem","dim_selection","location","href","isOnEvidence","on_evidence","selItems","toSort","onEvidence","df_keys","df_key","dataflowsOnEvidence","actionText","indDim","ind","containsIndicators","NarrowFilters","isOpen","dateRangeIsOpen","_this2","toRender","onClick","components_Lastnobs","lastnobs_active","opacity","pointerEvents","FilterPeriod","isNarrow","FilterSelection","Filters","components_DataflowNavigator","defaultConcat","getValuesFlat","adjustment","notAvailableIds","withoutNotAvailableIds","pivot","defineProperty","prop","isInvalid","dimensionIds","layoutIds","hasInvalidIds","getDefaultLayout","many","getMissingIds","defaultLayout","ids","timeId","areaId","isAreaDimension","helper","omitIds","pickId","y","z","defaultLayoutBuilder","defaultMissingIds","getDataDimensions","getVisDataDimensions","one","getTableConfigDimensions","isOne","Layout","isTimePeriod","getVisTableConfigLayout","getVisLayout","structureDimensions","dataDimensions","Sdmx","visLayout","sdmxLayout","dimensionsIds","oneIds","missingIds","TableConfig","tableProps","noCollapse","dimensionGetter","changeGetter","changeIsTimeDimensionInverted","noPreview","labels","commit","cancel","column","time","asc","desc","help","dimensionGetters","menus","Toolbar_actions","changeActionId","actions","icon","filtersBtn","isDownloading","changeMenu","loadingActionId","selectedMenuId","selectedActionId","showLabel","DEVisualisationToolbar","Tools","isFilters","Fragment","Toolbar","isFull","noHeader","components_TableConfig","isChartConfig","FooterUnicef","showCopyrightSymbol","StyledCell","glamorous","div","width","height","padding","textAlign","isYLast","isXLast","borderTop","border","borderLeft","borderRight","borderBottom","Cell","renderObservation","variant","ToolbarUnicef_menus","ToolbarUnicef_actions","requestExcelDataFile","requestExcelDataFileLong","mapRefAreaDimId","mapAreasToPreselect","helpUrl","changeDataqueryMultipleUpdate","downloadFullEnabled","actionsTable","actionMap","actionHelp","open","actionsMap","areas","TableMessageUnicef","animationMillis","msgBoxId","addEventListener","remMessage","removeEventListener","setTimeout","onTransEnd","el2","display","classList","position","top","right","TableContainer","borderLeftWidth","borderRightWidth","marginTop","overflowX","Table","viewerConfig","itemFormatter","isNotATable","dotstatsuite_ui_header_lib_default","fonts","ToolbarUnicef","components_TableMessageUnicef","Table_Cell","transform","components_FooterUnicef","DETableCell","addUnitMultiplierToUnit","headerObj","uprs","newUprs","mult","doCustomSort","sortOrder","idx1","idx2","format_data","customSort","rowItem","clItem","customAttributes","idsNotInMany","getTableData","mapProps","chartData","observationGetter","Chart","owner","footer_visible","subtitle","tooltip","axisLegend","chartLegend","footer","copyright","source","MapSubfilterSummary","selItem","item","MapFilterGroup","Map_MapSubfilterSummary","onValueChange","TIME_PERIOD_ID","map_styles","poly_disabled","weight","fillOpacity","poly_highlight","mapColors","Map","filteredVals","obs_val_count","updateSel","newsel","changeFilter","getValue","refarea","latest_datapoints","getFilteredVals","vals","onEachLayer","layer","feature","properties","ISO3_CODE","obs_val","scaledOpacity","getColorBucket","oldStyle","setStyle","highlighFeature","target","L","Browser","ie","opera","edge","bringToFront","infobox","update","resetHighlight","calculated_style","zoomToFeature","fitBounds","getBounds","onEachFeature","on","steps","_createLegendHTML","step1","step2","Math","round","createLegend","DomUtil","innerHTML","center","attributionControl","countryLayer","geoJSON","shape","addTo","control","legend","onAdd","_div","dim_sel","NAME_ENGL","eachLayer","invalidateSize","valMin","MAX_VALUE","valMax","MIN_VALUE","valRange","toCompare","step","show","Map_MapFilterGroup","refAreaDimId","latest","time_dim_keyPosition","time_dim_values","time_key_priority","new_keys","key_id","recent_time_key","time_score","_i2","getkey","obs_val_attribs","_i3","_Object$entries2","getLatestDatapoints","components_Map_Map","branch","renderComponent","message","MapWrapper","Footnotes","List_default","dense","ListItem_default","ListItemText_default","Main","enhancedData","isLoadingData","formaterIds","dataUrl","dotstatsuite_components_lib","sdmxUrl","render","loadingLabel","isLarge","Viewer","components_Footnotes","decimals","prefscale","HierarchicalCodelist","onChangeIsOpen","handleNodeExpand","nodeData","isExpanded","expandedNodes","handleNodeCollapse","newExpanded","handleNodeClick","expandNodes","toExpand","childNodes","hierarchyName","isCollapsible","tree","contents","onNodeExpand","onNodeCollapse","onNodeClick","createTreeContents","selCodes","codesInCodelist","hi","createTreeNode","hierarchyNode","depth","isSelCode","selCodeParent","selCodeCount","ch","secondaryLabel","App","isLoadingStructure","components_NarrowFilters","components_HierarchicalCodelist","components_Main","_React$Component","_temp","_getPrototypeOf2","_len","args","_key","react","withResponsiveness_Narrow","withResponsiveness_Default","inherits","renderNothing","ES6_Error","info","_ref$locales","locales","_ref$localeId","addLocaleData","enLocaleData","itLocaleData","numeral","delimiters","register","initializeI18n","i18n","lnobs","initialState","logs","pending","viewer","TIME_PERIOD","timeDimensionOrder","store","rootReducer","thunk","enhancers","applyMiddleware","createStore","reducer","unicef","mapUrl","map_dataflow_id","geojson_url","loadHierarchy","ROOT","event","components_Error","es","web_theme","provider","I18N","components_App","module","exports","__webpack_require__"],"mappings":"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","file":"static/js/main.chunk.js","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { IntlProvider } from 'react-intl';\r\n\r\nconst Provider = ({ localeId, messages, children }) => (\r\n  <IntlProvider locale={localeId} key={localeId} messages={messages[localeId]}>\r\n    {React.Children.only(children)}\r\n  </IntlProvider>\r\n);\r\n\r\nProvider.propTypes = {\r\n  localeId: PropTypes.string,\r\n  messages: PropTypes.object,\r\n  children: PropTypes.element.isRequired,\r\n};\r\n\r\nexport default Provider;\r\n","import numeral from 'numeral';\r\nimport * as R from 'ramda';\r\nimport { addLocaleData } from 'react-intl';\r\nimport enLocaleData from 'react-intl/locale-data/en';\r\nimport itLocaleData from 'react-intl/locale-data/it';\r\n\r\nconst model = locale => `${locale}/${locale}`;\r\n\r\nexport const setLocale = locale => numeral.locale(model(locale));\r\n\r\nexport const initialize = ({ locales = [], localeId = 'en' }) => {\r\n  addLocaleData(enLocaleData);\r\n  addLocaleData(itLocaleData);\r\n\r\n  setLocale(localeId);\r\n\r\n  R.forEach(locale => {\r\n    const delimiters = R.prop('delimiters')(locale);\r\n    if (R.isNil(delimiters)) return;\r\n    numeral.register('locale', model(R.prop('id')(locale)), { delimiters });\r\n  }, R.values(locales));\r\n};\r\n\r\nexport { default as I18nProvider } from './provider';\r\n","import * as R from 'ramda';\r\n\r\n//-----------------------------------------------------------------------------------------constants\r\nexport const LOG_ERROR = '@@app/LOG_ERROR';\r\nexport const PUSH_LOG = '@@app/PUSH_LOG';\r\nexport const SET_PENDING = '@@app/SET_PENDING';\r\n\r\n//------------------------------------------------------------------------------------------creators\r\nexport const pushLog = log => ({ type: PUSH_LOG, payload: { log } });\r\nexport const setPending = (id, is) => ({ type: SET_PENDING, payload: { id, is } });\r\n\r\n//-------------------------------------------------------------------------------------------reducer\r\nexport default (state = {}, action = {}) => {\r\n  switch (action.type) {\r\n    case PUSH_LOG:\r\n      return R.over(R.lensProp('logs'), R.prepend(action.payload.log), state);\r\n    case SET_PENDING:\r\n      return R.assocPath(['pending', action.payload.id], action.payload.is, state);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import * as R from 'ramda';\r\n\r\nexport const sdmx = R.propOr({}, 'sdmx', window.SETTINGS);\r\nexport const getDatasource = R.flip(R.prop)(R.prop('datasources', sdmx));\r\nexport const sdmxRange = R.prop('range', sdmx);\r\nexport const sdmxPeriod = R.path(['period', 'default'], sdmx);\r\nexport const sdmxPeriodBoundaries = R.pathOr([], ['period', 'boundaries'], sdmx);\r\nexport const sdmxPeriodBoundariesMinMax = {\r\n  min: R.head(sdmxPeriodBoundaries),\r\n  max: R.last(sdmxPeriodBoundaries),\r\n};\r\nexport const getSdmxAttribute = id =>\r\n  R.pipe(R.pathOr([], ['attributes', id]), R.ifElse(R.is(Array), R.identity, R.flip(R.append)([])))(\r\n    sdmx,\r\n  );\r\nexport const chart = R.propOr({}, 'chart', window.SETTINGS);\r\nexport const chartOptions = R.prop('options', chart);\r\n\r\nexport const getIndicatorProfileUrl = R.path(['unicef', 'indicatorProfileUrl'], window.SETTINGS);\r\nexport const getIndicatorCodelistID = R.path(['unicef', 'indicatorCodelistID'], window.SETTINGS);\r\n//export const getHelpUrl = R.path(['unicef', 'helpUrl'], window.SETTINGS);\r\nexport const getHelpUrl = R.path(['helpUrl'], window.SETTINGS);\r\nexport const getHideTotalLabel = R.path(['unicef', 'hideTotalLabel'], window.SETTINGS);\r\nexport const getRoundData = R.path(['unicef', 'roundData'], window.SETTINGS);\r\n\r\nexport const showDataflowNavigator = R.pathOr(\r\n  0,\r\n  ['unicef', 'showDataflowNavigator'],\r\n  window.SETTINGS,\r\n);\r\nexport const getStickyDims = R.pathOr([], ['unicef', 'stickyDims'], window.SETTINGS);\r\nexport const getDataflowsOnEvidence = R.pathOr(\r\n  [],\r\n  ['unicef', 'dataflowsOnEvidence'],\r\n  window.SETTINGS,\r\n);\r\n\r\nconst _getMapSettings = () => {\r\n  let df = window.DATAFLOW.agencyId + ':' + window.DATAFLOW.dataflowId;\r\n  if (window.SETTINGS.map && window.SETTINGS.map[df]) return window.SETTINGS.map[df];\r\n  return null;\r\n};\r\n\r\nexport const getMapRefAreaDimId = () => {\r\n  const mapSettings = _getMapSettings();\r\n  if (mapSettings == null) return null;\r\n  return mapSettings.ref_area_dim_id;\r\n};\r\n\r\nexport const getMapAreasToPreselect = () => {\r\n  const mapSettings = _getMapSettings();\r\n  if (mapSettings == null || mapSettings.areas == null) return null;\r\n  return mapSettings.areas;\r\n};\r\n","import * as R from 'ramda';\r\nimport md5 from 'md5';\r\n\r\nconst isValidNumber = R.both(R.is(Number), R.complement(R.equals(NaN)));\r\n\r\nexport const getIsSelected = ({ index, id, annotations, selection }) => {\r\n  if (R.or(R.isEmpty(selection), R.isNil(selection))) {\r\n    return R.ifElse(R.isEmpty, R.F, R.pipe(R.find(R.propEq('type', 'DEFAULT')), Boolean))(\r\n      annotations,\r\n    );\r\n  }\r\n  return !!R.prop(md5(`${index}${id}`))(selection);\r\n};\r\n\r\nexport const getSortedCodes = lang =>\r\n  R.sortBy(\r\n    R.pipe(\r\n      R.propOr([], 'annotations'),\r\n      R.find(R.propEq('type', 'ORDER')),\r\n      R.prop('text'),\r\n      R.propOr(0, lang),\r\n      Number,\r\n      R.ifElse(isValidNumber, R.identity, R.always(0)),\r\n    ),\r\n  );\r\n","import * as R from 'ramda';\r\nimport { getIsSelected, getSortedCodes } from './annotations';\r\n\r\nexport default structure => {\r\n  const lang = R.pipe(R.pathOr([], ['meta', 'content-languages']), R.head)(structure);\r\n\r\n  const dimensions = R.pipe(\r\n    R.pathOr([], ['data', 'dataStructures']),\r\n    R.head,\r\n    R.pathOr([], ['dataStructureComponents', 'dimensionList', 'dimensions']),\r\n  )(structure);\r\n  const conceptSchemes = R.pathOr([], ['data', 'conceptSchemes'])(structure);\r\n\r\n  if (R.any(R.anyPass([R.isNil, R.isEmpty]))([lang, dimensions, conceptSchemes])) {\r\n    return { dimensions: [], dataflow: {} };\r\n  }\r\n\r\n  const getCodelists = R.pathOr([], ['data', 'codelists']);\r\n  const codelists = getCodelists(structure);\r\n\r\n  /*const getLocalisedName = id =>\r\n    R.pipe(R.pathOr('', ['name', lang]), R.ifElse(R.isEmpty, R.always(`[${id}]`), R.identity));*/\r\n\r\n  const getLocalisedName = id =>\r\n    R.pipe(R.pathOr('', ['name', lang]), R.ifElse(R.isEmpty, R.always(`[${id}]`), R.identity));\r\n\r\n  const getDataflow = R.pipe(\r\n    R.pathOr([], ['data', 'dataflows']),\r\n    R.head,\r\n    R.pick(['id', 'version', 'agencyID', 'name']),\r\n    ({ id, agencyID, ...rest }) => ({\r\n      ...rest,\r\n      code: id,\r\n      agencyId: agencyID,\r\n      name: getLocalisedName(id)(rest),\r\n    }),\r\n  );\r\n\r\n  const getDataflowAnnotations = data => {\r\n    return R.pathOr([], ['data', 'dataflows', 0, 'annotations'])(data);\r\n  };\r\n\r\n  const filters = R.addIndex(R.reduce)(\r\n    (acc, dimension, index) => {\r\n      const getConceptIdentity = R.propOr(null, 'conceptIdentity');\r\n      if (R.isNil(getConceptIdentity(dimension))) return acc;\r\n      const conceptIdentity = getConceptIdentity(dimension);\r\n\r\n      const getUrnToParse = R.match(/[^urn:sdmx:org.sdmx.infomodel][^.|=]+/g);\r\n      if (R.isEmpty(getUrnToParse(conceptIdentity))) return acc;\r\n      const conceptIdentityUrnToParse = getUrnToParse(conceptIdentity);\r\n      const conceptIdentityRepresentationCode = R.last(conceptIdentityUrnToParse);\r\n\r\n      const getConceptScheme = R.find(({ agencyID, id, version }) => {\r\n        const getSdmxId = R.match(/=(.*\\))/);\r\n        const sdmxId = R.tail(R.head(getSdmxId(conceptIdentity)));\r\n        const sdmxIdRecomposed = `${agencyID}:${id}(${version})`;\r\n        return sdmxIdRecomposed === sdmxId;\r\n      });\r\n      const conceptScheme = getConceptScheme(conceptSchemes);\r\n      const getConcepts = R.propOr(null, 'concepts');\r\n      if (R.isNil(getConcepts(conceptScheme))) return acc;\r\n      const concepts = getConcepts(conceptScheme);\r\n\r\n      const getConcept = R.find(R.propEq('id', conceptIdentityRepresentationCode));\r\n      if (R.isNil(getConcept(concepts))) return acc;\r\n      const concept = getConcept(concepts);\r\n\r\n      const getId = R.propOr(null, 'id');\r\n      if (R.isNil(getId(dimension))) return acc;\r\n      const id = getId(dimension);\r\n\r\n      const getForcedDims = R.propOr(null, 'forced');\r\n      const forced = getForcedDims(dimension);\r\n\r\n      // ---------------------------------------------------------------------------------------------\r\n      //                                  values [ ]\r\n      // ---------------------------------------------------------------------------------------------\r\n\r\n      const getLocalRepresentation = R.pathOr(null, ['localRepresentation', 'enumeration']);\r\n      if (R.isNil(getLocalRepresentation(dimension))) return [];\r\n\r\n      const localRepresentation = getLocalRepresentation(dimension);\r\n\r\n      const type = R.nth(1)(getUrnToParse(localRepresentation));\r\n\r\n      const getLink = annotations => {\r\n        if (R.isNil(annotations)) return null;\r\n        for (let i = 0; i < annotations.length; i++) {\r\n          if (annotations[i].type == 'link') {\r\n            return annotations[i].value;\r\n          }\r\n        }\r\n        return null;\r\n      };\r\n\r\n      const getCodeList = R.find(({ agencyID, id, version }) => {\r\n        const getSdmxId = R.match(/=(.*\\))/);\r\n        const sdmxId = R.tail(R.head(getSdmxId(localRepresentation)));\r\n        const sdmxIdRecomposed = `${agencyID}:${id}(${version})`;\r\n        return sdmxIdRecomposed === sdmxId && type === 'Codelist';\r\n      });\r\n\r\n      if (R.isEmpty(codelists) || R.isEmpty(R.propOr([], 'codes')(getCodeList(codelists)))) {\r\n        return acc;\r\n      }\r\n      const codes = getSortedCodes(lang)(R.propOr([], 'codes')(getCodeList(codelists)));\r\n\r\n      const localisedCodes = index =>\r\n        R.map(({ id, parent, name, annotations = [] }) => ({\r\n          id,\r\n          parentId: parent,\r\n          isDefaultSelected: getIsSelected({ index, id, annotations }),\r\n          //isDefaultSelected: id === 'DSB_STATUS_TOTAL' || id === 'SEX_T',\r\n          label: getLocalisedName(id)({ name }),\r\n          link: getLink(annotations),\r\n        }));\r\n\r\n      const parsedDimension = {\r\n        id,\r\n        index,\r\n        roles: !R.isNil(dimension.conceptRoles) ? dimension.conceptRoles : [],\r\n        values: localisedCodes(index)(codes),\r\n        forced,\r\n      };\r\n\r\n      return [\r\n        ...acc,\r\n        {\r\n          ...parsedDimension,\r\n          label: getLocalisedName(parsedDimension.id)(concept),\r\n        },\r\n      ];\r\n    },\r\n    [],\r\n    dimensions,\r\n  );\r\n  return {\r\n    dimensions: filters,\r\n    dataflow: getDataflow(structure),\r\n    dataflowAnnotations: getDataflowAnnotations(structure),\r\n  };\r\n};\r\n","//The lang is requested to the SDMX registry in the GET request.\r\n//The sdmx registry returns a node with the requesnted lang (defaults to en if missing).\r\n//Just get the value of the first returned node\r\nconst getLocalisedName = node => {\r\n  if (!node || node.length == 0) return '';\r\n  return node[0].value;\r\n};\r\n\r\nconst getAnyNode = (node, alt) => {\r\n  if (!node || !alt) return null;\r\n  for (let i = 0; i < alt.length; i++) {\r\n    if (node.hasOwnProperty(alt[i])) return node[alt[i]];\r\n  }\r\n  return null;\r\n};\r\n\r\nconst getDimensions = (ref, dsds) => {\r\n  //\"dataStructureRef\": \"urn:sdmx:org.sdmx.infomodel.datastructure.DataStructure=UNESCO:EDU_NON_FINANCE(3.0)\"\r\n\r\n  //Could use a regex but it seems that Firefox doesn't support lookbehind\r\n  const dsdId = ref.split('=')[1];\r\n  const agency = dsdId.split(':')[0]; //Split and take agency\r\n  const id = dsdId.split(':')[1].split('(')[0]; //Split and take Dataflow\r\n  const v = dsdId\r\n    .split(':')[1]\r\n    .split('(')[1]\r\n    .slice(0, -1); //split and take version\r\n\r\n  //Get the DSD matching the agency, dsd and version\r\n  const dsd = dsds.filter(el => {\r\n    return el.agencyID == agency && el.id == id && el.version == v;\r\n  })[0];\r\n\r\n  if (!dsd) return null;\r\n  const ret = [];\r\n  dsd.dataStructureComponents.dimensionList.dimensions.forEach(el => {\r\n    //the urn is urn:sdmx:org.sdmx.infomodel.datastructure.TimeDimension=UNICEF_TEST:DSD_DHIS_SAMPLE_2(1.0).TIME_PERIOD\r\n    //use the id in this case\r\n    ret.push(el.id);\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nconst getDataflow = (df, dsds) => {\r\n  return {\r\n    id: df.id,\r\n    name: df.name,\r\n    agencyID: df.agencyID,\r\n    version: df.version,\r\n    isFinal: df.isFinal,\r\n    dimensions: getDimensions(df.structure, dsds),\r\n  };\r\n};\r\n\r\nexport default dataflowsParser => {\r\n  const ret = {};\r\n  if (!dataflowsParser.data.data.dataflows) return ret;\r\n  dataflowsParser.data.data.dataflows.forEach(element => {\r\n    ret[element.id] = getDataflow(element, dataflowsParser.data.data.dataStructures);\r\n  });\r\n  return ret;\r\n};\r\n","const getReferencedCodeLabel = (code, refCodelist) => {\r\n  for (let i = 0; i < refCodelist[code.codelistAliasRef].length; i++) {\r\n    if (refCodelist[code.codelistAliasRef][i].id == code.codeID) {\r\n      return refCodelist[code.codelistAliasRef][i].name;\r\n    }\r\n  }\r\n};\r\n\r\nconst getCodesHierarchy = (codes, refCodelist) => {\r\n  const ret = [];\r\n  codes.forEach(c => {\r\n    let code = {\r\n      id: c.id,\r\n      codeID: c.codeID,\r\n      name: getReferencedCodeLabel(c, refCodelist),\r\n    };\r\n\r\n    if (c.hierarchicalCodes) {\r\n      code.codes = getCodesHierarchy(c.hierarchicalCodes, refCodelist);\r\n    }\r\n    ret.push(code);\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nconst getHierarchy = (hierarchy, refCodelist) => {\r\n  const ret = {\r\n    name: hierarchy.name,\r\n    hierarchies: [],\r\n  };\r\n\r\n  hierarchy.hierarchies.forEach(h => {\r\n    let node = {\r\n      id: h.id,\r\n      codeID: h.codeID,\r\n      name: h.name,\r\n      codes: getCodesHierarchy(h.hierarchicalCodes, refCodelist),\r\n    };\r\n    ret.hierarchies.push(node);\r\n  });\r\n  return ret;\r\n};\r\n\r\nconst urnToStructureId = urn => {\r\n  const structureID = urn.split('=')[1];\r\n  const ag = structureID.split(':')[0];\r\n  const id = structureID.split(':')[1].split('(')[0];\r\n  const ver = structureID\r\n    .split(':')[1]\r\n    .split('(')[1]\r\n    .split(')')[0];\r\n\r\n  return {\r\n    agencyID: ag,\r\n    id: id,\r\n    version: ver,\r\n  };\r\n};\r\n\r\nexport default hierarchyParser => {\r\n  const ret = {};\r\n  if (!hierarchyParser.data.hierarchicalCodelists) return ret;\r\n  if (hierarchyParser.data.hierarchicalCodelists.length == 0) return ret;\r\n\r\n  const refCodelists = {};\r\n  const includedCL = hierarchyParser.data.hierarchicalCodelists[0].includedCodelists;\r\n  for (var k in includedCL) {\r\n    if (includedCL.hasOwnProperty(k)) {\r\n      const strId = urnToStructureId(includedCL[k]);\r\n      hierarchyParser.data.codelists.forEach(cl => {\r\n        if (cl.agencyID == strId.agencyID && cl.id == strId.id && cl.version == strId.version) {\r\n          refCodelists[k] = cl.codes;\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  return getHierarchy(hierarchyParser.data.hierarchicalCodelists[0], refCodelists);\r\n};\r\n","import * as R from 'ramda';\r\nimport qs from 'qs';\r\nimport { getDatasource } from '../settings';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nexport { default as structureParser } from './structure';\r\nexport { default as dataflowsParser } from './dataflows';\r\nexport { default as hierarchyParser } from './hierarchy';\r\n\r\nexport const getDataflowsConfig = ({ configArgs }) => {\r\n  const { datasourceId } = R.prop('dataflow', configArgs);\r\n  const datasource = getDatasource(datasourceId);\r\n\r\n  return {\r\n    url: `${R.prop('url', datasource)}/dataflow/all/all/latest/`,\r\n    datasource,\r\n  };\r\n};\r\n\r\nexport const getHierarchyUrl = ({ configArgs }) => {\r\n  const { datasourceId } = R.prop('dataflow', configArgs);\r\n  const datasource = getDatasource(datasourceId);\r\n\r\n  let ag = configArgs.config.hierarchy.agencyId;\r\n  let id = configArgs.config.hierarchy.id;\r\n\r\n  return `${R.prop('url', datasource)}/hierarchicalcodelist/${ag}/${id}/latest/`;\r\n};\r\n\r\nexport const getFusionConfig = ({ configArgs }) => {\r\n  const { datasourceId, dataflowId, agencyId, version } = R.prop('dataflow', configArgs);\r\n\r\n  const datasource = getDatasource(datasourceId);\r\n  if (R.isNil(datasource)) throw new Error(`Datasource undefined: datasourceId=${datasourceId}`);\r\n\r\n  //const identifiers = R.join(',', [agencyId, dataflowId, R.defaultTo('latest', version)]);\r\n  const identifiers = R.join('/', [agencyId, dataflowId, R.defaultTo('latest', version)]);\r\n  return {\r\n    url: `${R.prop('url', datasource)}/dataflow/${identifiers}`,\r\n    datasource,\r\n  };\r\n\r\n  /*return {\r\n    url: `${R.prop('url', datasource)}/dataflow/${identifiers}`,\r\n    datasource,\r\n  };*/\r\n};\r\n\r\nexport const getConfig = ({ type }) => ({ configArgs }) => {\r\n  if (R.not(R.includes(type, ['structure', 'data']))) throw new Error(`Invalid type: type=${type}`);\r\n\r\n  const { datasourceId, dataflowId, agencyId, version } = R.prop('dataflow', configArgs);\r\n\r\n  const datasource = getDatasource(datasourceId);\r\n  if (R.isNil(datasource)) throw new Error(`Datasource undefined: datasourceId=${datasourceId}`);\r\n\r\n  const isStructure = R.equals(type, 'structure');\r\n\r\n  const keyword = isStructure ? 'dataflow' : 'data';\r\n\r\n  const identifiers = R.join(isStructure ? '/' : ',', [\r\n    agencyId,\r\n    dataflowId,\r\n    R.defaultTo('latest', version),\r\n  ]);\r\n\r\n  const dataquery = isStructure ? '' : `/${R.defaultTo('all', R.prop('dataquery', configArgs))}`;\r\n\r\n  return {\r\n    url: `${R.prop('url', datasource)}/${keyword}/${identifiers}${dataquery}`,\r\n    datasource,\r\n  };\r\n};\r\n\r\nexport const getDataUrl = ({ configArgs, requestArgs }) => {\r\n  const period = R.prop('period', requestArgs);\r\n  const url = R.prop('url', getConfig({ type: 'data' })({ configArgs }));\r\n  const params = qs.stringify(\r\n    { startPeriod: R.head(period), endPeriod: R.last(period) },\r\n    { addQueryPrefix: true },\r\n  );\r\n\r\n  return `${url}${params}`;\r\n};\r\n\r\nexport const getFilename = R.pipe(\r\n  R.converge(R.append, [\r\n    R.pipe(R.prop('dataquery'), R.ifElse(R.isNil, R.always('all'), R.identity)),\r\n    R.pipe(\r\n      R.prop('dataflow'),\r\n      R.pick(['datasourceId', 'dataflowId', 'agencyId', 'version']),\r\n      R.values,\r\n    ),\r\n  ]),\r\n  R.join('_'),\r\n);\r\n//The updateDataquery toggles filters, this function adds multiple codes to the dimension's filter\r\nexport const forceMultipleDataqueryUpdate = dimensions => (filterId, values) => dataquery => {\r\n  if (R.isNil(filterId)) return R.reduce(R.concat('.'), '', dimensions);\r\n\r\n  const filterIndex = R.findIndex(R.propEq('id', filterId), dimensions);\r\n\r\n  const safeDataquery = R.isNil(dataquery) ? R.reduce(R.concat('.'), '', dimensions) : dataquery;\r\n\r\n  // undefined valueId <=> remove filter from selection\r\n  if (R.isNil(values)) {\r\n    return R.pipe(R.split('.'), R.update(filterIndex, ''), R.join('.'))(safeDataquery);\r\n  }\r\n\r\n  const dotSplitted = safeDataquery.split('.');\r\n  let newDimensionQuery = [];\r\n  if (dotSplitted[filterIndex] !== '') {\r\n    newDimensionQuery = dotSplitted[filterIndex].split('+');\r\n  }\r\n  values.forEach(v => {\r\n    if (!newDimensionQuery.includes(v)) newDimensionQuery.push(v);\r\n  });\r\n\r\n  dotSplitted[filterIndex] = newDimensionQuery.join('+');\r\n  return dotSplitted.join('.');\r\n};\r\n\r\n//This function forces the add/remove of a set of filters:\r\n//is the clickedValue in the list? -> remove all the values in \"values\"\r\n//is the clickedValue not in the list? -> add all the values in \"values\"\r\n//used to select/deselect a whole hierarchy (in values param) when clicking on a root node(in clickedValue param)\r\nexport const add_remove_filters = dimensions => (filterId, values, clickedValue) => dataquery => {\r\n  if (R.isNil(filterId)) return R.reduce(R.concat('.'), '', dimensions);\r\n\r\n  const filterIndex = R.findIndex(R.propEq('id', filterId), dimensions);\r\n\r\n  const safeDataquery = R.isNil(dataquery) ? R.reduce(R.concat('.'), '', dimensions) : dataquery;\r\n\r\n  // undefined valueId <=> remove filter from selection\r\n  if (R.isNil(values)) {\r\n    return R.pipe(R.split('.'), R.update(filterIndex, ''), R.join('.'))(safeDataquery);\r\n  }\r\n\r\n  const dotSplitted = safeDataquery.split('.');\r\n  let newDimensionQuery = [];\r\n  if (dotSplitted[filterIndex] !== '') {\r\n    newDimensionQuery = dotSplitted[filterIndex].split('+');\r\n  }\r\n\r\n  //the querystring for the dimension contains the clicked value: toggle by removing it and all the descendants\r\n  if (newDimensionQuery.includes(clickedValue)) {\r\n    values.forEach(v => {\r\n      const idx = newDimensionQuery.indexOf(v);\r\n      if (idx >= 0) newDimensionQuery.splice(idx, 1);\r\n    });\r\n  }\r\n  //Else add it\r\n  else {\r\n    values.forEach(v => {\r\n      const idx = newDimensionQuery.indexOf(v);\r\n      if (idx < 0) newDimensionQuery.push(v);\r\n    });\r\n  }\r\n  /*\r\n  values.forEach(v => {\r\n    if (!newDimensionQuery.includes(v)) newDimensionQuery.push(v);\r\n  });\r\n*/\r\n\r\n  dotSplitted[filterIndex] = newDimensionQuery.join('+');\r\n  return dotSplitted.join('.');\r\n};\r\n\r\nexport const updateDataquery = dimensions => (filterId, valueId) => dataquery => {\r\n  if (R.isNil(filterId)) return R.reduce(R.concat('.'), '', dimensions);\r\n\r\n  const filterIndex = R.findIndex(R.propEq('id', filterId), dimensions);\r\n\r\n  if (dimensions[filterIndex].forced != null) {\r\n    valueId = dimensions[filterIndex].forced;\r\n  }\r\n\r\n  const safeDataquery = R.isNil(dataquery) ? R.reduce(R.concat('.'), '', dimensions) : dataquery;\r\n\r\n  // undefined valueId <=> remove filter from selection\r\n  if (R.isNil(valueId)) {\r\n    return R.pipe(R.split('.'), R.update(filterIndex, ''), R.join('.'))(safeDataquery);\r\n  }\r\n\r\n  return R.pipe(\r\n    R.split('.'),\r\n    R.over(\r\n      R.lensIndex(filterIndex),\r\n      R.pipe(\r\n        R.ifElse(R.isEmpty, R.always([]), R.split('+')),\r\n        R.ifElse(R.includes(valueId), R.without([valueId]), R.append(valueId)),\r\n        R.join('+'),\r\n      ),\r\n    ),\r\n    R.join('.'),\r\n  )(safeDataquery);\r\n};\r\n\r\nconst greaterThanOne = R.pipe(R.length, R.flip(R.gt)(1));\r\nconst isMany = d =>\r\n  R.or(rules.isTimeDimension(R.prop('id')(d)), greaterThanOne(R.prop('values')(d)));\r\nexport const getDimensionsIds = R.pipe(R.filter(isMany), R.map(R.prop('id')));\r\nexport const getUniq = (array1, array2) => R.pipe(R.concat(array2), R.uniq)(array1);\r\n","import React from 'react';\r\nimport * as R from 'ramda';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nimport numeral from 'numeral';\r\nimport { DETableCell } from '@sis-cc/dotstatsuite-ui-components';\r\n\r\nexport const renameKeys = R.curry((keysMap, obj) =>\r\n  R.reduce((acc, key) => R.assoc(keysMap[key] || key, obj[key], acc), {}, R.keys(obj)),\r\n);\r\n\r\nexport const isValidNumber = R.both(R.is(Number), R.complement(R.equals(NaN)));\r\nexport const withIndex = R.addIndex(R.map)((value, index) => R.assoc('index', index)(value));\r\n\r\nexport const observationGetter = ({\r\n  observations,\r\n  dimensions,\r\n  customAttributes,\r\n  isRtl,\r\n}) => () => coordinates => {\r\n  const isUncoded = R.anyPass([\r\n    R.prop('isFootnote'),\r\n    () => R.equals(R.prop('name'), R.prop('id')),\r\n    R.pipe(R.prop('id'), R.length, R.lte(4)),\r\n  ]);\r\n\r\n  const cellProps = isRtl => (value, valueFlags) => {\r\n    const [uncodedFlags, codedFlags] = R.partition(isUncoded)(valueFlags);\r\n    return { isRtl, value, codedFlags, uncodedFlags };\r\n  };\r\n\r\n  const getValueId = valueIndexes =>\r\n    R.pipe(\r\n      R.converge(R.prop, [R.pipe(R.prop('index'), R.nth(R.__, valueIndexes)), R.prop('values')]),\r\n      R.prop('id'),\r\n    );\r\n\r\n  const formatDecimal = ({ customAttributes, valueIndexes }) => {\r\n    const attr = R.prop('decimals', customAttributes);\r\n\r\n    if (R.isNil(attr)) return R.identity;\r\n\r\n    const d = Number(getValueId(valueIndexes)(attr));\r\n    if (R.complement(isValidNumber)(d)) return R.identity;\r\n    const format = R.equals(d, 0) ? '0' : `0,0.[${R.join('', R.times(R.always('0'), d))}]`;\r\n\r\n    return value => numeral(value).format(format);\r\n  };\r\n\r\n  const formatScale = ({ customAttributes, valueIndexes }) => {\r\n    const attr = R.prop('prefscale', customAttributes);\r\n    if (R.isNil(attr)) return R.identity;\r\n\r\n    const e = Number(getValueId(valueIndexes)(attr));\r\n    if (R.complement(isValidNumber)(e)) return R.identity;\r\n\r\n    return value => numeral(value).multiply(Math.pow(10, -1 * e));\r\n  };\r\n\r\n  const formatSeparator = value => {\r\n    if (isValidNumber(value)) return numeral(value).format(`0,0.[0000000]`);\r\n    return R.identity(value);\r\n  };\r\n\r\n  const getValue = customAttributes => values => {\r\n    const valueIndexes = R.tail(values);\r\n\r\n    return R.ifElse(\r\n      isValidNumber,\r\n      R.pipe(\r\n        formatScale({ customAttributes, valueIndexes }),\r\n        formatDecimal({ customAttributes, valueIndexes }),\r\n        formatSeparator,\r\n      ),\r\n      R.always('-'),\r\n    )(R.nth(0)(values));\r\n  };\r\n\r\n  const getValueFlags = attributeFlags =>\r\n    R.addIndex(R.reduce)((acc, valueIndex, attributeIndex) => {\r\n      if (R.isNil(valueIndex)) return acc;\r\n      const flag = R.prop(attributeIndex)(attributeFlags);\r\n      if (R.isNil(flag)) return acc;\r\n      return R.append(\r\n        R.pipe(\r\n          R.prop('values'),\r\n          R.nth(valueIndex),\r\n          R.assoc('isFootnote')(R.prop('isFootnote')(flag)),\r\n        )(flag),\r\n      )(acc);\r\n    }, []);\r\n\r\n  const observation = R.pipe(\r\n    R.toPairs,\r\n    R.sortBy(\r\n      R.pipe(R.prop(0), R.flip(R.prop)({ ...dimensions.many, ...dimensions.one }), R.prop('index')),\r\n    ),\r\n    R.pluck(1),\r\n    R.join(':'),\r\n    R.flip(R.propOr([]))(observations),\r\n    R.converge(cellProps(isRtl), [\r\n      getValue(customAttributes),\r\n      R.pipe(R.tail, getValueFlags(R.prop('flags')(customAttributes))),\r\n    ]),\r\n  )({\r\n    ...coordinates,\r\n    ...R.reduce((memo, { id }) => ({ ...memo, [id]: 0 }), {})(R.values(dimensions.one)),\r\n  });\r\n\r\n  return <DETableCell {...observation} />;\r\n};\r\n\r\nexport const observationFormat = ({ isRtl }) => ({ observations, dimensions, customAttributes }) =>\r\n  observationGetter({\r\n    dimensions,\r\n    observations,\r\n    customAttributes,\r\n    isRtl,\r\n  })(R.identity);\r\n\r\nexport const dimensionFormats = {\r\n  label: rules.dimensionValueDisplay('label'),\r\n  code: rules.dimensionValueDisplay('code'),\r\n  both: rules.dimensionValueDisplay('both'),\r\n};\r\n\r\nexport const getDimensionGetters = intl =>\r\n  R.reduce(\r\n    (memo, key) => ({\r\n      ...memo,\r\n      [key]: intl.formatMessage({ id: `vx.config.display.${key}` }),\r\n    }),\r\n    {},\r\n    R.keys(dimensionFormats),\r\n  );\r\n\r\nexport const makeTree = items => {\r\n  const hierarchy = R.reduce(\r\n    (index, item) =>\r\n      item.parent in index\r\n        ? R.assoc(item.id, [], R.assoc(item.parent, R.append(item.id, index[item.parent]), index))\r\n        : R.assoc(item.id, [], index),\r\n    {},\r\n    items,\r\n  ); //=> E.g. {\"1\":[2],\"2\":[3],\"3\":[],\"4\":[]}\r\n  const index = R.map(R.head, R.groupBy(R.prop('id'), items)); //=> E.g. {\"!\": <item1>, \"2\": <item2>, ...}\r\n  const assoc = id => {\r\n    const childNodes = id => R.map(makeNode, hierarchy[id]);\r\n    return R.isEmpty(childNodes(id)) ? index[id] : R.assoc('childNodes', childNodes(id), index[id]);\r\n  };\r\n  const makeNode = id => R.dissoc('parent', assoc(id));\r\n  return R.map(makeNode, R.pluck('id', R.filter(item => R.isNil(item.parent), items)));\r\n};\r\n\r\nexport const computeHasSpotlight = values => {\r\n  const LIMIT = 8;\r\n  if (R.gt(R.length(values), LIMIT)) return true;\r\n\r\n  const computeflatArray = (acc, item) => {\r\n    if (item.childNodes) return R.reduce(computeflatArray, acc, item.childNodes);\r\n    return [...acc, item.id];\r\n  };\r\n\r\n  return R.gt(R.length(R.reduce(computeflatArray, [], values)), LIMIT);\r\n};\r\n","import { createSelector } from 'reselect';\r\nimport * as R from 'ramda';\r\nimport { sdmxPeriod } from '../lib/settings';\r\nimport { dimensionFormats } from '../lib/utils';\r\n\r\n//------------------------------------------------------------------------------------------------#0\r\nconst getVis = R.prop('vis');\r\n\r\n//------------------------------------------------------------------------------------------------#1\r\nexport const getPeriod = createSelector(\r\n  getVis,\r\n  R.pipe(\r\n    R.prop('period'),\r\n    R.ifElse(R.pipe(R.length, R.equals(2)), R.identity, R.always(sdmxPeriod)),\r\n  ),\r\n);\r\n\r\nexport const getLastnobservations = createSelector(getVis, R.prop('lastnobservations'));\r\n\r\nexport const getViewer = createSelector(getVis, R.prop('viewer'));\r\n\r\nexport const getAction = createSelector(getVis, R.prop('action'));\r\n\r\nexport const getDisplay = createSelector(getVis, R.prop('display'));\r\n\r\nexport const getFilter = createSelector(getVis, R.prop('filter'));\r\n\r\nexport const getDataflow = createSelector(getVis, R.prop('dataflow'));\r\n\r\nexport const getDataquery = createSelector(getVis, R.prop('dataquery'));\r\n\r\nexport const getIsFullscreen = createSelector(getVis, R.prop('isFullscreen'));\r\n\r\nexport const getTimeDimensionInverted = createSelector(getVis, R.prop('timeDimensionInverted'));\r\n\r\nexport const getLayout = createSelector(getVis, R.prop('layout'));\r\n\r\nexport const getDimensionGetter = createSelector(getVis, R.prop('dimensionGetter'));\r\n\r\nexport const getDimensionFormat = createSelector(\r\n  getDimensionGetter,\r\n  R.flip(R.prop)(dimensionFormats),\r\n);\r\n\r\nexport const getHelpUrl = createSelector(getVis, R.prop('helpUrl'));\r\nexport const getDownloadFullEnabled = createSelector(getVis, R.propOr('1', 'downloadFullEnabled'));\r\n","import { createSelector } from 'reselect';\r\nimport * as R from 'ramda';\r\nimport Set from 'es6-set';\r\nimport { getDataquery as getVisDataquery, getDimensionFormat } from './vis';\r\nimport { getSdmxAttribute } from '../lib/settings';\r\n\r\n//------------------------------------------------------------------------------------------------#0\r\nconst getSdmx = R.prop('sdmx');\r\n\r\n//------------------------------------------------------------------------------------------------#1\r\nexport const getDimensions = createSelector(getSdmx, R.prop('dimensions'));\r\n\r\nconst keysLimit = 800;\r\n\r\nconst limitRows = data => {\r\n  if (typeof data == 'undefined') {\r\n    return data;\r\n  }\r\n  const keys = Object.keys(data.dataSets[0].observations);\r\n  if (keys.length <= keysLimit) {\r\n    return data;\r\n  }\r\n  const ret = R.clone(data);\r\n\r\n  for (let i = keysLimit; i < keys.length; i++) delete ret.dataSets[0].observations[keys[i]];\r\n\r\n  ret.dataSets[0].limited = {\r\n    returnedKeyCount: keys.length,\r\n    limitedTo: keysLimit,\r\n  };\r\n\r\n  return ret;\r\n};\r\n\r\nconst limitedCount = data => {\r\n  if (typeof data == 'undefined') {\r\n    return {\r\n      returnedKeyCount: 0,\r\n      limitedTo: 0,\r\n    };\r\n  }\r\n  const keys = Object.keys(data.dataSets[0].observations);\r\n  return {\r\n    returnedKeyCount: keys.length,\r\n    limitedTo: keysLimit,\r\n  };\r\n};\r\n\r\nexport const getData = createSelector(getSdmx, R.prop('data'));\r\n\r\nexport const getDataLimited = createSelector(getSdmx, R.pipe(R.prop('data'), limitRows));\r\nexport const getDataLimitedCount = createSelector(getSdmx, R.pipe(R.prop('data'), limitedCount));\r\n\r\nexport const getLayout = createSelector(getSdmx, R.prop('layout'));\r\n\r\nexport const getDataflows = createSelector(getSdmx, R.prop('dataflows'));\r\nexport const getMap = createSelector(getSdmx, R.prop('map'));\r\n\r\n//------------------------------------------------------------------------------------------------#2\r\nexport const getDataquery = createSelector(\r\n  getVisDataquery,\r\n  getDimensions,\r\n  (dataquery, dimensions) => {\r\n    // dataquery in state is priority 1\r\n    if (R.not(R.anyPass([R.isEmpty, R.isNil])(dataquery))) return dataquery;\r\n\r\n    // dataquery extracted from dimensions default selection is priority 2\r\n    return R.pipe(\r\n      R.map(\r\n        R.pipe(\r\n          R.prop('values'),\r\n          R.filter(R.propEq('isDefaultSelected', true)),\r\n          R.pluck('id'),\r\n          R.join('+'),\r\n        ),\r\n      ),\r\n      R.join('.'),\r\n    )(dimensions);\r\n  },\r\n);\r\n\r\nexport const getCustomAttributes = createSelector(getData, getDimensionFormat, (data, format) => {\r\n  const flagsSet = new Set(getSdmxAttribute('flags'));\r\n  const attrs = R.pathOr([], ['structure', 'attributes', 'observation'])(data);\r\n  const isFootnote = true;\r\n\r\n  const customAttrs = R.addIndex(R.reduce)(\r\n    (memo, { id, name, values, ...rattr }, index) => {\r\n      const attr = { ...rattr, id, values, index, isFootnote, label: format({ id, name }) };\r\n\r\n      // flags defined in SETTINGS are *forced* footnotes\r\n      // footnote is annotation...\r\n      if (flagsSet.has(id)) return R.set(R.lensPath(['flags', index]), attr, memo);\r\n\r\n      // decimals is used to format the obs value\r\n      // should not be considered as a footnote\r\n      if (R.includes(id, getSdmxAttribute('decimals'))) return R.assoc('decimals', attr, memo);\r\n\r\n      // real footnotes handling: if single valued then footnote\r\n      if (R.pipe(R.length, R.equals(1))(values))\r\n        return R.over(R.lensProp('footnotes'), R.append(attr), memo);\r\n\r\n      // if multi valued then flag\r\n      if (R.pipe(R.isEmpty, R.not)(values)) return R.set(R.lensPath(['flags', index]), attr, memo);\r\n\r\n      return memo;\r\n    },\r\n    { flags: {} /* , decimals: undefined */, footnotes: [] },\r\n  )(attrs);\r\n\r\n  return customAttrs;\r\n});\r\n\r\n//------------------------------------------------------------------------------------------------#3\r\nexport const getFilters = createSelector(\r\n  getDimensions,\r\n  getDataquery,\r\n  R.pipe(\r\n    R.useWith(\r\n      (filters, dataquery) =>\r\n        R.addIndex(R.map)((filter, index) => {\r\n          //A filter has been forced for this dimension, just not return it.\r\n          if (filter.forced) return null;\r\n\r\n          if (R.pipe(R.nth(index), R.isEmpty)(dataquery)) return filter;\r\n          if (R.pipe(R.nth(index), R.isNil)(dataquery)) return filter;\r\n\r\n          const valueIdsSet = new Set(R.pipe(R.nth(index), R.split('+'))(dataquery));\r\n\r\n          return R.over(\r\n            R.lensProp('values'),\r\n            R.map(\r\n              R.ifElse(({ id }) => valueIdsSet.has(id), R.assoc('isSelected', true), R.identity),\r\n            ),\r\n            filter,\r\n          );\r\n        }, filters),\r\n      [R.identity, R.split('.')],\r\n    ),\r\n    R.filter(R.pipe(R.prop('values'), R.length, R.lt(1))),\r\n  ),\r\n);\r\n\r\n//------------------------------------------------------------------------------------------------#4\r\nexport const getSelection = createSelector(\r\n  getFilters,\r\n  R.pipe(\r\n    R.map(R.over(R.lensProp('values'), R.filter(R.propEq('isSelected', true)))),\r\n    R.filter(R.pipe(R.prop('values'), R.length, R.flip(R.gt)(0))),\r\n  ),\r\n);\r\n\r\nexport const getCustomSort = createSelector([getSdmx], struct => {\r\n  var ret = null;\r\n  if (!struct.dataflowAnnotations) return null;\r\n  struct.dataflowAnnotations.forEach(e => {\r\n    if (e.type == 'CUSTOM_SORT') {\r\n      ret = e;\r\n      if (e['text'] && typeof e['text'] == 'string') {\r\n        try {\r\n          e['text'] = JSON.parse(e['text']);\r\n        } catch (e) {\r\n          console.log(e);\r\n        }\r\n      }\r\n    }\r\n  });\r\n  return ret;\r\n});\r\n","import * as R from 'ramda';\r\nimport { updateDataquery, forceMultipleDataqueryUpdate, add_remove_filters } from '../lib/sdmx';\r\nimport { getDimensions } from '../selectors/sdmx';\r\n\r\n//-----------------------------------------------------------------------------------------constants\r\nexport const CHANGE_PERIOD = '@@vis/sdmx/CHANGE_PERIOD';\r\nexport const CHANGE_LASTNOBS = '@@vis/sdmx/CHANGE_LASTNOBS';\r\nexport const CHANGE_FILTER = '@@vis/CHANGE_FILTER';\r\nexport const CHANGE_VIEWER = '@@vis/CHANGE_VIEWER';\r\nexport const CHANGE_ACTION = '@@vis/CHANGE_ACTION';\r\nexport const CHANGE_DATAFLOW = '@@vis/sdmx/CHANGE_DATAFLOW';\r\nexport const CHANGE_DATAQUERY = '@@vis/sdmx/CHANGE_DATAQUERY';\r\nexport const CHANGE_DATAQUERY_ADD_FILTERS = '@@vis/sdmx/CHANGE_DATAQUERY_ADD_FILTERS';\r\nexport const OVERRIDE_DATAQUERY = '@@vis/sdmx/OVERRIDE_DATAQUERY';\r\nexport const CHANGE_LAYOUT = '@@vis/CHANGE_LAYOUT';\r\nexport const CHANGE_DIMENSION_GETTER = '@@vis/CHANGE_DIMENSION_GETTER';\r\nexport const CHANGE_IS_TIME_DIMENSION_INVERTED = '@@vis/CHANGE_IS_TIME_DIMENSION_INVERTED';\r\nexport const LOAD_DATAFLOWS = '@@vis/sdmx/LOAD_DATAFLOWS';\r\nexport const LOAD_HIERARCHY = '@@vis/sdmx/LOAD_HIERARCHY';\r\nexport const LOAD_MAP = '@@vis/sdmx/LOAD_MAP';\r\n\r\n//------------------------------------------------------------------------------------------creators\r\nexport const changeLastnobs = lastnobservations => ({\r\n  type: CHANGE_LASTNOBS,\r\n  payload: { lastnobservations },\r\n});\r\nexport const changePeriod = period => ({ type: CHANGE_PERIOD, payload: { period } });\r\nexport const changeFilter = filterId => ({ type: CHANGE_FILTER, payload: { filterId } });\r\nexport const changeViewer = viewerId => ({ type: CHANGE_VIEWER, payload: { viewerId } });\r\nexport const changeAction = actionId => ({ type: CHANGE_ACTION, payload: { actionId } });\r\nexport const changeDataflow = dataflow => ({ type: CHANGE_DATAFLOW, payload: { dataflow } });\r\nexport const changeLayout = layout => ({ type: CHANGE_LAYOUT, payload: { layout } });\r\nexport const changeDimensionGetter = dimensionGetter => ({\r\n  type: CHANGE_DIMENSION_GETTER,\r\n  payload: { dimensionGetter },\r\n});\r\nexport const changeIsTimeDimensionInverted = (id, isTimeDimensionInverted) => ({\r\n  type: CHANGE_IS_TIME_DIMENSION_INVERTED,\r\n  payload: { id, isTimeDimensionInverted },\r\n});\r\nexport const changeDataquery = (filterId, valueId) => (dispatch, getState) =>\r\n  dispatch({\r\n    type: CHANGE_DATAQUERY,\r\n    payload: { filterId, valueId, dimensions: getDimensions(getState()) },\r\n  });\r\n\r\nexport const changeDataqueryMultipleUpdate = (filterId, values) => (dispatch, getState) =>\r\n  dispatch({\r\n    type: CHANGE_DATAQUERY_ADD_FILTERS,\r\n    payload: { filterId, values, dimensions: getDimensions(getState()) },\r\n  });\r\n\r\nexport const loadDataflows = () => ({ type: LOAD_DATAFLOWS, payload: {} });\r\nexport const loadHierarchy = (config, dataflow) => ({\r\n  type: LOAD_HIERARCHY,\r\n  payload: { config: config, dataflow: dataflow },\r\n});\r\nexport const changeDq = (filterId, valueId, dims) => ({\r\n  type: CHANGE_DATAQUERY,\r\n  payload: { filterId, valueId, dimensions: dims },\r\n});\r\nexport const loadMap = mapUrl => ({\r\n  type: LOAD_MAP,\r\n  payload: mapUrl,\r\n});\r\n//-------------------------------------------------------------------------------------------reducer\r\nexport default (state = {}, action = {}) => {\r\n  switch (action.type) {\r\n    case CHANGE_ACTION:\r\n      var isFullscreen = R.always(R.equals(action.payload.actionId, 'fullscreen'));\r\n      return R.evolve({\r\n        isFullscreen: R.ifElse(isFullscreen, R.not, R.identity),\r\n        action: R.cond([\r\n          [isFullscreen, R.identity],\r\n          [R.equals(action.payload.actionId), R.always(undefined)],\r\n          [R.T, R.always(action.payload.actionId)],\r\n        ]),\r\n      })(state);\r\n    case CHANGE_FILTER:\r\n      return R.over(\r\n        R.lensProp('filter'),\r\n        filter =>\r\n          R.ifElse(R.equals(filter), R.always(undefined), R.identity)(\r\n            R.path(['payload', 'filterId'], action),\r\n          ),\r\n        state,\r\n      );\r\n    case CHANGE_PERIOD:\r\n      return R.set(R.lensProp('period'), R.path(['payload', 'period'], action), state);\r\n    case CHANGE_LASTNOBS:\r\n      return R.set(\r\n        R.lensProp('lastnobservations'),\r\n        R.path(['payload', 'lastnobservations'], action),\r\n        state,\r\n      );\r\n    case CHANGE_VIEWER:\r\n      return R.set(R.lensProp('viewer'), R.path(['payload', 'viewerId'], action), state);\r\n    case CHANGE_LAYOUT:\r\n      return R.set(R.lensProp('layout'), R.path(['payload', 'layout'], action), state);\r\n    case CHANGE_DIMENSION_GETTER:\r\n      return R.set(\r\n        R.lensProp('dimensionGetter'),\r\n        R.path(['payload', 'dimensionGetter'], action),\r\n        state,\r\n      );\r\n    case CHANGE_IS_TIME_DIMENSION_INVERTED:\r\n      return {\r\n        ...state,\r\n        timeDimensionInverted: R.set(\r\n          R.lensProp(action.payload.id),\r\n          !action.payload.isTimeDimensionInverted,\r\n          state.timeDimensionInverted,\r\n        ),\r\n      };\r\n    case CHANGE_DATAQUERY: {\r\n      //Code added to select/deselect all the descendants of a node when clicked.\r\n      //Codes only have a parent node (no descendants hierarchy)\r\n\r\n      //Get the list of codes for the clicked dimension\r\n      let dimVals = action.payload.dimensions.filter(d => {\r\n        return d.id == action.payload.filterId;\r\n      });\r\n      dimVals = dimVals[0];\r\n      //Will contain the list of nodes to select/deselect\r\n      let linkedNodes = [action.payload.valueId];\r\n      //At each step, the list of parents to find the children of\r\n      let parents = [action.payload.valueId];\r\n\r\n      //Loop all the nodes, if the node has the clicked one as parent then add it to the parent array\r\n      while (parents.length > 0) {\r\n        parents = dimVals.values.filter(v => {\r\n          return v.parentId && parents.indexOf(v.parentId) >= 0;\r\n        });\r\n        //push the node in the linked node\r\n        parents.forEach(p => {\r\n          linkedNodes.push(p.id);\r\n        });\r\n        //repeat until we cannot find any more descendants\r\n      }\r\n\r\n      if (linkedNodes.length == 1) {\r\n        return R.over(\r\n          R.lensProp('dataquery'),\r\n          updateDataquery(R.path(['payload', 'dimensions'], action))(\r\n            R.path(['payload', 'filterId'], action),\r\n            R.path(['payload', 'valueId'], action),\r\n          ),\r\n          state,\r\n        );\r\n      } else {\r\n        return R.over(\r\n          R.lensProp('dataquery'),\r\n          add_remove_filters(R.path(['payload', 'dimensions'], action))(\r\n            R.path(['payload', 'filterId'], action),\r\n            linkedNodes,\r\n            R.path(['payload', 'valueId'], action),\r\n          ),\r\n          state,\r\n        );\r\n      }\r\n    }\r\n    case CHANGE_DATAQUERY_ADD_FILTERS:\r\n      return R.over(\r\n        R.lensProp('dataquery'),\r\n        forceMultipleDataqueryUpdate(R.path(['payload', 'dimensions'], action))(\r\n          R.path(['payload', 'filterId'], action),\r\n          R.path(['payload', 'values'], action),\r\n        ),\r\n        state,\r\n      );\r\n    case OVERRIDE_DATAQUERY:\r\n      return R.set(R.lensProp('dataquery'), R.prop('dataquery', action), state);\r\n    case CHANGE_DATAFLOW:\r\n      return R.pipe(\r\n        R.set(R.lensProp('viewer'), 'table'),\r\n        R.set(R.lensProp('dataquery'), R.path(['payload', 'dataflow', 'dataquery'], action)),\r\n        R.set(R.lensProp('period'), R.path(['payload', 'dataflow', 'period'], action)),\r\n        R.flip(R.merge)(R.prop('payload', action)),\r\n      )(state);\r\n    case LOAD_MAP:\r\n      return state;\r\n\r\n    case LOAD_DATAFLOWS:\r\n      return state;\r\n    case LOAD_HIERARCHY:\r\n      return state;\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { createSelector } from 'reselect';\r\nimport * as R from 'ramda';\r\n\r\n//------------------------------------------------------------------------------------------------#0\r\nconst getApp = R.prop('app');\r\n\r\n//------------------------------------------------------------------------------------------------#1\r\nexport const getLocale = createSelector(getApp, R.prop('locale'));\r\n\r\nexport const getPending = createSelector(getApp, R.prop('pending'));\r\n\r\n//------------------------------------------------------------------------------------------------#2\r\nexport const getIsPending = id => createSelector(getPending, R.pipe(R.prop(id), R.equals(true)));\r\n\r\nexport const getIsRtl = createSelector(getLocale, R.propEq('isRtl', true));\r\n","'use strict';\r\nimport { getIndicatorProfileUrl, getIndicatorCodelistID } from '../lib/settings';\r\n\r\nexport const mapStructure = (s, lang) => {\r\n  // console.log(\"mapStructure\")\r\n  // console.log(s)\r\n\r\n  renameKey(s.meta, 'contentLanguages', 'content-languages');\r\n\r\n  //Preferred language is in the list? put it in the first position\r\n  if (s.meta['content-languages'].includes(lang)) {\r\n    s.meta['content-languages'].sort(function(a, b) {\r\n      if (a == lang) return -1;\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  //ConceptSchemes\r\n  s.data.conceptSchemes.forEach(cs => {\r\n    cs.concepts.forEach(c => {\r\n      c.links.forEach(l => {\r\n        l['type'] = 'conceptScheme';\r\n      });\r\n      c.name = c.names;\r\n    });\r\n  });\r\n\r\n  //renameKey(s.data, 'conceptschemes', 'conceptSchemes');\r\n\r\n  //codelists\r\n  s.data.codelists.forEach(cl => {\r\n    cl.name = cl.names;\r\n    const parents = new Set();\r\n\r\n    cl.codes.forEach(c => {\r\n      c.name = c.names;\r\n      addLinkAnnotation(cl.id, c);\r\n      if (c.parent) parents.add(c.parent);\r\n    });\r\n\r\n    if (parents.size == 1) {\r\n      cl.codes.forEach(c => {\r\n        if (c.parent) delete c.parent;\r\n      });\r\n    }\r\n  });\r\n\r\n  //datastructures\r\n  //renameKey(s.data, 'datastructures', 'dataStructures');\r\n\r\n  // s.data.dataStructures[0].dataStructureComponents.dimensionList.dimensions.splice(0,1);\r\n\r\n  //dataflows\r\n  s.data.dataflows[0].name = s.data.dataflows[0].names;\r\n\r\n  return s;\r\n};\r\n\r\nconst addLinkAnnotation = (cl_id, code, indicator_codelist_id) => {\r\n  if (cl_id != getIndicatorCodelistID) return;\r\n  if (!getIndicatorProfileUrl || getIndicatorProfileUrl == '') return;\r\n  if (typeof code.annotations == 'undefined') code.annotations = [];\r\n  code.annotations.push({ type: 'link', value: getIndicatorProfileUrl + '/' + code.id });\r\n};\r\n\r\nconst renameKey = (object, oldKey, newKey) => {\r\n  if (!object[oldKey]) return;\r\n  object[newKey] = object[oldKey];\r\n  delete object[oldKey];\r\n};\r\n\r\n/*\r\nDATA\r\n*/\r\nexport const convertName2 = (name, lang) => {\r\n  const ret = {};\r\n  ret[lang] = name;\r\n  return ret;\r\n};\r\n\r\nexport const map_struct_component = (comp, lang) => {\r\n  if (comp) {\r\n    comp.forEach(c => {\r\n      c.name = convertName2(c.name, lang);\r\n      c.values.forEach(v => {\r\n        v.name = convertName2(v.name, lang);\r\n      });\r\n    });\r\n  }\r\n};\r\n\r\nexport const mapData = (d, lang, roundData) => {\r\n  //console.log(\"MAPPING DATA\")\r\n  //console.log(d)\r\n\r\n  d.meta['content-languages'] = [lang];\r\n\r\n  d.data.structure.name = d.data.structure.names;\r\n\r\n  map_struct_component(d.data.structure.dimensions.dataset, lang);\r\n  map_struct_component(d.data.structure.dimensions.series, lang);\r\n  map_struct_component(d.data.structure.dimensions.observation, lang);\r\n  map_struct_component(d.data.structure.attributes.dataset, lang);\r\n  map_struct_component(d.data.structure.attributes.series, lang);\r\n  map_struct_component(d.data.structure.attributes.observation, lang);\r\n\r\n  //Round the number:\r\n  //if the value < 1000 then roud to 4 digits\r\n  if (roundData) {\r\n    for (let [key, value] of Object.entries(d.data.dataSets[0].observations)) {\r\n      if (value && value[0] && !isNaN(value[0])) {\r\n        try {\r\n          if (value[0] > 1000) value[0] = Number.parseFloat(value[0]).toFixed(0);\r\n          else {\r\n            //parse to Fload to use toFixed, parse again to remove trailing zeros\r\n            value[0] = Number.parseFloat(Number.parseFloat(value[0]).toFixed(roundData));\r\n          }\r\n        } catch (err) {\r\n          //Empty\r\n        }\r\n      }\r\n    }\r\n  }\r\n  //console.log(\"RETURNING\")\r\n  //console.log(ret)\r\n\r\n  return d;\r\n};\r\n","'use strict';\r\nimport { getIndicatorProfileUrl, getIndicatorCodelistID } from '../lib/settings';\r\n\r\nconst getKeyStartsWith = (node, startsWith) => {\r\n  const k = Object.keys(node);\r\n  if (k == null) return [];\r\n  return k.filter(x => x.startsWith(startsWith));\r\n};\r\n\r\nexport const mapStructure = (s, lang) => {\r\n  console.log('mapStructure');\r\n  console.log('mapStructure');\r\n  console.log('mapStructure');\r\n  console.log(s);\r\n\r\n  //renameKey(s.meta, 'contentLanguages', 'content-languages');\r\n\r\n  //Preferred language is in the list? put it in the first position\r\n  /*if (s.meta['content-languages'].includes(lang)) {\r\n    s.meta['content-languages'].sort(function(a, b) {\r\n      if (a == lang) return -1;\r\n      return 0;\r\n    });\r\n  }*/\r\n\r\n  //ConceptSchemes\r\n  /*s.data.conceptSchemes.forEach(cs => {\r\n    cs.concepts.forEach(c => {\r\n      c.links.forEach(l => {\r\n        l['type'] = 'conceptScheme';\r\n      });\r\n      c.name = c.names;\r\n    });\r\n  });*/\r\n  const m = { data: {} };\r\n  const node_catScheme =\r\n    s.references[\r\n      getKeyStartsWith(s.references, 'urn:sdmx:org.sdmx.infomodel.categoryscheme.CategoryScheme')[0]\r\n    ];\r\n\r\n  //conceptSchemes\r\n  m.data.conceptSchemes = [];\r\n  node_catScheme.items.forEach(n => {\r\n    const toAdd = {};\r\n    toAdd.id = n.id;\r\n    toAdd.name = n.name;\r\n    m.data.conceptSchemes.push(toAdd);\r\n  });\r\n\r\n  console.log(node_catScheme);\r\n  console.log('mapped');\r\n  console.log(m);\r\n  //renameKey(s.data, 'conceptschemes', 'conceptSchemes');\r\n\r\n  //codelists\r\n  s.data.codelists.forEach(cl => {\r\n    cl.name = cl.names;\r\n    const parents = new Set();\r\n\r\n    cl.codes.forEach(c => {\r\n      c.name = c.names;\r\n      addLinkAnnotation(cl.id, c);\r\n      if (c.parent) parents.add(c.parent);\r\n    });\r\n\r\n    if (parents.size == 1) {\r\n      cl.codes.forEach(c => {\r\n        if (c.parent) delete c.parent;\r\n      });\r\n    }\r\n  });\r\n\r\n  //datastructures\r\n  //renameKey(s.data, 'datastructures', 'dataStructures');\r\n\r\n  // s.data.dataStructures[0].dataStructureComponents.dimensionList.dimensions.splice(0,1);\r\n\r\n  //dataflows\r\n  s.data.dataflows[0].name = s.data.dataflows[0].names;\r\n\r\n  return s;\r\n};\r\n\r\nconst addLinkAnnotation = (cl_id, code, indicator_codelist_id) => {\r\n  if (cl_id != getIndicatorCodelistID) return;\r\n  if (!getIndicatorProfileUrl || getIndicatorProfileUrl == '') return;\r\n  if (typeof code.annotations == 'undefined') code.annotations = [];\r\n  code.annotations.push({ type: 'link', value: getIndicatorProfileUrl + '/' + code.id });\r\n};\r\n\r\nconst renameKey = (object, oldKey, newKey) => {\r\n  if (!object[oldKey]) return;\r\n  object[newKey] = object[oldKey];\r\n  delete object[oldKey];\r\n};\r\n\r\n/*\r\nDATA\r\n*/\r\nexport const convertName2 = (name, lang) => {\r\n  const ret = {};\r\n  ret[lang] = name;\r\n  return ret;\r\n};\r\n\r\nexport const map_struct_component = (comp, lang) => {\r\n  if (comp) {\r\n    comp.forEach(c => {\r\n      c.name = convertName2(c.name, lang);\r\n      c.values.forEach(v => {\r\n        v.name = convertName2(v.name, lang);\r\n      });\r\n    });\r\n  }\r\n};\r\n\r\nexport const mapData = (d, lang, roundData) => {\r\n  console.log('MAPPING DATA');\r\n  console.log('MAPPING DATA');\r\n  console.log('MAPPING DATA');\r\n  console.log(d);\r\n\r\n  d.meta['content-languages'] = [lang];\r\n\r\n  d.data.structure.name = d.data.structure.names;\r\n\r\n  map_struct_component(d.data.structure.dimensions.dataset, lang);\r\n  map_struct_component(d.data.structure.dimensions.series, lang);\r\n  map_struct_component(d.data.structure.dimensions.observation, lang);\r\n  map_struct_component(d.data.structure.attributes.dataset, lang);\r\n  map_struct_component(d.data.structure.attributes.series, lang);\r\n  map_struct_component(d.data.structure.attributes.observation, lang);\r\n\r\n  //Round the number:\r\n  //if the value < 1000 then roud to 4 digits\r\n  if (roundData) {\r\n    for (let [key, value] of Object.entries(d.data.dataSets[0].observations)) {\r\n      if (value && value[0] && !isNaN(value[0])) {\r\n        try {\r\n          if (value[0] > 1000) value[0] = Number.parseFloat(value[0]).toFixed(0);\r\n          else value[0] = Number.parseFloat(value[0]).toFixed(roundData);\r\n        } catch (err) {\r\n          //Empty\r\n        }\r\n      }\r\n    }\r\n  }\r\n  //console.log(\"RETURNING\")\r\n  //console.log(ret)\r\n\r\n  return d;\r\n};\r\n","'use strict';\r\nimport { getIndicatorProfileUrl, getIndicatorCodelistID } from '../lib/settings';\r\n\r\nconst renameKey = (object, oldKey, newKey) => {\r\n  if (!object[oldKey]) return;\r\n  object[newKey] = object[oldKey];\r\n  delete object[oldKey];\r\n};\r\n\r\nexport const mapStructure = (s, lang) => {\r\n  //console.log(\"mapStructure\")\r\n  //console.log(s)\r\n\r\n  renameKey(s.meta, 'contentLanguages', 'content-languages');\r\n\r\n  //Preferred language is in the list? put it in the first position\r\n  if (s.meta['content-languages'].includes(lang)) {\r\n    s.meta['content-languages'].sort(function(a, b) {\r\n      if (a == lang) return -1;\r\n      return 0;\r\n    });\r\n  }\r\n  //ConceptSchemes\r\n  s.data.conceptSchemes.forEach(cs => {\r\n    cs.concepts.forEach(c => {\r\n      c.name = c.names;\r\n    });\r\n  });\r\n\r\n  //codelists\r\n  s.data.codelists.forEach(cl => {\r\n    cl.name = cl.names;\r\n    const parents = new Set();\r\n\r\n    cl.codes.forEach(c => {\r\n      c.name = c.names;\r\n      if (c.parent) parents.add(c.parent);\r\n    });\r\n\r\n    if (parents.size == 1) {\r\n      cl.codes.forEach(c => {\r\n        if (c.parent) delete c.parent;\r\n      });\r\n    }\r\n  });\r\n\r\n  //dataflows\r\n  s.data.dataflows[0].name = s.data.dataflows[0].names;\r\n  //console.log(\"Struct ret\");\r\n  //console.log(s)\r\n  return s;\r\n};\r\n\r\n/*\r\nDATA\r\n*/\r\nexport const convertName2 = (name, lang) => {\r\n  const ret = {};\r\n  ret[lang] = name;\r\n  return ret;\r\n};\r\n\r\nexport const map_struct_component_old = (comp, lang) => {\r\n  if (comp) {\r\n    comp.forEach(c => {\r\n      c.name = convertName2(c.name, lang);\r\n      c.values.forEach(v => {\r\n        v.name = convertName2(v.name, lang);\r\n      });\r\n    });\r\n  }\r\n};\r\n\r\nexport const map_struct_component = (comp, lang) => {\r\n  if (comp) {\r\n    comp.forEach(c => {\r\n      c.name = convertName2(c.name, lang);\r\n      delete c.names;\r\n      c.values.forEach(v => {\r\n        v.name = convertName2(v.name, lang);\r\n        delete v.names;\r\n      });\r\n    });\r\n  }\r\n};\r\n\r\nexport const mapData = (d, lang, roundData) => {\r\n  d.meta['contentLanguages'] = [lang];\r\n  d.meta['content-languages'] = [lang];\r\n\r\n  d.data.structure.name = d.data.structure.names;\r\n  map_struct_component(d.data.structure.dimensions.dataset, lang);\r\n  map_struct_component(d.data.structure.dimensions.series, lang);\r\n  map_struct_component(d.data.structure.dimensions.observation, lang);\r\n  map_struct_component(d.data.structure.attributes.dataset, lang);\r\n  map_struct_component(d.data.structure.attributes.series, lang);\r\n  map_struct_component(d.data.structure.attributes.observation, lang);\r\n\r\n  //Round the number:\r\n  //if the value < 1000 then roud to 4 digits\r\n  if (roundData) {\r\n    for (let [key, value] of Object.entries(d.data.dataSets[0].observations)) {\r\n      if (value && value[0] && !isNaN(value[0])) {\r\n        try {\r\n          if (value[0] > 1000) value[0] = Number.parseFloat(value[0]).toFixed(0);\r\n          else value[0] = Number.parseFloat(value[0]).toFixed(roundData);\r\n        } catch (err) {\r\n          //Empty\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  //console.log(\"RETURNING\")\r\n  //console.log(d)\r\n\r\n  return d;\r\n};\r\n","import { getCuratedData } from '@sis-cc/dotstatsuite-ui-components/build/components/de-table/lib/curator';\r\nimport { getSortedLayout } from '@sis-cc/dotstatsuite-ui-components/build/components/de-table/lib/tanker';\r\nimport ExcelJS from 'exceljs/dist/exceljs';\r\n\r\nconst TIME_PERIOD_ID = 'TIME_PERIOD';\r\n\r\nconst getDimensionById = (dims, id) => {\r\n  for (var i = 0; i < dims.length; i++) {\r\n    if (dims[i].id == id) {\r\n      return dims[i];\r\n    }\r\n  }\r\n  return null;\r\n};\r\n\r\nconst updateIndex = (index, dimval) => {\r\n  index[dimval.dimension.__index] = dimval.value.__index;\r\n};\r\n\r\nconst idxToString = idx => {\r\n  return idx\r\n    .filter(e => {\r\n      return e != null;\r\n    })\r\n    .join(':');\r\n};\r\n\r\nconst createDataRow = (header, section, datarow, curated, obs, attribs) => {\r\n  const hidx = [];\r\n  const secidx = [];\r\n  const valIdx = [];\r\n  var rowDimVals = [];\r\n  var row = [];\r\n  var dataStartIdx = 0;\r\n  var rowAttribs = [];\r\n\r\n  //Adds the dimension values at the beginning of the data row (when something has benn put on the rows)\r\n  //It is the first level in the \"curated\" structure\r\n  datarow.forEach(dr => {\r\n    rowDimVals.push(dr.value.name);\r\n  });\r\n\r\n  //For each header start to build the observation key:[headerKey1:headerKey2...] => [0:2]\r\n  header.forEach(h => {\r\n    if (h.length > 0) {\r\n      h.forEach(h2 => {\r\n        updateIndex(hidx, h2);\r\n      });\r\n    }\r\n    var headerIndex = idxToString(hidx);\r\n\r\n    //To the same for the section: [sectionKey1:sectionKey2....]\r\n    //It is the second level in the \"curated\" structure\r\n    section.forEach(sec => {\r\n      updateIndex(secidx, sec);\r\n    });\r\n    const sectionIndex = idxToString(secidx);\r\n\r\n    //Same for the row\r\n    //It is the third level in the \"curated\" structure\r\n    datarow.forEach(dr => {\r\n      updateIndex(valIdx, dr);\r\n    });\r\n    const valIndex = idxToString(valIdx);\r\n\r\n    //If header has no index then the key is \"\"\r\n    var lev1 = null;\r\n    if (!headerIndex) {\r\n      lev1 = curated[''];\r\n    } else {\r\n      lev1 = curated[headerIndex];\r\n    }\r\n\r\n    dataStartIdx = row.length;\r\n\r\n    const lev2 = lev1[sectionIndex];\r\n    //Lev 2 is missing? Add a -\r\n    if (!lev2) {\r\n      row.push('-');\r\n      rowAttribs.push('');\r\n      //There is a lev 2 go to lev 3 in the structure\r\n    } else {\r\n      const lev3 = lev2[valIndex];\r\n      //No lev 3 add -\r\n      if (!lev3) {\r\n        row.push('-');\r\n        rowAttribs.push('');\r\n      } else {\r\n        //obs_val\r\n        row.push(obs[lev3][0]);\r\n        //attribs\r\n        var att = [];\r\n        for (var a = 1; a < obs[lev3].length; a++) {\r\n          if (obs[lev3][a] != null) {\r\n            //If there is more than 1 attribute value then add it to the notes, then it will be added to the footnotes.\r\n            if (!attribs[a - 1].isFootnote) {\r\n              att.push(attribs[a - 1].name + ': ' + attribs[a - 1].values[obs[lev3][a]].name);\r\n            }\r\n          }\r\n        }\r\n\r\n        rowAttribs.push(att.join('\\r\\n'));\r\n      }\r\n    }\r\n  });\r\n\r\n  return { rowDimVals: rowDimVals, row: row, rowAttribs: rowAttribs, dataStartIdx: dataStartIdx };\r\n};\r\n\r\nconst createFootnotes = attribs => {\r\n  const ret = [];\r\n\r\n  attribs.forEach(a => {\r\n    if (a.values && a.values.length != 0 && a.isFootnote) {\r\n      ret.push({ name: a.name, value: a.values[0].name });\r\n    }\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nconst changeCellStyle = (cell, style) => {\r\n  cell.fill = {\r\n    type: 'pattern',\r\n    pattern: 'solid',\r\n    fgColor: { argb: style.fill },\r\n  };\r\n  var isBold = false;\r\n  if (style.bold) {\r\n    isBold = true;\r\n  }\r\n  cell.font = { color: { argb: style.color }, bold: isBold };\r\n};\r\n\r\nexport const generateExcel = async (data, layout, timeDimensionInverted) => {\r\n  const excel_styles = {\r\n    header: {\r\n      fill: 'FF47494e',\r\n      color: 'FFFFFFFF',\r\n    },\r\n    section: {\r\n      fill: 'FF47494e',\r\n      color: 'FFFFFFFF',\r\n    },\r\n    rowDim: {\r\n      fill: 'FFd9d9d9',\r\n      color: 'FF47494e',\r\n      bold: true,\r\n    },\r\n    rowDimValue: {\r\n      fill: 'FFd9d9d9',\r\n      color: 'FF47494e',\r\n    },\r\n    footnotesSection: {\r\n      bold: true,\r\n    },\r\n  };\r\n\r\n  var sections = [];\r\n  var header = [];\r\n  var rows = [];\r\n\r\n  const dims = data.data.structure.dimensions.observation;\r\n  const attribs = data.data.structure.attributes.observation;\r\n  const obs = data.data.dataSets[0].observations;\r\n\r\n  attribs.forEach(a => {\r\n    a.isFootnote = true;\r\n  });\r\n\r\n  var lastAttribKey = [];\r\n  const obs_keys = Object.keys(obs);\r\n\r\n  if (obs_keys.length > 1) {\r\n    obs[obs_keys[0]].forEach(a => {\r\n      lastAttribKey.push(a);\r\n    });\r\n\r\n    Object.keys(obs).forEach(o => {\r\n      for (var oidx = 1; oidx < obs[o].length; oidx++) {\r\n        if (lastAttribKey[oidx] != obs[o][oidx]) {\r\n          attribs[oidx - 1].isFootnote = false;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  dims.forEach(d => {\r\n    var vidx = 0;\r\n    d['__index'] = d.keyPosition;\r\n    d['label'] = d.name;\r\n    d.values.forEach(v => {\r\n      v['__index'] = vidx;\r\n      v['label'] = v.name;\r\n      vidx++;\r\n    });\r\n  });\r\n\r\n  var timeDim = dims.find(o => {\r\n    return o.id == TIME_PERIOD_ID;\r\n  });\r\n  const timeSort = function(a, b) {\r\n    if (a.start < b.start) return -1;\r\n    if (a.start > b.start) return 1;\r\n    return 0;\r\n  };\r\n  const timeSortInv = function(a, b) {\r\n    if (a.start > b.start) return -1;\r\n    if (a.start < b.start) return 1;\r\n    return 0;\r\n  };\r\n  if (timeDimensionInverted) {\r\n    timeDim = timeDim.values.sort(timeSortInv);\r\n  } else {\r\n    timeDim = timeDim.values.sort(timeSort);\r\n  }\r\n\r\n  if (layout) {\r\n    if (layout.sections) {\r\n      layout.sections.forEach(element => {\r\n        sections.push(getDimensionById(dims, element));\r\n      });\r\n    }\r\n    if (layout.header) {\r\n      layout.header.forEach(element => {\r\n        header.push(getDimensionById(dims, element));\r\n      });\r\n    }\r\n    if (layout.rows) {\r\n      layout.rows.forEach(element => {\r\n        rows.push(getDimensionById(dims, element));\r\n      });\r\n    }\r\n  } else {\r\n    rows = [dims[0]];\r\n    sections = dims.slice(1, dims.length);\r\n  }\r\n\r\n  const layout2 = { header: header, rows: rows, sections: sections };\r\n  const datakeys = [];\r\n  for (let [key, value] of Object.entries(obs)) {\r\n    datakeys.push(key);\r\n  }\r\n\r\n  const curated = getCuratedData({ observations: obs, layout: layout2 });\r\n  const curLay = getSortedLayout(layout2, obs);\r\n\r\n  //const ExcelJS = require('exceljs');\r\n  var rowLen = 0;\r\n  var rowDimsLen = 0;\r\n\r\n  if (\r\n    curLay.sectionsData[0] &&\r\n    curLay.sectionsData[0][1] &&\r\n    curLay.sectionsData[0][1][0] &&\r\n    rowLen < curLay.sectionsData[0][1][0].length + 1\r\n  ) {\r\n    rowDimsLen = curLay.sectionsData[0][1][0].length;\r\n  }\r\n\r\n  if (curLay.headerData && curLay.headerData.length > 0) {\r\n    //rowlen is header (e.g. #years) + 1 (dim title) + it gets longer id there are 2 or more rowDims: rowDimsLen\r\n    //It should be #dimvalues on header + 1 (header title) + #rowDims -1(as one rowDim is under the header title)\r\n    //= #dimValues + #rowDims +1 -1 = #dimValues + #rowDims\r\n    rowLen = curLay.headerData.length + rowDimsLen;\r\n  }\r\n\r\n  const workbook = new ExcelJS.Workbook();\r\n  const sheet = workbook.addWorksheet('Unicef data');\r\n\r\n  var row = [];\r\n  //Create the header (columns) rows\r\n  if (curLay.headerData && curLay.headerData.length > 0) {\r\n    for (var rnum = 0; rnum < curLay.headerData[0].length; rnum++) {\r\n      row.push(curLay.headerData[0][rnum].dimension.name);\r\n\r\n      for (var col_shift = 0; col_shift < rowDimsLen - 1; col_shift++) row.push('');\r\n\r\n      curLay.headerData.forEach(h => {\r\n        row.push(h[rnum].value.name);\r\n      });\r\n      var r = sheet.addRow(row);\r\n\r\n      for (var i = 0; i < rowLen; i++) {\r\n        changeCellStyle(r.getCell(i + 1), excel_styles.header);\r\n      }\r\n\r\n      row = [];\r\n    }\r\n  }\r\n\r\n  //create the rows dimensions title row\r\n  row = [];\r\n  if (curLay.sectionsData && curLay.sectionsData.length > 0) {\r\n    curLay.sectionsData[0][1][0].forEach(s => {\r\n      row.push(s.dimension.name);\r\n    });\r\n    r = sheet.addRow(row);\r\n    for (i = 0; i < rowLen; i++) {\r\n      changeCellStyle(r.getCell(i + 1), excel_styles.rowDim);\r\n    }\r\n  }\r\n\r\n  //create sections and data rows\r\n  row = [];\r\n\r\n  //console.log(\"data\")\r\n  //console.log(data)\r\n\r\n  if (curLay.sectionsData) {\r\n    curLay.sectionsData.forEach(sec => {\r\n      var sectionText = '';\r\n      sec[0].forEach(secHead => {\r\n        sectionText = sectionText + secHead.dimension.name + ': ' + secHead.value.name + ' | ';\r\n      });\r\n\r\n      r = sheet.addRow([sectionText]);\r\n      for (i = 0; i < rowLen; i++) {\r\n        changeCellStyle(r.getCell(i + 1), excel_styles.section);\r\n      }\r\n      sec[1].forEach(datarow => {\r\n        var rowData = createDataRow(curLay.headerData, sec[0], datarow, curated, obs, attribs);\r\n        r = sheet.addRow();\r\n\r\n        var cellCount = 1;\r\n        var cell = null;\r\n        for (i = 0; i < rowData.rowDimVals.length; i++) {\r\n          cell = r.getCell(cellCount);\r\n          cell.value = rowData.rowDimVals[i];\r\n          changeCellStyle(cell, excel_styles.rowDimValue);\r\n          cellCount++;\r\n        }\r\n\r\n        for (i = 0; i < rowData.row.length; i++) {\r\n          cell = r.getCell(cellCount);\r\n          cell.value = rowData.row[i];\r\n          if (rowData.rowAttribs[i] != '') {\r\n            cell.note = rowData.rowAttribs[i];\r\n          }\r\n          cellCount++;\r\n        }\r\n\r\n        row = [];\r\n      });\r\n    });\r\n  }\r\n\r\n  //The footnotes\r\n  const footnotes = createFootnotes(attribs);\r\n  if (footnotes.length > 0) {\r\n    r = sheet.addRow();\r\n    r = sheet.addRow(['Footnotes']);\r\n    changeCellStyle(r.getCell(1), excel_styles.footnotesSection);\r\n  }\r\n  footnotes.forEach(f => {\r\n    //r = sheet.addRow([f.name, f.value]);\r\n    r = sheet.addRow([f.name + ': ' + f.value]);\r\n  });\r\n\r\n  const buf = await workbook.xlsx.writeBuffer();\r\n  return buf;\r\n};\r\n\r\nconst csvToArray = text => {\r\n  let p = '',\r\n    row = [''],\r\n    ret = [row],\r\n    i = 0,\r\n    r = 0,\r\n    s = !0,\r\n    l;\r\n  for (l of text) {\r\n    if ('\"' === l) {\r\n      if (s && l === p) row[i] += l;\r\n      s = !s;\r\n    } else if (',' === l && s) l = row[++i] = '';\r\n    else if ('\\n' === l && s) {\r\n      if ('\\r' === p) row[i] = row[i].slice(0, -1);\r\n      row = ret[++r] = [(l = '')];\r\n      i = 0;\r\n    } else row[i] += l;\r\n    p = l;\r\n  }\r\n  return ret;\r\n};\r\n\r\nexport const generateExcelLong = async data => {\r\n  const excel_styles = {\r\n    header: {\r\n      fill: 'FF007cba',\r\n      color: 'FFFFFFFF',\r\n    },\r\n  };\r\n\r\n  const parsed = csvToArray(data);\r\n  let r = null;\r\n  let i = 0;\r\n  const workbook = new ExcelJS.Workbook();\r\n  const sheet = workbook.addWorksheet('Unicef data');\r\n  if (parsed && parsed.length > 0) {\r\n    r = sheet.addRow(parsed[0]);\r\n    for (i = 0; i < parsed[0].length; i++) {\r\n      changeCellStyle(r.getCell(i + 1), excel_styles.header);\r\n    }\r\n    for (i = 1; i < parsed.length; i++) {\r\n      r = sheet.addRow(parsed[i]);\r\n    }\r\n  }\r\n\r\n  const buf = await workbook.xlsx.writeBuffer();\r\n  return buf;\r\n};\r\n","import * as R from 'ramda';\r\nimport axios from 'axios';\r\nimport FileSaver from 'file-saver';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nimport {\r\n  structureParser,\r\n  getConfig,\r\n  getFilename,\r\n  getFusionConfig,\r\n  dataflowsParser,\r\n  hierarchyParser,\r\n  getDataflowsConfig,\r\n  getHierarchyUrl,\r\n} from '../lib/sdmx';\r\nimport { sdmxRange, getRoundData } from '../lib/settings';\r\nimport * as fm from './formatMapper';\r\nimport * as fm_istat from './formatMapper_istat';\r\nimport * as fm_eurostat from './formatMapper_eurostat';\r\nimport { generateExcel, generateExcelLong } from '../lib/excel';\r\n\r\nconst getLocale = R.pathOr('en', ['locale', 'id']);\r\n//const keysLimit = 800;\r\n\r\nconst getStructure = ({ configArgs }) => {\r\n  const { url, datasource } =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION'\r\n      ? getFusionConfig({ configArgs })\r\n      : getConfig({ type: 'structure' })({ configArgs });\r\n\r\n  const qStringParams =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION'\r\n      ? { references: 'all', format: 'sdmx-json', detail: 'referencepartial' }\r\n      : //{ references: 'all', format: 'sdmx-json', detail: 'full' }\r\n        // { format: 'sdmx-json', mode: 'exact', references: 'descendants' }\r\n        { references: 'all' };\r\n\r\n  const accParams = {\r\n    FUSION: {\r\n      'Accept-Language': getLocale(configArgs),\r\n    },\r\n    EUROSTAT: {\r\n      'Accept-Language': getLocale(configArgs),\r\n      Accept: 'application/vnd.sdmx.structure+json;version=1.0',\r\n    },\r\n    istat: {\r\n      'Accept-Language': getLocale(configArgs),\r\n      Accept: 'application/json',\r\n    },\r\n  };\r\n  const acceptParam = accParams[R.prop('backendId', configArgs.dataflow)];\r\n\r\n  const addForcedDims = (configArgs, struct) => {\r\n    if (!configArgs.dataflow.forcedDims) return;\r\n    Object.keys(configArgs.dataflow.forcedDims).forEach(k => {\r\n      struct.data.dataStructures[0].dataStructureComponents.dimensionList.dimensions.forEach(d => {\r\n        if (d.id == k) {\r\n          d.forced = configArgs.dataflow.forcedDims[k];\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  const mapSDMX_structureEurostat = data => {\r\n    addForcedDims(configArgs, data.data);\r\n    return fm_eurostat.mapStructure(data.data, configArgs.locale.id);\r\n    //return data.data;\r\n  };\r\n  const mapSDMX_structureFusion = data => {\r\n    addForcedDims(configArgs, data.data);\r\n    return fm.mapStructure(data.data, configArgs.locale.id);\r\n  };\r\n  const mapSDMX_structureIstat = data => {\r\n    addForcedDims(configArgs, data.data);\r\n    return fm_istat.mapStructure(data.data, configArgs.locale.id);\r\n  };\r\n\r\n  let sdmxMapperStruct = null;\r\n  if (R.prop('backendId', configArgs.dataflow) == 'FUSION') {\r\n    sdmxMapperStruct = mapSDMX_structureFusion;\r\n  } else if (R.prop('backendId', configArgs.dataflow) == 'EUROSTAT') {\r\n    sdmxMapperStruct = mapSDMX_structureEurostat;\r\n  } else if (R.prop('backendId', configArgs.dataflow) == 'istat') {\r\n    sdmxMapperStruct = mapSDMX_structureIstat;\r\n  }\r\n\r\n  return axios\r\n    .get(url, {\r\n      params: R.cond([\r\n        [\r\n          R.always(R.prop('supportsReferencePartial', datasource)),\r\n          R.assoc('detail', 'referencepartial'),\r\n        ],\r\n        [R.T, R.identity],\r\n      ])(qStringParams),\r\n      headers: acceptParam,\r\n    })\r\n    .then(R.pipe(sdmxMapperStruct, structureParser));\r\n};\r\n\r\nconst getData = ({ configArgs, requestArgs, dimensions }) => {\r\n  const { url, datasource } = getConfig({ type: 'data' })({ configArgs });\r\n\r\n  if (requestArgs.lastnobservations) {\r\n    requestArgs.lastnobservations = 1;\r\n  } else {\r\n    delete requestArgs.lastnobservations;\r\n  }\r\n\r\n  const mapSDMX_dataEurostat = data => {\r\n    //return data.data;\r\n    const ret = fm_eurostat.mapData(data.data, configArgs.locale.id, getRoundData);\r\n    return ret;\r\n  };\r\n  const mapSDMX_dataFusion = data => {\r\n    return fm.mapData(data.data, configArgs.locale.id, getRoundData);\r\n  };\r\n\r\n  const mapSDMX_dataIstat = data => {\r\n    return fm_istat.mapData(data.data, configArgs.locale.id, getRoundData);\r\n  };\r\n\r\n  let sdmxMapperData = null;\r\n  if (R.prop('backendId', configArgs.dataflow) == 'FUSION') sdmxMapperData = mapSDMX_dataFusion;\r\n  else if (R.prop('backendId', configArgs.dataflow) == 'EUROSTAT')\r\n    sdmxMapperData = mapSDMX_dataEurostat;\r\n  else if (R.prop('backendId', configArgs.dataflow) == 'istat') sdmxMapperData = mapSDMX_dataIstat;\r\n  const accParams = {\r\n    FUSION: {\r\n      Accept: 'application/vnd.sdmx.data+json;version=1.0.0',\r\n      'Accept-Language': getLocale(configArgs),\r\n    },\r\n    EUROSTAT: {\r\n      Accept: 'application/vnd.sdmx.data+json;version=1.0.0-wd',\r\n    },\r\n    istat: {\r\n      Accept: 'application/json',\r\n    },\r\n  };\r\n  const acceptParam = accParams[R.prop('backendId', configArgs.dataflow)];\r\n\r\n  return axios\r\n    .get(url, {\r\n      params: R.mergeRight({ dimensionAtObservation: 'AllDimensions' }, requestArgs),\r\n      headers: R.cond([\r\n        [\r\n          R.always(R.prop('hasRangeHeader', datasource)),\r\n          R.assoc('Range', `values=${R.head(sdmxRange)}-${R.last(sdmxRange)}`),\r\n        ],\r\n        [R.T, R.identity],\r\n      ])(acceptParam),\r\n    })\r\n    .then(R.pipe(sdmxMapperData, rules.v8Transformer));\r\n};\r\n\r\nconst getDataFile = ({ configArgs, requestArgs }) => {\r\n  const { url } = getConfig({ type: 'data' })({ configArgs });\r\n\r\n  if (requestArgs.lastnobservations) {\r\n    requestArgs.lastnobservations = 1;\r\n  } else {\r\n    delete requestArgs.lastnobservations;\r\n  }\r\n\r\n  let accept = 'application/vnd.sdmx.data+csv;file=true';\r\n  /*\r\n  Re enable to have the labels only csv\r\n  if (configArgs.dataflow.backendId && configArgs.dataflow.backendId == 'FUSION') {\r\n    requestArgs['format'] = 'csv';\r\n    requestArgs['labels'] = 'name';\r\n    accept = '';\r\n  }\r\n  */\r\n\r\n  return axios\r\n    .get(url, {\r\n      params: requestArgs,\r\n      headers: {\r\n        Accept: accept,\r\n        'Accept-Language': getLocale(configArgs),\r\n      },\r\n      responseType: 'blob',\r\n    })\r\n    .then(response => {\r\n      const blob = new Blob([R.prop('data')(response)], {\r\n        type: R.pathOr('text/csv', ['headers', 'content-type'])(response),\r\n      });\r\n      FileSaver.saveAs(blob, `${getFilename(configArgs)}.csv`);\r\n    });\r\n};\r\n\r\nconst getExcelDataFile = ({ configArgs, requestArgs, layout, timeDimensionInverted }) => {\r\n  const { url, datasource } = getConfig({ type: 'data' })({ configArgs });\r\n\r\n  if (requestArgs.lastnobservations) {\r\n    requestArgs.lastnobservations = 1;\r\n  } else {\r\n    delete requestArgs.lastnobservations;\r\n  }\r\n\r\n  return (\r\n    axios\r\n      .get(url, {\r\n        params: R.mergeRight({ dimensionAtObservation: 'AllDimensions' }, requestArgs),\r\n        headers: R.cond([\r\n          [\r\n            R.always(R.prop('hasRangeHeader', datasource)),\r\n            R.assoc('Range', `values=${R.head(sdmxRange)}-${R.last(sdmxRange)}`),\r\n          ],\r\n          [R.T, R.identity],\r\n        ])({\r\n          Accept: 'application/vnd.sdmx.data+json;version=1.0.0',\r\n          'Accept-Language': getLocale(configArgs),\r\n        }),\r\n      })\r\n      //.then(R.pipe(R.prop('data'), rules.v8Transformer));\r\n      .then(response => {\r\n        generateExcel(response.data, layout, timeDimensionInverted).then(response => {\r\n          const blob = new Blob([response], { type: 'application/vnd.ms-excel' });\r\n          //FileSaver.saveAs(blob, `data.xlsx`);\r\n          var yStart = '';\r\n          var yEnd = '';\r\n          if (requestArgs.startPeriod) yStart = requestArgs.startPeriod;\r\n          if (requestArgs.endPeriod) yEnd = requestArgs.endPeriod;\r\n          FileSaver.saveAs(blob, `${configArgs.dataflow.dataflowId}_${yStart}-${yEnd}.xlsx`);\r\n        });\r\n      })\r\n  );\r\n};\r\n\r\nconst getExcelDataFileLong = ({ configArgs, requestArgs }) => {\r\n  const { url } = getConfig({ type: 'data' })({ configArgs });\r\n\r\n  if (requestArgs.lastnobservations) {\r\n    requestArgs.lastnobservations = 1;\r\n  } else {\r\n    delete requestArgs.lastnobservations;\r\n  }\r\n\r\n  let accept = 'application/vnd.sdmx.data+csv;file=true';\r\n\r\n  if (configArgs.dataflow.backendId && configArgs.dataflow.backendId == 'FUSION') {\r\n    requestArgs['format'] = 'csv';\r\n    requestArgs['labels'] = 'name';\r\n    accept = '';\r\n  }\r\n\r\n  return axios\r\n    .get(url, {\r\n      params: requestArgs,\r\n      headers: {\r\n        Accept: accept,\r\n        'Accept-Language': getLocale(configArgs),\r\n      },\r\n      responseType: 'utf8',\r\n    })\r\n    .then(response => {\r\n      generateExcelLong(response.data).then(response => {\r\n        const blob = new Blob([response], { type: 'application/vnd.ms-excel' });\r\n        //FileSaver.saveAs(blob, `data.xlsx`);\r\n        var yStart = '';\r\n        var yEnd = '';\r\n        if (requestArgs.startPeriod) yStart = requestArgs.startPeriod;\r\n        if (requestArgs.endPeriod) yEnd = requestArgs.endPeriod;\r\n        FileSaver.saveAs(blob, `${configArgs.dataflow.dataflowId}_${yStart}-${yEnd}.xlsx`);\r\n      });\r\n    });\r\n};\r\n\r\n//Is any mapping needed for Fusion?\r\n//The getDataflows method has been implemented working with fusion map eurostat id needed\r\nconst sdmxMapperDataflows = dataflows => {\r\n  //No mapping needed for Fusion, just return\r\n  return dataflows;\r\n};\r\n\r\n//Is any mapping needed for Fusion?\r\n//The getHierarchy method has been implemented working with fusion map eurostat if needed\r\nconst sdmxMapperHierarchy = hierarchy => {\r\n  //No mapping needed for Fusion, just return\r\n  return hierarchy.data;\r\n};\r\n\r\nconst getDataflows = ({ configArgs }) => {\r\n  const { url, datasource } =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION'\r\n      ? getDataflowsConfig({ configArgs })\r\n      : getConfig({ type: 'dataflows' })({ configArgs });\r\n\r\n  return axios\r\n    .get(url, {\r\n      params: {\r\n        format: 'sdmx-json',\r\n        detail: 'full',\r\n        references: 'children',\r\n        includeMetadata: true,\r\n        /*includeMetrics: false,*/\r\n        /*includeAllAnnotations: false,*/\r\n      },\r\n      headers: { Accept: 'application/json', 'Accept-Language': getLocale(configArgs) },\r\n    })\r\n    .then(R.pipe(sdmxMapperDataflows, dataflowsParser));\r\n};\r\n\r\nconst getHierarchy = ({ configArgs }) => {\r\n  const url = getHierarchyUrl({ configArgs });\r\n  return axios\r\n    .get(url, {\r\n      params: {\r\n        format: 'sdmx-json',\r\n        detail: 'full',\r\n        references: 'children',\r\n      },\r\n      headers: { Accept: 'application/json', 'Accept-Language': getLocale(configArgs) },\r\n    })\r\n    .then(R.pipe(sdmxMapperHierarchy, hierarchyParser));\r\n};\r\n\r\nconst getMap = ({ url }) => {\r\n  return axios\r\n    .get(url, {\r\n      params: {},\r\n      headers: {},\r\n    })\r\n    .then(data => {\r\n      return data.data;\r\n    });\r\n};\r\n\r\nconst methods = {\r\n  getStructure,\r\n  getData,\r\n  getDataFile,\r\n  getDataflows,\r\n  getHierarchy,\r\n  getExcelDataFile,\r\n  getExcelDataFileLong,\r\n  getMap,\r\n};\r\n\r\nconst error = method => () => {\r\n  throw new Error(`Unkown method: ${method}`);\r\n};\r\nconst main = ({ method, ...rest }) => (methods[method] || error(method))(rest);\r\nR.compose(R.forEach(([name, fn]) => (main[name] = fn)), R.toPairs)(methods);\r\n\r\nexport default main;\r\n","import * as R from 'ramda';\r\nimport {\r\n  getDataflow,\r\n  getPeriod,\r\n  getLastnobservations,\r\n  getLayout,\r\n  getTimeDimensionInverted,\r\n} from '../selectors/vis';\r\nimport { getLocale } from '../selectors/app';\r\nimport { getDataquery } from '../selectors/sdmx';\r\nimport sdmxApi from '../api/sdmx';\r\nimport { changeLayout, OVERRIDE_DATAQUERY } from './vis';\r\nimport { setPending, pushLog, LOG_ERROR } from './app';\r\nimport { getDimensions } from '../selectors/sdmx';\r\n\r\nconst isDev = process.env.NODE_ENV === 'development';\r\n\r\n//-----------------------------------------------------------------------------------------constants\r\nexport const HANDLE_STRUCTURE = '@@sdmx/HANDLE_STRUCTURE';\r\nexport const HANDLE_DATA = '@@sdmx/HANDLE_DATA';\r\nexport const HANDLE_DATAFLOWS = '@@sdmx/HANDLE_DATAFLOWS';\r\nexport const HANDLE_HIERARCHY = '@@sdmx/HANDLE_HIERARCHY';\r\nexport const HANDLE_MAP = '@@sdmx/HANDLE_MAP';\r\nexport const CHANGE_MAP_FILTERS = '@@vis/sdmx/CHANGE_MAP_FILTERS';\r\n\r\n//--------------------------------------------------------------------------------------thunks (api)\r\nconst request = (dispatch, ctx) => {\r\n  const { method } = ctx;\r\n  const pendingId = ctx.pendingId || method;\r\n\r\n  // eslint-disable-next-line no-console\r\n  if (isDev) console.info(`request: ${pendingId}`);\r\n\r\n  dispatch(setPending(pendingId, true));\r\n  return sdmxApi(ctx)\r\n    .then(res => {\r\n      dispatch(setPending(pendingId));\r\n      return res;\r\n    })\r\n    .catch(error => {\r\n      const log = error.response\r\n        ? { method, errorCode: error.response.data.errorCode, statusCode: error.response.status }\r\n        : { method, error };\r\n\r\n      dispatch(setPending(pendingId));\r\n      dispatch(pushLog({ type: LOG_ERROR, payload: { log } }));\r\n\r\n      // required to break the promised chain\r\n      throw error;\r\n    });\r\n};\r\n\r\n/*\r\nThis method tries to fix a wrong dataquery param:\r\nThe user selected a code that is not available in the dimension, instead of showing a \"No data\" error it removes the code from the selection\r\n*/\r\nconst cleanDataQueryAgainstStructure = (dataquery, dims) => {\r\n  if (!dataquery || dataquery == '') return dataquery;\r\n\r\n  // R.getIndex\r\n\r\n  let dqParts = dataquery.split('.');\r\n\r\n  for (let i = 0; i < dqParts.length; i++) {\r\n    if (dims[i] && dims[i].forced && dims[i].forced != null) dqParts[i] = dims[i].forced;\r\n\r\n    if (dqParts[i] == '') continue;\r\n    if (!dims[i] || !dims[i].values) continue; //Just to avoid breaking if some dots are accidentally added at the end\r\n    var dimCodes = dqParts[i].split('+');\r\n\r\n    // const dimCodes = dqParts[i].split('+');\r\n    for (let c = dimCodes.length - 1; c >= 0; c--) {\r\n      const found = dims[i].values.some(code => code.id == dimCodes[c]);\r\n      if (!found) {\r\n        dimCodes.splice(c, 1);\r\n      }\r\n    }\r\n    dqParts[i] = dimCodes.join('+');\r\n  }\r\n\r\n  return dqParts.join('.');\r\n};\r\n\r\nexport const requestStructure = ({ shouldRequestStructure }) => (dispatch, getState) => {\r\n  if (R.not(shouldRequestStructure)) return Promise.resolve();\r\n\r\n  const configArgs = {\r\n    locale: getLocale(getState()),\r\n    dataflow: getDataflow(getState()),\r\n  };\r\n  return request(dispatch, { method: 'getStructure', configArgs }).then(structure => {\r\n    dispatch({ type: HANDLE_STRUCTURE, structure });\r\n  });\r\n};\r\n\r\nexport const requestData = ({ shouldRequestStructure } = {}) => (dispatch, getState) => {\r\n  requestStructure({ shouldRequestStructure })(dispatch, getState).then(() => {\r\n    const requestArgs = {\r\n      startPeriod: R.head(getPeriod(getState())),\r\n      endPeriod: R.last(getPeriod(getState())),\r\n      lastnobservations: getLastnobservations(getState()),\r\n    };\r\n    const dataquery = cleanDataQueryAgainstStructure(\r\n      getDataquery(getState()),\r\n      getDimensions(getState()),\r\n    );\r\n    const dataflow = getDataflow(getState());\r\n    const configArgs = {\r\n      locale: getLocale(getState()),\r\n      dataflow,\r\n      dataquery,\r\n    };\r\n\r\n    const dims = getDimensions(getState());\r\n\r\n    const layout_annotation_to_array = title => {\r\n      if (title.trim().length == 0) return null;\r\n      return title\r\n        .trim()\r\n        .replace(' ', '')\r\n        .split(',');\r\n    };\r\n    const initialLayout = structure => {\r\n      let df_annot = R.pathOr([], ['sdmx', 'dataflowAnnotations'])(structure);\r\n\r\n      let rows = [];\r\n      let headers = [];\r\n      let sections = [];\r\n      //No default layout\r\n      if (df_annot.length == 0) {\r\n        headers.push('TIME_PERIOD');\r\n        structure.sdmx.dimensions.forEach(d => {\r\n          rows.push(d.id);\r\n        });\r\n      } else {\r\n        df_annot.forEach(a => {\r\n          if (a.title) {\r\n            var title = layout_annotation_to_array(a.title);\r\n            if (title) {\r\n              if (a.type == 'LAYOUT_ROW') rows = rows.concat(title);\r\n              else if (a.type == 'LAYOUT_COLUMN') headers = headers.concat(title);\r\n              if (a.type == 'LAYOUT_ROW_SECTION') sections = sections.concat(title);\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      let ret = {};\r\n      if (rows.length > 0) {\r\n        ret['rows'] = rows;\r\n      }\r\n      if (headers.length > 0) {\r\n        ret['header'] = headers;\r\n      }\r\n      if (sections.length > 0) {\r\n        ret['sections'] = sections;\r\n      }\r\n\r\n      return ret;\r\n    };\r\n\r\n    dispatch({ type: OVERRIDE_DATAQUERY, dataquery });\r\n    return request(dispatch, { method: 'getData', configArgs, requestArgs, dims })\r\n      .then(({ data, layout }) => {\r\n        layout = initialLayout(getState());\r\n        dispatch(changeLayout(layout));\r\n\r\n        // UNICEF specific\r\n        document.getElementById('root').dispatchEvent(\r\n          new CustomEvent('unicef_dataflowLoaded', {\r\n            detail: {\r\n              dataflow,\r\n              data,\r\n              dataquery,\r\n              requestArgs,\r\n            },\r\n          }),\r\n        );\r\n\r\n        dispatch({ type: HANDLE_DATA, data, layout });\r\n        document.getElementById('root').dispatchEvent(new CustomEvent('data_loaded'));\r\n      })\r\n      .catch(error => {\r\n        let nodata = null;\r\n        let nolayout = null;\r\n        dispatch({ type: HANDLE_DATA, nodata, nolayout });\r\n      });\r\n  });\r\n};\r\n\r\nexport const requestDataFile = ({ isDownloadAllData, dataflow } = {}) => (dispatch, getState) => {\r\n  const requestArgs = isDownloadAllData\r\n    ? {}\r\n    : {\r\n        startPeriod: R.head(getPeriod(getState())),\r\n        endPeriod: R.last(getPeriod(getState())),\r\n        lastnobservations: getLastnobservations(getState()),\r\n      };\r\n  const configArgs = R.cond([\r\n    [R.always(R.not(isDownloadAllData)), R.assoc('dataquery', getDataquery(getState()))],\r\n    [R.T, R.identity],\r\n  ])({\r\n    locale: getLocale(getState()),\r\n    dataflow,\r\n  });\r\n  const pendingId = R.ifElse(\r\n    R.has('id'),\r\n    R.pipe(R.prop('id'), id => `getDataFile/${id}`),\r\n    R.always('requestingDataFile'),\r\n  )(dataflow);\r\n  return request(dispatch, { method: 'getDataFile', configArgs, requestArgs, pendingId });\r\n};\r\n\r\nexport const requestExcelDataFile = ({ isDownloadAllData, dataflow } = {}) => (\r\n  dispatch,\r\n  getState,\r\n) => {\r\n  const requestArgs = isDownloadAllData\r\n    ? {}\r\n    : {\r\n        startPeriod: R.head(getPeriod(getState())),\r\n        endPeriod: R.last(getPeriod(getState())),\r\n        lastnobservations: getLastnobservations(getState()),\r\n      };\r\n  const configArgs = R.cond([\r\n    [R.always(R.not(isDownloadAllData)), R.assoc('dataquery', getDataquery(getState()))],\r\n    [R.T, R.identity],\r\n  ])({\r\n    locale: getLocale(getState()),\r\n    dataflow,\r\n  });\r\n  const pendingId = R.ifElse(\r\n    R.has('id'),\r\n    R.pipe(R.prop('id'), id => `getDataFile/${id}`),\r\n    R.always('requestingDataFile'),\r\n  )(dataflow);\r\n  const layout = getLayout(getState());\r\n  const timeDimensionInverted = getTimeDimensionInverted(getState())['TIME_PERIOD'];\r\n\r\n  return request(dispatch, {\r\n    method: 'getExcelDataFile',\r\n    configArgs,\r\n    requestArgs,\r\n    pendingId,\r\n    layout,\r\n    timeDimensionInverted,\r\n  });\r\n};\r\n\r\nexport const requestExcelDataFileLong = ({ isDownloadAllData, dataflow } = {}) => (\r\n  dispatch,\r\n  getState,\r\n) => {\r\n  const requestArgs = isDownloadAllData\r\n    ? {}\r\n    : {\r\n        startPeriod: R.head(getPeriod(getState())),\r\n        endPeriod: R.last(getPeriod(getState())),\r\n        lastnobservations: getLastnobservations(getState()),\r\n      };\r\n  const configArgs = R.cond([\r\n    [R.always(R.not(isDownloadAllData)), R.assoc('dataquery', getDataquery(getState()))],\r\n    [R.T, R.identity],\r\n  ])({\r\n    locale: getLocale(getState()),\r\n    dataflow,\r\n  });\r\n  const pendingId = R.ifElse(\r\n    R.has('id'),\r\n    R.pipe(R.prop('id'), id => `getDataFile/${id}`),\r\n    R.always('requestingDataFile'),\r\n  )(dataflow);\r\n  return request(dispatch, { method: 'getExcelDataFileLong', configArgs, requestArgs, pendingId });\r\n};\r\n\r\nexport const requestDataflows = () => (dispatch, getState) => {\r\n  const configArgs = {\r\n    locale: getLocale(getState()),\r\n    dataflow: getDataflow(getState()),\r\n  };\r\n  return request(dispatch, { method: 'getDataflows', configArgs }).then(dataflows => {\r\n    dispatch({ type: HANDLE_DATAFLOWS, dataflows });\r\n  });\r\n};\r\n\r\nexport const requestHierachy = h => (dispatch, getState) => {\r\n  const configArgs = h;\r\n  return request(dispatch, { method: 'getHierarchy', configArgs }).then(hierarchy => {\r\n    dispatch({ type: HANDLE_HIERARCHY, hierarchy });\r\n  });\r\n};\r\n\r\nexport const requestMap = url => (dispatch, getState) => {\r\n  return request(dispatch, { method: 'getMap', url }).then(map => {\r\n    dispatch({ type: HANDLE_MAP, map });\r\n  });\r\n};\r\n\r\nexport const change_map_filters = filters => ({\r\n  type: CHANGE_MAP_FILTERS,\r\n  payload: { filters },\r\n});\r\n\r\n//-------------------------------------------------------------------------------------------reducer\r\n/*After a filter change, try to keep the old map filters selection\r\n-> user selects sex:F, then adds an indicator to the sdmx data query, try to reselect sex=F\r\nIf there is no previous selection or the new selection has different code try to select the total:_T*/\r\n\r\nconst map_filters_state_helper = (state, action) => {\r\n  if (typeof action.data == 'undefined') return {};\r\n\r\n  let ret = {};\r\n\r\n  action.data.structure.dimensions.observation.forEach(d => {\r\n    if (state.map_selection.hasOwnProperty(d.id)) {\r\n      let currSel = state.map_selection[d.id];\r\n      if (d.values.findIndex(x => x.id === currSel) != -1) {\r\n        ret[d.id] = currSel;\r\n      } else ret[d.id] = d.values[0].id;\r\n    } else {\r\n      //Assign the fist element and then try to look for a _T\r\n      ret[d.id] = d.values[0].id;\r\n      for (var i = 0; i < d.values.length; i++) {\r\n        if (d.values[i].id == '_T') {\r\n          ret[d.id] = d.values[i].id;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  });\r\n  return ret;\r\n};\r\nexport default (state = {}, action = {}) => {\r\n  let new_filter_map_state = null;\r\n  if (action.type == HANDLE_DATA) new_filter_map_state = map_filters_state_helper(state, action);\r\n\r\n  switch (action.type) {\r\n    case HANDLE_STRUCTURE:\r\n      //return R.set(R.lensProp('dimensions'), R.path(['structure', 'dimensions'], action), state);\r\n      return R.pipe(\r\n        R.set(R.lensProp('dimensions'), R.path(['structure', 'dimensions'], action)),\r\n        R.set(\r\n          R.lensProp('dataflowAnnotations'),\r\n          R.path(['structure', 'dataflowAnnotations'], action),\r\n        ),\r\n      )(state);\r\n    case HANDLE_DATA:\r\n      return R.pipe(\r\n        R.set(R.lensProp('data'), R.prop('data', action)),\r\n        R.set(R.lensProp('layout'), R.prop('layout', action)),\r\n\r\n        R.set(R.lensProp('map_selection'), new_filter_map_state),\r\n      )(state);\r\n    case HANDLE_DATAFLOWS:\r\n      return R.set(R.lensProp('dataflows'), R.prop('dataflows', action), state);\r\n    case HANDLE_HIERARCHY:\r\n      return R.set(R.lensProp('hierarchy'), R.prop('hierarchy', action), state);\r\n    case HANDLE_MAP:\r\n      return R.set(R.lensProp('map'), R.prop('map', action), state);\r\n    case CHANGE_MAP_FILTERS:\r\n      return {\r\n        ...state,\r\n        map_selection: R.set(\r\n          R.lensProp(action.payload.filter.id),\r\n          action.payload.filter.val,\r\n          state.map_selection,\r\n        ),\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { combineReducers } from 'redux';\r\nimport app from '../ducks/app';\r\nimport vis from '../ducks/vis';\r\nimport sdmx from '../ducks/sdmx';\r\n\r\nexport default combineReducers({ app, sdmx, vis });\r\n","import * as R from 'ramda';\r\nimport {\r\n  CHANGE_DATAQUERY,\r\n  CHANGE_DATAQUERY_ADD_FILTERS,\r\n  CHANGE_PERIOD,\r\n  CHANGE_DATAFLOW,\r\n  CHANGE_LASTNOBS,\r\n  LOAD_DATAFLOWS,\r\n  LOAD_HIERARCHY,\r\n  LOAD_MAP,\r\n} from '../ducks/vis';\r\nimport { requestData, requestDataflows, requestHierachy, requestMap } from '../ducks/sdmx';\r\n\r\nconst isDev = process.env.NODE_ENV === 'development';\r\n\r\nexport const requestDataMiddleware = ({ dispatch }) => next => action => {\r\n  const future = next(action);\r\n\r\n  if (\r\n    R.pipe(\r\n      R.prop('type'),\r\n      R.flip(R.includes)([\r\n        CHANGE_DATAQUERY,\r\n        CHANGE_DATAQUERY_ADD_FILTERS,\r\n        CHANGE_PERIOD,\r\n        CHANGE_LASTNOBS,\r\n      ]),\r\n    )(action)\r\n  ) {\r\n    // eslint-disable-next-line no-console\r\n    if (isDev) console.info(`requestDataMiddleware: ${action.type}`);\r\n\r\n    dispatch(requestData());\r\n  }\r\n\r\n  if (R.pipe(R.prop('type'), R.flip(R.includes)([CHANGE_DATAFLOW]))(action)) {\r\n    // eslint-disable-next-line no-console\r\n    if (isDev) console.info(`requestStructureMiddleware: ${action.type}`);\r\n\r\n    dispatch(requestData({ shouldRequestStructure: true }));\r\n  }\r\n\r\n  if (action.type == LOAD_DATAFLOWS) {\r\n    if (isDev) console.info(`requestStructureMiddleware: ${action.type}`);\r\n    dispatch(requestDataflows());\r\n  }\r\n\r\n  if (action.type == LOAD_HIERARCHY) {\r\n    if (isDev) console.info(`requestHierarchyMiddleware: ${action.type}`);\r\n    dispatch(requestHierachy(action.payload));\r\n  }\r\n\r\n  if (action.type == LOAD_MAP) {\r\n    if (isDev) console.info(`requestMapMiddleware: ${action.type}`);\r\n    dispatch(requestMap(action.payload));\r\n  }\r\n\r\n  return future;\r\n};\r\n","import { createStore, applyMiddleware, compose } from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport { createLogger } from 'redux-logger';\r\nimport { requestDataMiddleware } from './middlewares';\r\n\r\nexport const withLogger = middlewares => {\r\n  if (process.env.NODE_ENV === 'production') return middlewares;\r\n\r\n  const logger = createLogger({\r\n    duration: true,\r\n    timestamp: false,\r\n    collapsed: true,\r\n    diff: true,\r\n  });\r\n\r\n  return [...middlewares, logger];\r\n};\r\n\r\nexport default (initialState = {}, rootReducer) => {\r\n  const middlewares = [thunk, requestDataMiddleware];\r\n\r\n  const enhancers = [applyMiddleware(...withLogger(middlewares))];\r\n\r\n  const store = createStore(rootReducer, initialState, compose(...enhancers));\r\n\r\n  return store;\r\n};\r\n","import { createMuiTheme } from '@material-ui/core/styles';\r\n\r\nexport const Colors = {\r\n  GREY1: '#F0F0F0',\r\n  GREY2: '#CCCCCC',\r\n  GREY3: '#494444',\r\n  GREY4: '#A4A1A1',\r\n  GREY5: '#666666',\r\n  BLUE1: '#2973BD',\r\n  BLUE2: '#0965C1',\r\n  BLUE3: '#2F75B5',\r\n  BLUE4: '#BDD7EE',\r\n  BLUE5: '#DDEBF7',\r\n  BLUE6: '#1E226A',\r\n  WHITE1: '#FFFFFF',\r\n  BLACK1: '#000000',\r\n  GREEN1: '#8CC841',\r\n  ORANGE: '#f7a32c',\r\n};\r\n\r\nexport const FontSizes = {\r\n  SIZE1: 18,\r\n  SIZE2: 14,\r\n  SIZE3: 12,\r\n};\r\n\r\nexport const Formats = {\r\n  WIDE: 'initial',\r\n  NARROW: 400,\r\n  APP: 1000,\r\n  APP_MIN_SIZE: 360,\r\n  ITEM_MIN_SIZE: 350,\r\n};\r\n\r\nexport const Layout = {\r\n  PADDING: '5%',\r\n  SIDE_WIDTH: 300,\r\n  FILTER_MAX_HEIGHT: 250,\r\n};\r\n\r\nexport const theme = (rtl = 'ltr') =>\r\n  createMuiTheme({\r\n    overrides: {\r\n      MuiButton: {\r\n        text: {\r\n          textTransform: 'none',\r\n        },\r\n      },\r\n    },\r\n    palette: {\r\n      primary: {\r\n        main: '#137cbd',\r\n        mainAlpha: '#137cbd26',\r\n        light: '#5dabf0',\r\n        dark: '#00508c',\r\n        contrastText: '#ffffff',\r\n      },\r\n      secondary: {\r\n        main: '#bdd7ee',\r\n        light: '#f0ffff',\r\n        dark: '#8ca6bc',\r\n        contrastText: '#ff0000',\r\n      },\r\n      action: {\r\n        hover: '#bdd7ee',\r\n        selected: '#137cbd',\r\n        active: 'rgba(19,124,189,.3)',\r\n      },\r\n      typography: {\r\n        fontFamily: ['Segoe UI'],\r\n      },\r\n      raisedButton: {\r\n        textColor: '#ffffff',\r\n        primaryTextColor: '#ffffff',\r\n      },\r\n      default: {\r\n        backgroundColor: '#00000026', // grey with alpha\r\n      },\r\n      configLabelBG: '#B5CEEB',\r\n      configLabelCol: '#1C2768',\r\n    },\r\n    app: {\r\n      appSize: Formats.APP,\r\n      appMinSize: Formats.APP_MIN_SIZE,\r\n      itemMinSize: Formats.ITEM_MIN_SIZE,\r\n    },\r\n    scopeListContainer: {\r\n      maxHeight: 250,\r\n    },\r\n    scopeList: {\r\n      divider: '#000000',\r\n    },\r\n    direction: rtl,\r\n    typography: {\r\n      // until v4 https://material-ui.com/style/typography/#migration-to-typography-v2\r\n      useNextVariants: true,\r\n    },\r\n    configLabel: {\r\n      backgroundColor: '#B5CEEB',\r\n      color: '#43679F',\r\n      fontFamily: 'Segoe UI',\r\n      fontSize: 16,\r\n    },\r\n    configButtonRegular: {\r\n      backgroundColor: '#B5CEEB',\r\n      color: '#43679F',\r\n      fontFamily: 'Segoe UI',\r\n      fontSize: 16,\r\n      fontWeight: 'inherit',\r\n      textTransform: 'none',\r\n    },\r\n    configButtonSelected: {\r\n      backgroundColor: '#778899',\r\n      color: '#B5CEEB',\r\n      fontFamily: 'Segoe UI',\r\n      fontSize: 16,\r\n      fontWeight: 'inherit',\r\n      textTransform: 'none',\r\n    },\r\n    panelSummary: {\r\n      backgroundColor: '#137cbd',\r\n      color: 'white',\r\n      fontFamily: 'Segoe UI',\r\n      fontSize: 16,\r\n    },\r\n    panelIcon: {\r\n      color: 'white',\r\n    },\r\n    configInputs: {\r\n      backgroundColor: 'white',\r\n    },\r\n    alert: {\r\n      color: '#c23030',\r\n      hover: {\r\n        backgroundColor: 'rgba(219,55,55,.15)',\r\n      },\r\n      active: {\r\n        backgroundColor: 'rgba(219,55,55,.3)',\r\n      },\r\n    },\r\n    table: {\r\n      yBg: '#B5CEEB',\r\n      yBgHover: '#c3d7ef',\r\n      yBgActive: '#7e90a4',\r\n      yFontHeader: '#1C2768',\r\n      yFont: '#43679F',\r\n      zBg: '#386CAA',\r\n      zBgHover: '#5f89bb',\r\n      zBgActive: '#274b76',\r\n      zFontHeader: '#A2C2E4',\r\n      zFont: Colors.WHITE1,\r\n      xBg: Colors.WHITE1,\r\n      xBgHeader: '#D7E6F4',\r\n      xBgHover: '#dfebf6',\r\n      xBgActive: '#96a1aa',\r\n      xFontHeader: '#1C2768',\r\n      xFont: '#43679F',\r\n      oFont: Colors.GREY3,\r\n      sBg: Colors.GREY1,\r\n    },\r\n  });\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { mergeDeepRight } from 'ramda';\r\nimport { ThemeProvider } from 'glamorous';\r\nimport { mainTheme } from '@sis-cc/dotstatsuite-ui-components';\r\nimport rtl from 'jss-rtl';\r\nimport { create } from 'jss';\r\nimport { MuiThemeProvider } from '@material-ui/core/styles';\r\nimport { theme as muiTheme } from './theme';\r\nimport JssProvider from 'react-jss/lib/JssProvider';\r\nimport { createGenerateClassName, jssPreset } from '@material-ui/core/styles';\r\n\r\n// Configure JSS\r\nconst jss = create({ plugins: [...jssPreset().plugins, rtl()] });\r\n// Custom Material-UI class name generator.\r\nconst generateClassName = createGenerateClassName();\r\n\r\nconst Provider = ({ theme, children, isRtl }) => (\r\n  <JssProvider jss={jss} generateClassName={generateClassName}>\r\n    <MuiThemeProvider theme={muiTheme(isRtl ? 'rtl' : 'ltr')}>\r\n      <ThemeProvider theme={mergeDeepRight(mainTheme, theme)}>\r\n        {React.Children.only(children)}\r\n      </ThemeProvider>\r\n    </MuiThemeProvider>\r\n  </JssProvider>\r\n);\r\n\r\nProvider.propTypes = {\r\n  theme: PropTypes.object,\r\n  children: PropTypes.element.isRequired,\r\n  isRtl: PropTypes.bool,\r\n};\r\n\r\nexport default Provider;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { DELayout, DELayoutContent, DESplash } from '@sis-cc/dotstatsuite-ui-components';\r\nimport logo from '../assets/data-explorer-logo.png';\r\n\r\nclass ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { hasError: false };\r\n  }\r\n\r\n  componentDidCatch() {\r\n    this.setState({ hasError: true });\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.hasError) return this.props.children;\r\n\r\n    if (this.props.isFinal) return <h1>Whoops, something went wrong on our end.</h1>;\r\n\r\n    return (\r\n      <DELayout isHome>\r\n        <DELayoutContent>\r\n          <DESplash title={<FormattedMessage id=\"de.error.title\" />} logo={logo} />\r\n        </DELayoutContent>\r\n      </DELayout>\r\n    );\r\n  }\r\n}\r\n\r\nErrorBoundary.propTypes = {\r\n  children: PropTypes.node,\r\n  isFinal: PropTypes.bool,\r\n};\r\n\r\nexport default ErrorBoundary;\r\n","import React, { Fragment } from 'react';\r\nimport Responsive from 'react-responsive';\r\n\r\nconst Narrow = props => <Responsive {...props} query={`(max-width: ${700}px)`} />;\r\nconst Default = props => <Responsive {...props} query={`(min-width: ${700 + 1}px)`} />;\r\n\r\nexport default Component =>\r\n  class extends React.Component {\r\n    render = () => (\r\n      <Fragment>\r\n        <Narrow>\r\n          <Component {...this.props} isNarrow />\r\n        </Narrow>\r\n        <Default>\r\n          <Component {...this.props} />\r\n        </Default>\r\n      </Fragment>\r\n    );\r\n  };\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps, pure } from 'recompose';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { DEFilterPeriod } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { changePeriod } from '../../ducks/vis';\r\nimport { getPeriod } from '../../selectors/vis';\r\nimport { sdmxPeriodBoundariesMinMax, sdmxPeriodBoundaries } from '../../lib/settings';\r\n\r\nexport default compose(\r\n  connect(createStructuredSelector({ period: getPeriod }), { changePeriod }),\r\n  withProps({\r\n    //titleLabel: <FormattedMessage id=\"de.filter.period.title\" />,\r\n    titleLabel: '',\r\n    //tagLabel: <FormattedMessage id=\"de.filter.period.tag\" values={sdmxPeriodBoundariesMinMax} />,\r\n    tagLabel: '',\r\n    periodBoundaries: sdmxPeriodBoundaries,\r\n    options: { ...sdmxPeriodBoundariesMinMax, labelStepSize: 10 },\r\n  }),\r\n  pure,\r\n)(DEFilterPeriod);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps, pure } from 'recompose';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { VXFiltersCurrent } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { changeDataquery } from '../../ducks/vis';\r\nimport { getSelection } from '../../selectors/sdmx';\r\n\r\nexport default compose(\r\n  connect(createStructuredSelector({ items: getSelection }), { changeFilters: changeDataquery }),\r\n  withProps({\r\n    titleLabel: <FormattedMessage id=\"vx.filters.current.title\" />,\r\n    clearAllLabel: <FormattedMessage id=\"vx.filters.current.clear\" />,\r\n    blankLabel: <FormattedMessage id=\"vx.filters.current.blank\" />,\r\n    noScroll: true,\r\n  }),\r\n  pure,\r\n)(VXFiltersCurrent);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps, pure } from 'recompose';\r\nimport * as R from 'ramda';\r\nimport { injectIntl } from 'react-intl';\r\nimport {\r\n  spotlightScopeListEngine,\r\n  VXScopeList,\r\n  VXSpotlight,\r\n} from '@sis-cc/dotstatsuite-ui-components';\r\nimport { changeFilter, changeDataquery } from '../../ducks/vis';\r\nimport { getFilter } from '../../selectors/vis';\r\nimport { getFilters } from '../../selectors/sdmx';\r\n\r\nconst Filter = pure(VXScopeList);\r\n\r\nexport default compose(\r\n  injectIntl,\r\n  connect(createStructuredSelector({ filters: getFilters, activePanelId: getFilter }), {\r\n    changeSelection: changeDataquery,\r\n    onChangeActivePanel: changeFilter,\r\n  }),\r\n  withProps(({ intl }) => ({\r\n    optionsSpotlight: {\r\n      hasClearAll: true,\r\n      mainPlaceholder: intl.formatMessage({ id: 'vx.spotlight.placeholder.primary' }),\r\n      secondaryPlaceholder: intl.formatMessage({ id: 'vx.spotlight.placeholder.secondary' }),\r\n    },\r\n    spotlight: {\r\n      engine: spotlightScopeListEngine,\r\n      placeholder: intl.formatMessage({ id: 'vx.spotlight.placeholder' }),\r\n      fields: {\r\n        'vx.spotlight.field.label': {\r\n          id: 'vx.spotlight.field.label',\r\n          accessor: R.pipe(R.propOr(null, 'label'), R.ifElse(R.isNil, R.always(''), R.identity)),\r\n          isSelected: true,\r\n        },\r\n      },\r\n    },\r\n    topElementComponent: values => (R.gte(R.length(values), 8) ? VXSpotlight : null),\r\n  })),\r\n  pure,\r\n)(({ topElementComponent, filters, ...parentProps }) =>\r\n  R.map(\r\n    ({ id, label, values }) => (\r\n      <Filter\r\n        {...parentProps}\r\n        id={id}\r\n        key={id}\r\n        label={label}\r\n        items={values}\r\n        TopElementComponent={topElementComponent(values)}\r\n      />\r\n    ),\r\n    filters,\r\n  ),\r\n);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { CHANGE_LASTNOBS } from '../../ducks/vis';\r\n\r\nclass Lastnobs extends React.Component {\r\n  render() {\r\n    return (\r\n      <div className=\"div_lastnobs\">\r\n        <label>\r\n          <input\r\n            name=\"lastnobs\"\r\n            type=\"checkbox\"\r\n            checked={this.props.lastnobs}\r\n            onChange={() => this.props.changeLastnobs(!this.props.lastnobs)}\r\n          />\r\n          <FormattedMessage id=\"de.filter.period.lastnobs\" />\r\n        </label>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nLastnobs.propTypes = {\r\n  lastnobs: PropTypes.bool,\r\n  changeLastnobs: PropTypes.func,\r\n};\r\n\r\nconst withProps = state => {\r\n  let lastn = false;\r\n  if (state.vis && state.vis.lastnobservations) {\r\n    lastn = true;\r\n  }\r\n  return {\r\n    lastnobs: lastn,\r\n  };\r\n};\r\n\r\nfunction mapDispatchToProps(dispatch, props) {\r\n  return {\r\n    changeLastnobs: lastnobs =>\r\n      dispatch({\r\n        type: CHANGE_LASTNOBS,\r\n        payload: { lastnobservations: lastnobs },\r\n      }),\r\n  };\r\n}\r\n\r\nexport default connect(withProps, mapDispatchToProps)(Lastnobs);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport { getSelection, getDataflows } from '../../selectors/sdmx';\r\nimport { getDataflow, getPeriod } from '../../selectors/vis';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\n//build the selection for each dimension e.g. REF_AREA = AFG+ITA\r\nconst dim_selection = (df_id, dim, selection) => {\r\n  if (!selection) return '';\r\n\r\n  //is it there a selection for the dimension?\r\n  let sel = selection.filter(s => s.id == dim);\r\n  if (sel.length == 0) return ''; //no-> return\r\n\r\n  return sel[0].values.map(elem => elem.id).join('+');\r\n};\r\n\r\n//creates the link to the specific sector's dataflow\r\nconst createLink = (df_id, dataflow, selection, period, stickyDims) => {\r\n  //build the dataquery, for each dimension compose the list of selected codes (AFG+ITA.U5MR._T)\r\n  let dq = [];\r\n\r\n  dataflow.dimensions.forEach(dim => {\r\n    //The sticky behaviour is applied only to a limited set of dims\r\n    if (stickyDims.indexOf(dim) >= 0) {\r\n      //build the selection\r\n      dq.push(dim_selection(df_id, dim, selection));\r\n    } else {\r\n      dq.push('');\r\n    }\r\n  });\r\n\r\n  //get the first part of the url\r\n  let oldUrl = window.location.href.split('?')[0];\r\n  let ret = oldUrl + `?ag=${dataflow.agencyID}&df=${dataflow.id}&ver=${dataflow.version}`;\r\n\r\n  ret = ret + `&dq=${dq.join('.')}`;\r\n  ret = ret + `&startPeriod=${period[0]}&endPeriod=${period[1]}`;\r\n\r\n  return ret;\r\n};\r\n\r\n//The user selected an indicator, is it also contained in another Dataflow? (Selected node's parent == DATAFLOW_ID?)\r\nconst containsIndicators = (df_id, selItems) => {\r\n  if (!selItems) return false;\r\n  //If the selection does not contain an indicator return\r\n  const indDim = selItems.filter(ind => ind.id == 'INDICATOR');\r\n  if (indDim.length == 0) return false;\r\n\r\n  //if the parent id == the dataflow we're creating the link for then return true\r\n  for (let i = 0; i < indDim[0].values.length; i++) {\r\n    if (indDim[0].values[i].parentId == df_id) {\r\n      return true;\r\n    }\r\n    //Parent!=DataflowID exception handling\r\n    if (indDim[0].values[i].parentId == 'WS') {\r\n      if (indDim[0].values[i].id.startsWith('WS_HCF') && df_id == 'WASH_HEALTHCARE_FACILITY')\r\n        return true;\r\n      if (indDim[0].values[i].id.startsWith('WS_PPL') && df_id == 'WASH_HOUSEHOLDS') return true;\r\n      if (indDim[0].values[i].id.startsWith('WS_SCH') && df_id == 'WASH_SCHOOLS') return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\nconst isOnEvidence = (df_id, on_evidence) => {\r\n  if (!on_evidence) return null;\r\n  for (let i = 0; i < on_evidence.length; i++)\r\n    if (df_id == on_evidence[i].id) {\r\n      return on_evidence[i];\r\n    }\r\n  return null;\r\n};\r\n\r\n//A custom sort function: sorts the dataflows array keeping the ones onEvidence on top.\r\nconst dataflows_sort = (toSort, onEvidence) => {\r\n  toSort.sort(function(a, b) {\r\n    if (onEvidence.includes(a.id)) {\r\n      return -1;\r\n    }\r\n    if (onEvidence.includes(b.id)) {\r\n      return 1;\r\n    } else {\r\n      return a.name > b.name ? 1 : b.name > a.name ? -1 : 0;\r\n    }\r\n  });\r\n};\r\n\r\nconst DataflowNavigator = props => {\r\n  const dataflows = props.dataflows;\r\n\r\n  if (!dataflows) return <div />;\r\n\r\n  //filter/sort dataflows\r\n  const df_keys = [];\r\n  Object.keys(dataflows).forEach(df_key => {\r\n    //add only if the dataflow has been marked as Final\r\n    if (dataflows[df_key].isFinal) {\r\n      df_keys.push({ id: df_key, name: dataflows[df_key].name });\r\n    }\r\n  });\r\n\r\n  dataflows_sort(df_keys, props.dataflowsOnEvidence);\r\n\r\n  //For each dataflow loop the keys\r\n  const items = [];\r\n\r\n  df_keys.forEach(k => {\r\n    const df_key = k['id'];\r\n\r\n    let actionText = <FormattedMessage id=\"de.dataflowNavigator.findMoreData\" />;\r\n    const onEvidence = isOnEvidence(df_key, props.dataflowsOnEvidence);\r\n    if (onEvidence != null && onEvidence.actionText) {\r\n      actionText = onEvidence.actionText;\r\n    }\r\n\r\n    if (\r\n      df_key != props.dataflow.dataflowId &&\r\n      (containsIndicators(df_key, props.selItems) ||\r\n        isOnEvidence(df_key, props.dataflowsOnEvidence) != null)\r\n    ) {\r\n      items.push(\r\n        <div key={df_key} className=\"dfNav_item\">\r\n          <div className=\"dfNav_dfnametop\">{actionText}</div>\r\n          <div className=\"df_nav_dfname\">{dataflows[df_key].name}</div>\r\n          <div className=\"dfNav_link\">\r\n            <a\r\n              className=\"btn button\"\r\n              href={createLink(\r\n                df_key,\r\n                props.dataflows[df_key],\r\n                props.selItems,\r\n                props.period,\r\n                props.stickyDims,\r\n              )}\r\n            >\r\n              Go to dataset\r\n            </a>\r\n          </div>\r\n        </div>,\r\n      );\r\n    }\r\n  });\r\n\r\n  if (items.length == 0) {\r\n    return <div />;\r\n  }\r\n  return <div className=\"TableConfig_wrapper\">{items}</div>;\r\n};\r\n\r\nDataflowNavigator.propTypes = {\r\n  selItems: PropTypes.array,\r\n  dataflow: PropTypes.object,\r\n  dataflows: PropTypes.object,\r\n  period: PropTypes.array,\r\n  dataflowsOnEvidence: PropTypes.array,\r\n  stickyDims: PropTypes.array,\r\n};\r\n\r\nconst withProps = state => {\r\n  return {\r\n    selItems: getSelection(state),\r\n    dataflow: getDataflow(state),\r\n    dataflows: getDataflows(state),\r\n    period: getPeriod(state),\r\n  };\r\n};\r\n\r\nexport default connect(withProps)(DataflowNavigator);\r\n","import React, { Children } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport FilterPeriod from '../FilterPeriod';\r\nimport FilterSelection from '../FilterSelection';\r\nimport Filters from '../Filters';\r\nimport Lastnobs from '../Lastnobs';\r\nimport DataflowNavigator from '../DataflowNavigator';\r\n\r\nimport { VXFilterContainerCollapsible } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { showDataflowNavigator, getStickyDims, getDataflowsOnEvidence } from '../../lib/settings';\r\n\r\n//settings\r\n\r\nclass NarrowFilters extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      isOpen: false,\r\n      dateRangeIsOpen: false,\r\n    };\r\n  }\r\n\r\n  render() {\r\n    var toRender = null;\r\n    if (!this.state.isOpen) {\r\n      toRender = (\r\n        <button\r\n          className=\"narrow_btnOpenFilters\"\r\n          onClick={() => {\r\n            this.setState({ isOpen: true });\r\n          }}\r\n        >\r\n          <span className=\"pt-icon-standard pt-icon-settings\" />\r\n          <FormattedMessage id=\"vx.filters.filterdata\" />\r\n        </button>\r\n      );\r\n    } else {\r\n      toRender = (\r\n        <div>\r\n          <button\r\n            className=\"narrow_btnCloseFilters\"\r\n            onClick={() => {\r\n              this.setState({ isOpen: false });\r\n            }}\r\n          >\r\n            <FormattedMessage id=\"vx.filters.close\" />\r\n          </button>\r\n          {/*this.props.children*/}\r\n\r\n          <VXFilterContainerCollapsible titleLabel=\"Date range\" isOpen={false} noScroll={true}>\r\n            <Lastnobs />\r\n            <div style={this.props.lastnobs_active ? { opacity: 0.4, pointerEvents: 'none' } : {}}>\r\n              <FilterPeriod isNarrow={this.props.isNarrow} isRtl={this.props.isRtl} />\r\n            </div>\r\n          </VXFilterContainerCollapsible>\r\n\r\n          <VXFilterContainerCollapsible titleLabel=\"Disaggregations\" isOpen={false} noScroll={true}>\r\n            <FilterSelection isNarrow={this.props.isNarrow} isRtl={this.props.isRtl} />\r\n            <Filters isNarrow={this.props.isNarrow} isRtl={this.props.isRtl} />\r\n          </VXFilterContainerCollapsible>\r\n          <VXFilterContainerCollapsible\r\n            titleLabel=\"Explore other datasets\"\r\n            isOpen={false}\r\n            noScroll={true}\r\n          >\r\n            {showDataflowNavigator == 1 && (\r\n              <DataflowNavigator\r\n                stickyDims={getStickyDims}\r\n                dataflowsOnEvidence={getDataflowsOnEvidence}\r\n              />\r\n            )}\r\n          </VXFilterContainerCollapsible>\r\n        </div>\r\n      );\r\n    }\r\n    return <div className=\"NarrowFilters\">{toRender}</div>;\r\n  }\r\n}\r\n\r\nNarrowFilters.propTypes = {\r\n  children: PropTypes.array,\r\n  isNarrow: PropTypes.bool,\r\n  isRtl: PropTypes.bool,\r\n  lastnobs_active: PropTypes.bool,\r\n};\r\n\r\nconst withProps = state => {\r\n  return {};\r\n};\r\n\r\nfunction mapDispatchToProps(dispatch, props) {\r\n  return {};\r\n}\r\n\r\nexport default connect(withProps, mapDispatchToProps)(NarrowFilters);\r\n","import * as R from 'ramda';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\n\r\nexport const defaultLayoutBuilder = dimensions => {\r\n  const ids = R.keys(dimensions);\r\n  const timeId = R.find(rules.isTimeDimension)(ids);\r\n  const areaId = R.find(rules.isAreaDimension)(ids);\r\n  const helper = (omitIds, pickId) =>\r\n    R.pipe(\r\n      R.omit(omitIds),\r\n      R.ifElse(R.has(pickId), R.prop(pickId), R.pipe(R.values, R.head)),\r\n      R.prop('id'),\r\n    );\r\n  const x = helper([], areaId)(dimensions);\r\n  const y = helper([areaId, x], timeId)(dimensions);\r\n  const z = R.pipe(R.omit([x, y]), R.values, R.pluck('id'))(dimensions);\r\n\r\n  return {\r\n    rows: R.ifElse(R.isNil, R.always([]), R.flip(R.append)([]))(x),\r\n    header: R.ifElse(R.isNil, R.always([]), R.flip(R.append)([]))(y),\r\n    sections: z,\r\n  };\r\n};\r\n\r\nexport const defaultConcat = (array1 = []) => (array2 = []) => R.concat(array2, array1);\r\nexport const deleteItem = (key, prop) =>\r\n  R.pipe(R.prop(key), R.filter(v => R.not(R.equals(v, prop))));\r\nexport const getValuesFlat = R.pipe(R.values, R.flatten);\r\n\r\nexport const adjustment = R.curry((notAvailableIds, layout) => {\r\n  const withoutNotAvailableIds = R.flip(R.difference)(notAvailableIds);\r\n  if (R.pipe(R.prop('rows'), withoutNotAvailableIds, R.isEmpty)(layout)) {\r\n    const pivot = R.pipe(R.prop('sections'), withoutNotAvailableIds, R.isEmpty)(layout)\r\n      ? 'header'\r\n      : 'sections';\r\n    const id = R.pipe(R.prop(pivot), withoutNotAvailableIds, R.head)(layout);\r\n    return R.pipe(R.assoc('rows', R.concat([id], R.propOr([], 'rows')(layout))), layout => ({\r\n      ...layout,\r\n      [pivot]: deleteItem(pivot, id)(layout),\r\n    }))(layout);\r\n  }\r\n  return layout;\r\n});\r\n\r\nexport const hasInvalidIds = layoutIds => R.pipe(R.flip(R.difference)(layoutIds), R.isEmpty, R.not);\r\nexport const isInvalid = (dimensionIds, layoutIds, layout) =>\r\n  R.or(hasInvalidIds(dimensionIds)(layoutIds), R.isEmpty(layout));\r\n\r\nexport const manyFormat = (format, timeDimensionInverted) =>\r\n  R.mapObjIndexed((dimension, id) => ({\r\n    id,\r\n    isTimePeriod: rules.isTimeDimension(id),\r\n    isTimeDimensionInverted: R.prop(id)(timeDimensionInverted),\r\n    label: format(dimension),\r\n    value: id,\r\n  }));\r\nexport const oneFormat = format =>\r\n  R.mapObjIndexed((dimension, id) => ({\r\n    id,\r\n    label: format(dimension),\r\n    value: id,\r\n    isOne: true,\r\n  }));\r\n\r\nexport const getDefaultLayout = (many, getMissingIds = []) => {\r\n  const defaultLayout = defaultLayoutBuilder(many);\r\n  const defaultMissingIds = R.pipe(getValuesFlat, getMissingIds)(defaultLayout);\r\n  return R.over(R.lensProp('sections'), defaultConcat(defaultMissingIds))(defaultLayout);\r\n};\r\nexport const getLayout = (missingIds, dimensionsIds) =>\r\n  R.pipe(R.over(R.lensProp('sections'), defaultConcat(missingIds)), adjustment(dimensionsIds));\r\n","import { createSelector } from 'reselect';\r\nimport * as R from 'ramda';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nimport { getData, getLayout, getDimensions, getDataLimited, getDataLimitedCount } from './sdmx';\r\nimport { getTimeDimensionInverted, getLayout as getVisLayout, getDimensionFormat } from './vis';\r\nimport { withIndex } from '../lib/utils';\r\nimport * as Layout from '../lib/layout';\r\nimport * as Sdmx from '../lib/sdmx';\r\n\r\nexport const getDataDimensions = () =>\r\n  createSelector(\r\n    getData,\r\n    R.pipe(\r\n      R.pathOr([], ['structure', 'dimensions', 'observation']),\r\n      R.addIndex(R.map)((dimension, index) =>\r\n        R.pipe(\r\n          R.assoc('index', index),\r\n          R.set(R.lensProp('values'), withIndex(R.propOr([], 'values')(dimension))),\r\n        )(dimension),\r\n      ),\r\n    ),\r\n  );\r\n\r\nexport const getVisDataDimensions = () =>\r\n  createSelector(\r\n    getDataDimensions(),\r\n    R.pipe(\r\n      R.partition(R.pipe(R.propOr([], 'values'), R.length, R.flip(R.gt)(1))),\r\n      R.converge(\r\n        (many, one) => ({\r\n          many: R.indexBy(R.prop('id'))(many),\r\n          one: R.indexBy(R.prop('id'))(one),\r\n        }),\r\n        [R.head, R.last],\r\n      ),\r\n    ),\r\n  );\r\n\r\nexport const getTableConfigDimensions = createSelector(\r\n  getVisDataDimensions(),\r\n  getDimensionFormat,\r\n  getTimeDimensionInverted,\r\n  ({ many, one }, format, timeDimensionInverted) =>\r\n    R.mergeRight(\r\n      Layout.oneFormat(format)(one),\r\n      Layout.manyFormat(format, timeDimensionInverted)(many),\r\n    ),\r\n);\r\n\r\nexport const getVisTableData = () =>\r\n  createSelector(getTimeDimensionInverted, getData, R.uncurryN(2, rules.getTableData));\r\nexport const getVisTableDataLimited = () =>\r\n  createSelector(getTimeDimensionInverted, getDataLimited, R.uncurryN(2, rules.getTableData));\r\n\r\nexport const getLimited = () => {\r\n  return getDataLimitedCount;\r\n};\r\n//data.data.dataSets[0].limitedTo=keysLimit;\r\n\r\nexport const getFlatDimensionsIds = () =>\r\n  createSelector(getDimensions, getDataDimensions(), (structureDimensions, dataDimensions) =>\r\n    R.useWith(Sdmx.getUniq, [Sdmx.getDimensionsIds, Sdmx.getDimensionsIds])(\r\n      structureDimensions,\r\n      dataDimensions,\r\n    ),\r\n  );\r\n\r\nexport const getVisTableConfigLayout = () =>\r\n  createSelector(\r\n    getVisLayout,\r\n    getLayout,\r\n    getFlatDimensionsIds(),\r\n    getVisDataDimensions(),\r\n    (visLayout = {}, sdmxLayout = {}, dimensionsIds, { many, one }) => {\r\n      const layout = R.pipe(\r\n        R.ifElse(R.isEmpty, R.always(sdmxLayout), R.identity),\r\n        R.mergeRight({ sections: [], rows: [], header: [] }),\r\n      )(visLayout);\r\n      const getMissingIds = R.difference(dimensionsIds);\r\n      const oneIds = R.keys(one);\r\n      const layoutIds = Layout.getValuesFlat(layout);\r\n\r\n      if (Layout.isInvalid(dimensionsIds, layoutIds, layout))\r\n        return Layout.getDefaultLayout(many, getMissingIds);\r\n\r\n      const missingIds = getMissingIds(layoutIds);\r\n      if (R.isEmpty(missingIds)) return Layout.adjustment(oneIds, layout);\r\n\r\n      return Layout.getLayout(missingIds, oneIds)(layout);\r\n    },\r\n  );\r\n\r\nexport const getVisTableLayout = () =>\r\n  createSelector(getVisTableConfigLayout(), getVisDataDimensions(), (layout, { many }) => {\r\n    const idsNotInMany = R.difference(Layout.getValuesFlat(layout), R.keys(many));\r\n    return R.map(R.flip(R.difference)(idsNotInMany))(layout);\r\n  });\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { DETableConfig, VXFilterContainer } from '@sis-cc/dotstatsuite-ui-components';\r\n\r\nconst TableConfig = ({ title, ...tableProps }) => (\r\n  <VXFilterContainer titleLabel={title} noCollapse noScroll>\r\n    <DETableConfig {...tableProps} />\r\n  </VXFilterContainer>\r\n);\r\n\r\nTableConfig.propTypes = {\r\n  //title: PropTypes.object,\r\n  title: PropTypes.string,\r\n};\r\n\r\nexport default TableConfig;\r\n","import React from 'react';\r\nimport * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport { FormattedMessage, injectIntl } from 'react-intl';\r\nimport { getDimensionGetter } from '../../selectors/vis';\r\nimport { getTableConfigDimensions, getVisTableConfigLayout } from '../../selectors/table';\r\nimport {\r\n  changeLayout,\r\n  changeDimensionGetter,\r\n  changeIsTimeDimensionInverted,\r\n} from '../../ducks/vis';\r\nimport { dimensionFormats } from '../../lib/utils';\r\nimport TableConfig from './TableConfig';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      dimensions: getTableConfigDimensions,\r\n      dimensionGetter: getDimensionGetter,\r\n      layout: getVisTableConfigLayout(),\r\n    }),\r\n    { changeLayout, changeGetter: changeDimensionGetter, changeIsTimeDimensionInverted },\r\n  ),\r\n  injectIntl,\r\n  withProps(({ intl }) => ({\r\n    isNarrow: true,\r\n    noPreview: true,\r\n    title: '',\r\n    labels: {\r\n      commit: <FormattedMessage id=\"de.table.layout.apply\" />,\r\n      cancel: <FormattedMessage id=\"de.table.layout.cancel\" />,\r\n      row: <FormattedMessage id=\"de.table.layout.x\" />,\r\n      column: <FormattedMessage id=\"de.table.layout.y\" />,\r\n      section: <FormattedMessage id=\"de.table.layout.z\" />,\r\n      d: <FormattedMessage id=\"de.table.layout.getter.dimension\" />,\r\n      o: <FormattedMessage id=\"de.table.layout.getter.observation\" />,\r\n      time: <FormattedMessage id=\"de.table.layout.time\" />,\r\n      asc: <FormattedMessage id=\"de.table.layout.time.asc\" />,\r\n      desc: <FormattedMessage id=\"de.table.layout.time.desc\" />,\r\n      help: <FormattedMessage id=\"de.table.layout.help\" />,\r\n      table: <FormattedMessage id=\"de.table.layout.table\" />,\r\n      one: <FormattedMessage id=\"de.table.layout.value.one\" />,\r\n    },\r\n    dimensionGetters: R.reduce(\r\n      (memo, key) => ({ ...memo, [key]: intl.formatMessage({ id: `vx.config.display.${key}` }) }),\r\n      {},\r\n      R.keys(dimensionFormats),\r\n    ),\r\n  })),\r\n)(TableConfig);\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\n//temp disable the charts\r\n\r\nexport default [\r\n  /*\r\n  {\r\n    label: <FormattedMessage id=\"de.visualisation.toolbar.table\" />,\r\n    id: 'table',\r\n  },\r\n  {\r\n    label: <FormattedMessage id=\"de.visualisation.toolbar.chart\" />,\r\n    id: 'chart',\r\n    children: [\r\n      {\r\n        icon: 'timeline-line-chart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.timeline\" />,\r\n        id: 'TimelineChart',\r\n      },\r\n      {\r\n        icon: 'timeline-bar-chart',\r\n        id: 'BarChart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.bar\" />,\r\n      },\r\n      {\r\n        icon: 'horizontal-bar-chart',\r\n        id: 'RowChart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.row\" />,\r\n      },\r\n      /*{\r\n        icon: 'stacked-chart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.stacked\" />,\r\n        id: 'StackedBarChart',\r\n      },*/\r\n  /*],\r\n  },*/\r\n];\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport * as R from 'ramda';\r\n\r\nexport default ({ changeActionId, requestDataFile, dataflow, isFullscreen, isNarrow }) => {\r\n  const actions = [\r\n    /*{\r\n      icon: 'cog',\r\n      id: 'config',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.customize\" />,\r\n      action: () => changeActionId('config'),\r\n    },*/\r\n    {\r\n      icon: 'import',\r\n      id: 'download',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.download\" />,\r\n      children: [\r\n        {\r\n          id: 'csv-selection',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.csv.selection\" />,\r\n          action: () => requestDataFile({ dataflow }),\r\n        },\r\n        {\r\n          id: 'csv-full',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.csv.all\" />,\r\n          action: () => requestDataFile({ isDownloadAllData: true, dataflow }),\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      icon: isFullscreen ? 'minimize' : 'maximize',\r\n      id: 'fullscreen',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.fullscreen\" />,\r\n      action: () => changeActionId('fullscreen'),\r\n    },\r\n  ];\r\n\r\n  const filtersBtn = {\r\n    icon: 'filter-list',\r\n    id: 'filters',\r\n    label: <FormattedMessage id=\"de.side.filters.action\" />,\r\n    action: () => changeActionId('filters'),\r\n  };\r\n\r\n  return R.pipe(R.ifElse(R.always(isNarrow), R.prepend(filtersBtn), R.identity))(actions);\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { DEVisualisationToolbar } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { getIsPending } from '../../selectors/app';\r\nimport { getDataflow } from '../../selectors/vis';\r\nimport { changeViewer, changeAction } from '../../ducks/vis';\r\nimport { requestDataFile } from '../../ducks/sdmx';\r\nimport menus from './menus';\r\nimport actions from './actions';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      isDownloading: getIsPending('requestingDataFile'),\r\n      dataflow: getDataflow,\r\n    }),\r\n    { changeMenu: changeViewer, changeActionId: changeAction, requestDataFile },\r\n  ),\r\n  withProps(({ isDownloading, viewerId, actionId, ...rest }) => ({\r\n    loadingActionId: isDownloading ? 'download' : null,\r\n    selectedMenuId: viewerId,\r\n    selectedActionId: actionId,\r\n    actions: actions({ ...rest, viewerId }),\r\n    menus,\r\n    showLabel: <FormattedMessage id=\"de.visualisation.toolbar.show\" />,\r\n  })),\r\n)(DEVisualisationToolbar);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { VXFilterContainer } from '@sis-cc/dotstatsuite-ui-components';\r\nimport FilterPeriod from '../FilterPeriod';\r\nimport FilterSelection from '../FilterSelection';\r\nimport Filters from '../Filters';\r\nimport Toolbar from '../Toolbar';\r\nimport TableConfig from '../TableConfig';\r\n\r\nconst Tools = ({\r\n  isNarrow,\r\n  isRtl,\r\n  isFullscreen,\r\n  actionId,\r\n  /*isChartConfig,*/\r\n  isFilters,\r\n}) => (\r\n  <React.Fragment>\r\n    <Toolbar isNarrow={isNarrow} isRtl={isRtl} isFull={isFullscreen} actionId={actionId} />\r\n    {/*<VXFilterContainer isOpen={isChartConfig} noScroll noHeader>\r\n      <ChartConfig properties={properties} />\r\n    </VXFilterContainer>*/}\r\n    {isNarrow && (\r\n      <VXFilterContainer isOpen={isFilters} noScroll noHeader>\r\n        <FilterSelection isNarrow={isNarrow} isRtl={isRtl} />\r\n        <FilterPeriod isNarrow={isNarrow} isRtl={isRtl} />\r\n        <Filters isNarrow={isNarrow} isRtl={isRtl} />\r\n        <TableConfig isNarrow={isNarrow} isRtl={isRtl} />\r\n      </VXFilterContainer>\r\n    )}\r\n  </React.Fragment>\r\n);\r\n\r\nTools.propTypes = {\r\n  isNarrow: PropTypes.bool,\r\n  isRtl: PropTypes.bool,\r\n  isFullscreen: PropTypes.bool,\r\n  isChartConfig: PropTypes.bool,\r\n  isFilters: PropTypes.bool,\r\n  actionId: PropTypes.string,\r\n};\r\n\r\nexport default Tools;\r\n","import { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport * as R from 'ramda';\r\nimport { getViewer, getAction } from '../../selectors/vis';\r\nimport Tools from './Tools';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      actionId: getAction,\r\n      viewerId: getViewer,\r\n    }),\r\n  ),\r\n  withProps(({ actionId, viewerId }) => ({\r\n    isChartConfig: R.equals('config', actionId) && !R.equals('table', viewerId),\r\n    isFilters: R.equals('filters', actionId),\r\n  })),\r\n)(Tools);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst FooterUnicef = ({ label, showCopyrightSymbol }) => {\r\n  let copy = '\\u00a9';\r\n  return (\r\n    <div className=\"div_footer\">\r\n      {showCopyrightSymbol ? copy : null}\r\n      {label}\r\n    </div>\r\n  );\r\n};\r\n\r\nFooterUnicef.propTypes = {\r\n  label: PropTypes.string,\r\n  showCopyrightSymbol: PropTypes.bool,\r\n};\r\n\r\nexport default FooterUnicef;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { DETableCell } from '@sis-cc/dotstatsuite-ui-components';\r\nimport glamorous from 'glamorous';\r\n\r\nconst StyledCell = glamorous.div(\r\n  {\r\n    width: '100%',\r\n    height: '100%',\r\n    padding: '4px 6px',\r\n    fontSize: 16,\r\n    textAlign: 'right',\r\n  },\r\n  ({ isYLast, isXLast, theme }) => ({\r\n    color: theme.table.oFont,\r\n    borderTop: `1px solid ${theme.table.border}`,\r\n    borderLeft: `1px solid ${theme.table.border}`,\r\n    borderRight: isYLast ? `1px solid ${theme.table.border}` : null,\r\n    borderBottom: isXLast ? null : `1px solid ${theme.table.border}`,\r\n    backgroundColor: theme.table.xBg,\r\n  }),\r\n);\r\n\r\nconst Cell = ({ renderObservation, variant }) => (\r\n  <React.Fragment>\r\n    <StyledCell isXLast isYLast>\r\n      <DETableCell value=\"Value\" variant={variant} />\r\n    </StyledCell>\r\n    <StyledCell isYLast>{renderObservation()}</StyledCell>\r\n  </React.Fragment>\r\n);\r\n\r\nCell.propTypes = {\r\n  renderObservation: PropTypes.func,\r\n  variant: PropTypes.string,\r\n};\r\n\r\nexport default Cell;\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\n//temp disable the charts\r\n\r\nexport default [\r\n  /*\r\n  {\r\n    label: <FormattedMessage id=\"de.visualisation.toolbar.table\" />,\r\n    id: 'table',\r\n  },\r\n  {\r\n    label: <FormattedMessage id=\"de.visualisation.toolbar.chart\" />,\r\n    id: 'chart',\r\n    children: [\r\n      {\r\n        icon: 'timeline-line-chart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.timeline\" />,\r\n        id: 'TimelineChart',\r\n      },\r\n      {\r\n        icon: 'timeline-bar-chart',\r\n        id: 'BarChart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.bar\" />,\r\n      },\r\n      {\r\n        icon: 'horizontal-bar-chart',\r\n        id: 'RowChart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.row\" />,\r\n      },\r\n      /*{\r\n        icon: 'stacked-chart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.stacked\" />,\r\n        id: 'StackedBarChart',\r\n      },*/\r\n  /*],\r\n  },*/\r\n];\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nexport default ({\r\n  requestDataFile,\r\n  requestExcelDataFile,\r\n  requestExcelDataFileLong,\r\n  dataflow,\r\n  changeViewer,\r\n  viewerId,\r\n  map,\r\n  mapRefAreaDimId,\r\n  mapAreasToPreselect,\r\n  helpUrl,\r\n  changeDataqueryMultipleUpdate,\r\n  downloadFullEnabled,\r\n}) => {\r\n  const actionsTable = [\r\n    {\r\n      icon: 'import',\r\n      id: 'download',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.download\" />,\r\n      children: [\r\n        {\r\n          id: 'excel-long',\r\n          label: (\r\n            <FormattedMessage id=\"de.visualisation.toolbar.action.download.excel.selection.long\" />\r\n          ),\r\n          action: () => requestExcelDataFileLong({ isDownloadAllData: false, dataflow }),\r\n        },\r\n        {\r\n          id: 'excel-selection',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.excel.selection\" />,\r\n          action: () => requestExcelDataFile({ isDownloadAllData: false, dataflow }),\r\n        },\r\n        {\r\n          id: 'csv-selection',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.csv.selection\" />,\r\n          action: () => requestDataFile({ dataflow }),\r\n        },\r\n        /*{\r\n          id: 'csv-full',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.csv.all\" />,\r\n          action: () => requestDataFile({ isDownloadAllData: true, dataflow }),\r\n        },*/\r\n      ],\r\n    },\r\n  ];\r\n\r\n  if (downloadFullEnabled != '0') {\r\n    actionsTable[0].children.push({\r\n      id: 'csv-full',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.csv.all\" />,\r\n      action: () => requestDataFile({ isDownloadAllData: true, dataflow }),\r\n    });\r\n  }\r\n\r\n  const actionMap = {\r\n    icon: 'map',\r\n    id: 'map',\r\n    label: 'Map',\r\n    action: () => {\r\n      changeDataqueryMultipleUpdate(mapRefAreaDimId, mapAreasToPreselect), changeViewer('map');\r\n    },\r\n  };\r\n\r\n  if (typeof map != 'undefined' && map) {\r\n    actionsTable.push(actionMap);\r\n  }\r\n\r\n  const actionHelp = {\r\n    icon: 'help',\r\n    id: 'help',\r\n    label: 'Help',\r\n    action: () => {\r\n      window.open(helpUrl, '_self');\r\n    },\r\n  };\r\n\r\n  const actionsMap = [\r\n    {\r\n      icon: 'th',\r\n      id: 'table',\r\n      label: 'Table',\r\n      action: () => changeViewer('table'),\r\n    },\r\n  ];\r\n\r\n  if (helpUrl) {\r\n    actionsTable.push(actionHelp);\r\n    actionsMap.push(actionHelp);\r\n  }\r\n\r\n  if (viewerId == 'table') return actionsTable;\r\n  if (viewerId == 'map') return actionsMap;\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { DEVisualisationToolbar } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { getIsPending } from '../../selectors/app';\r\nimport { getDataflow, getAction, getViewer } from '../../selectors/vis';\r\nimport { getMap } from '../../selectors/sdmx';\r\nimport { getHelpUrl, getDownloadFullEnabled } from '../../selectors/vis';\r\nimport { changeViewer, changeAction } from '../../ducks/vis';\r\nimport { changeDataqueryMultipleUpdate } from '../../ducks/vis';\r\nimport { getMapAreasToPreselect, getMapRefAreaDimId } from '../../lib/settings';\r\nimport { requestDataFile, requestExcelDataFile, requestExcelDataFileLong } from '../../ducks/sdmx';\r\nimport menus from './menus';\r\nimport actions from './actions';\r\nimport * as R from 'ramda';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      isDownloading: getIsPending('requestingDataFile'),\r\n      dataflow: getDataflow,\r\n      actionId: getAction,\r\n      viewerId: getViewer,\r\n      map: getMap,\r\n      mapAreasToPreselect: getMapAreasToPreselect,\r\n      mapRefAreaDimId: getMapRefAreaDimId,\r\n      helpUrl: getHelpUrl,\r\n      downloadFullEnabled: getDownloadFullEnabled,\r\n    }),\r\n    {\r\n      changeMenu: changeViewer,\r\n      changeActionId: changeAction,\r\n      requestDataFile,\r\n      requestExcelDataFile,\r\n      requestExcelDataFileLong,\r\n      changeViewer,\r\n      changeDataqueryMultipleUpdate,\r\n    },\r\n  ),\r\n  withProps(({ isDownloading, viewerId, actionId, ...rest }) => ({\r\n    loadingActionId: isDownloading ? 'download' : null,\r\n    selectedMenuId: viewerId,\r\n    selectedActionId: actionId,\r\n    actions: actions({ ...rest, viewerId }),\r\n    menus,\r\n    showLabel: <FormattedMessage id=\"de.visualisation.toolbar.show\" />,\r\n    isFilters: R.equals('filters', actionId),\r\n  })),\r\n)(DEVisualisationToolbar);\r\n","import React, { useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst TableMessageUnicef = ({ returnedKeyCount, limitedTo, animationMillis }) => {\r\n  const msgBoxId = 'dataLimited_msgBox';\r\n\r\n  if (returnedKeyCount > limitedTo) {\r\n    const remMessage = () => {\r\n      document.getElementById('root').removeEventListener('data_loaded', remMessage);\r\n      const tmr = setTimeout(() => {\r\n        const el = document.getElementById(msgBoxId);\r\n        const onTransEnd = () => {\r\n          const el2 = document.getElementById(msgBoxId);\r\n          el2.removeEventListener('transitionend', onTransEnd);\r\n          el2.style.display = 'none';\r\n        };\r\n        if (el) {\r\n          el.addEventListener('transitionend', onTransEnd, false);\r\n          el.classList.add('dataLimited_msgBox_trans');\r\n        }\r\n      }, animationMillis);\r\n    };\r\n\r\n    document.getElementById('root').addEventListener('data_loaded', remMessage);\r\n  } else {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"div_dataLimited\" id={msgBoxId} style={{ position: 'relative' }}>\r\n      <p>\r\n        Visualization is limited to {' ' + limitedTo} values to avoid slowing your browser.<br />\r\n        Please further filter your data, or &lt;Download&gt; the entire dataset as a CSV.\r\n      </p>\r\n      <div\r\n        style={{ position: 'absolute', top: '-20px', right: '-20px' }}\r\n        className=\"pt-tag-remove\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nTableMessageUnicef.propTypes = {\r\n  returnedKeyCount: PropTypes.number,\r\n  limitedTo: PropTypes.number,\r\n  animationMillis: PropTypes.number,\r\n};\r\n\r\nexport default TableMessageUnicef;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { SDMXTable } from '@sis-cc/dotstatsuite-ui-components';\r\nimport SisHeader from '@sis-cc/dotstatsuite-ui-header';\r\n//import SisFooter from '@sis-cc/dotstatsuite-ui-footer';\r\nimport FooterUnicef from '../FooterUnicef';\r\nimport glamorous from 'glamorous';\r\nimport Cell from './Cell';\r\n//import Tools from '../Tools';\r\nimport Toolbar from '../ToolbarUnicef';\r\nimport TableMessageUnicef from '../TableMessageUnicef';\r\nimport IndicatorLinkUnicef from '../IndicatorLinkUnicef';\r\n\r\nconst TableContainer = glamorous.div({\r\n  borderLeftWidth: 0,\r\n  borderRightWidth: 0,\r\n  marginTop: 10, // sync style with chart\r\n\r\n  overflowX: 'auto',\r\n});\r\n\r\nconst Table = ({\r\n  header,\r\n  viewerConfig,\r\n  data,\r\n  layoutIds,\r\n  renderObservation,\r\n  itemFormatter,\r\n  isNotATable,\r\n  footnotes,\r\n  variant,\r\n  limited,\r\n  selItems,\r\n}) => (\r\n  <TableContainer>\r\n    <div className=\"header_download\">\r\n      <SisHeader {...header} fonts={viewerConfig.fonts.header} />\r\n      <Toolbar />\r\n    </div>\r\n    <TableMessageUnicef\r\n      limitedTo={limited.limitedTo}\r\n      returnedKeyCount={limited.returnedKeyCount}\r\n      animationMillis={8000}\r\n    />\r\n    {/* <IndicatorLinkUnicef data={data} selItems={selItems} /> */}\r\n    {isNotATable ? (\r\n      <Cell renderObservation={renderObservation} variant={variant} />\r\n    ) : (\r\n      <div id=\"tableScrollWrapper1\" style={{ transform: 'rotateX(180deg)', overflowX: 'auto' }}>\r\n        <div id=\"tableScrollWrapper2\" style={{ transform: 'rotateX(180deg)' }}>\r\n          <SDMXTable\r\n            data={data}\r\n            layoutIds={layoutIds}\r\n            renderObservation={renderObservation}\r\n            itemFormatter={itemFormatter}\r\n          />\r\n        </div>\r\n      </div>\r\n    )}\r\n    <FooterUnicef label={'UNICEF'} showCopyrightSymbol={true} />\r\n  </TableContainer>\r\n);\r\n\r\nTable.propTypes = {\r\n  header: PropTypes.object,\r\n  viewerConfig: PropTypes.object,\r\n  source: PropTypes.object,\r\n  data: PropTypes.object,\r\n  footnotes: PropTypes.object,\r\n  layoutIds: PropTypes.object,\r\n  renderObservation: PropTypes.func,\r\n  itemFormatter: PropTypes.func,\r\n  isNotATable: PropTypes.bool,\r\n  variant: PropTypes.string,\r\n  limited: PropTypes.object,\r\n  selItems: PropTypes.array,\r\n};\r\n\r\nexport default Table;\r\n","import * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, mapProps } from 'recompose';\r\nimport {\r\n  getVisDataDimensions,\r\n  getVisTableLayout,\r\n  getVisTableData,\r\n  getVisTableDataLimited,\r\n  getLimited,\r\n} from '../../selectors/table';\r\nimport { getDimensionFormat, getDimensionGetter } from '../../selectors/vis';\r\nimport { getCustomAttributes, getCustomSort } from '../../selectors/sdmx';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nimport { DETableCell } from '@sis-cc/dotstatsuite-ui-components';\r\nimport Table from './Table';\r\nimport { getSelection } from '../../selectors/sdmx';\r\nimport { getHideTotalLabel } from '../../lib/settings';\r\n\r\nconst Cell = connect(createStructuredSelector({ variant: getDimensionGetter }))(DETableCell);\r\n\r\n//Enque the unit multipliers to the unit. Hack to avoid altering the dotstatsuite-ui-header project\r\nconst addUnitMultiplierToUnit = (headerObj, footnotes) => {\r\n  //If the uprs(contains the unit) is empty return (the unit is not the same for the data shown)\r\n  if (headerObj.uprs == '') return headerObj;\r\n\r\n  let newUprs = headerObj.uprs;\r\n\r\n  //Append the multiplier if the unit is the same for all the data shown.\r\n  footnotes.footnotes.forEach(elem => {\r\n    if (elem.id == 'UNIT_MULTIPLIER' && elem.isFootnote) {\r\n      const mult = elem.values\r\n        .map(e => {\r\n          return e.name;\r\n        })\r\n        .join(', ');\r\n      newUprs = newUprs + ' (' + mult + ')';\r\n    }\r\n  });\r\n  headerObj.uprs = newUprs;\r\n  return headerObj;\r\n};\r\n\r\nconst doCustomSort = (values, sortOrder) => {\r\n  //sort the values array based on the sortOrder array\r\n  values.sort((a, b) => {\r\n    const idx1 = sortOrder.indexOf(a.id);\r\n    const idx2 = sortOrder.indexOf(b.id);\r\n    //This is needed to add codes not in the sortOrder array at the bottom of the list\r\n    if (idx1 == -1) return 1;\r\n    if (idx2 == -1) return -1;\r\n\r\n    return idx1 - idx2;\r\n  });\r\n};\r\n\r\n//Formats data before sending it to the table, adding visualization prefs\r\nconst format_data = (data, layoutIds, viewerConfig, customSort) => {\r\n  //reeds to be custom sorted?\r\n  if (customSort && customSort['text']) {\r\n    for (var k in customSort['text']) {\r\n      if (customSort['text'].hasOwnProperty(k)) {\r\n        if (data.dimensions[k]) {\r\n          doCustomSort(data.dimensions[k]['values'], customSort['text'][k]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  //hide the label if _T\r\n  if (getHideTotalLabel) {\r\n    if (layoutIds && layoutIds.rows) {\r\n      layoutIds.rows.forEach(rowItem => {\r\n        if (data.dimensions[rowItem].values) {\r\n          data.dimensions[rowItem].values.forEach(clItem => {\r\n            if (clItem.id == '_T') {\r\n              clItem.name = ' ';\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n  return data;\r\n};\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      dimensions: getVisDataDimensions(),\r\n      customAttributes: getCustomAttributes,\r\n      layoutIds: getVisTableLayout(),\r\n      itemFormatter: getDimensionFormat,\r\n      //data: getVisTableData(),\r\n      data: getVisTableDataLimited(),\r\n      variant: getDimensionGetter,\r\n      limited: getLimited(),\r\n      selItems: getSelection,\r\n      customSort: getCustomSort,\r\n    }),\r\n  ),\r\n  mapProps(\r\n    ({\r\n      chartData,\r\n      viewerConfig,\r\n      data,\r\n      customAttributes,\r\n      dimensions,\r\n      layoutIds,\r\n      itemFormatter,\r\n      variant,\r\n      limited,\r\n      selItems,\r\n      customSort,\r\n    }) => ({\r\n      viewerConfig,\r\n      data: format_data(data, layoutIds, viewerConfig, customSort),\r\n      layoutIds,\r\n      itemFormatter,\r\n      renderObservation: rules.observationGetter(Cell)({\r\n        observations: R.prop('observations', data),\r\n        dimensions,\r\n        customAttributes,\r\n        isRtl: false,\r\n      })(R.identity),\r\n      // little dirty for now, in the wait of a better common mgmt of table and charts\r\n      //header: R.merge(R.pick(['title', 'subtitle', 'uprs'], chartData),R.pick(['footnotes'],customAttributes)),\r\n      header: addUnitMultiplierToUnit(\r\n        R.pick(['title', 'subtitle', 'uprs'], chartData),\r\n        R.pick(['footnotes'], customAttributes),\r\n      ),\r\n      footnotes: R.prop('footnotes', chartData),\r\n      isNotATable: R.pipe(R.prop('observations'), R.values, R.length, R.equals(1))(data),\r\n      variant,\r\n      limited,\r\n      selItems,\r\n      customSort,\r\n    }),\r\n  ),\r\n)(Table);\r\n","import { Chart } from '@sis-cc/dotstatsuite-components';\r\nimport { mapProps } from 'recompose';\r\n\r\nexport default mapProps(({ chartData, chartOptions, viewerConfig, type }) => ({\r\n  data: chartData,\r\n  options: chartOptions,\r\n  config: viewerConfig,\r\n  type,\r\n}))(Chart);\r\n","const fonts = { fontFamily: 'Segoe UI' };\r\nconst fontDimensions = { fontFamily: 'Segoe UI', fontWeight: 500 };\r\n\r\nexport default {\r\n  owner: 'UNICEF',\r\n  logo: '',\r\n  footer_visible: false,\r\n  fonts: {\r\n    header: { subtitle: fontDimensions, title: fonts, uprs: fonts, tooltip: fonts },\r\n    chart: {\r\n      axisLegend: fonts,\r\n      chartLegend: fonts,\r\n      tooltip: { primary: fonts, secondary: fonts },\r\n    },\r\n    footer: { copyright: fonts, source: fonts },\r\n  },\r\n};\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nfunction MapSubfilterSummary(props) {\r\n  const selItem = props.item.values.find(item => {\r\n    return item.id == props.selected;\r\n  });\r\n\r\n  return (\r\n    <div className=\"mapSubfilterGroup\">\r\n      <div className=\"mapSubfilterLbl\">{props.item.name}</div>\r\n      <div className=\"mapSubfilterSel\">{selItem.name}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nMapSubfilterSummary.propTypes = {\r\n  selected: PropTypes.string,\r\n  item: PropTypes.object,\r\n  onValueChange: PropTypes.func,\r\n};\r\n\r\nexport default MapSubfilterSummary;\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\n//import MapSubfilter from './MapSubfilter';\r\nimport MapSubfilterSummary from './MapSubfilterSummary';\r\n\r\nclass MapFilterGroup extends React.Component {\r\n  render() {\r\n    if (!this.props.filters) return null;\r\n    return (\r\n      <div className=\"mapFiltersGroup\">\r\n        {this.props.filters.map(item => (\r\n          <MapSubfilterSummary\r\n            key={item.id}\r\n            item={item}\r\n            selected={this.props.selection[item.id]}\r\n            onValueChange={this.props.onValueChange}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nMapFilterGroup.propTypes = {\r\n  filters: PropTypes.array,\r\n  selection: PropTypes.object,\r\n  onValueChange: PropTypes.func,\r\n};\r\n\r\nexport default MapFilterGroup;\r\n","import L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport PropTypes from 'prop-types';\r\nimport React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { CHANGE_MAP_FILTERS } from '../../ducks/sdmx';\r\nimport { getMapRefAreaDimId } from '../../lib/settings';\r\nimport MapFilterGroup from './MapFilterGroup';\r\nimport { getLatestDatapoints } from './MapHelpers';\r\n\r\nconst TIME_PERIOD_ID = 'TIME_PERIOD';\r\n\r\nconst map_styles = {\r\n  poly_disabled: {\r\n    weight: 1,\r\n    fillOpacity: 0.1,\r\n    color: '#000000',\r\n  },\r\n  poly_highlight: {\r\n    weight: 3,\r\n  },\r\n  fillOpacity: 0.85,\r\n  mapColors: [\r\n    '#0297C950',\r\n    '#0297C970',\r\n    '#0297C990',\r\n    '#0297C9B0',\r\n    '#0297C9D0',\r\n    '#0297C9F0',\r\n    '#0297C9FF',\r\n  ],\r\n};\r\n\r\nclass Map extends React.Component {\r\n  filteredVals = null;\r\n  obs_val_count = 0;\r\n\r\n  updateSel = newsel => {\r\n    this.props.changeFilter({ id: newsel.id, val: newsel.value });\r\n  };\r\n\r\n  //Returns the value from the refarea and the list of selected codes\r\n  getValue = (refarea, selection) => {\r\n    let key = []; //the key to access the value in the sdmx json\r\n    let ret = {};\r\n    let code = '';\r\n    //foreach dimension\r\n    for (let i = 0; i < this.props.sdmx.structure.dimensions.observation.length; i++) {\r\n      let d = this.props.sdmx.structure.dimensions.observation[i];\r\n      if (d.id == this.props.ref_area_dim_id) {\r\n        //is the geo dimension? Assign it\r\n        code = refarea;\r\n        //Alway get the last datapoint: it has \"_\" as TIME_PERIOD_COORD\r\n      } else if (d.id == TIME_PERIOD_ID) {\r\n        code = '_';\r\n      } else {\r\n        //It is not the geo dimension get the selected code\r\n        code = selection[d.id];\r\n      }\r\n\r\n      //get the index of the code\r\n      if (code == '_') {\r\n        key.push('_');\r\n      } else {\r\n        let idx = d.values.findIndex(i => i.id == code);\r\n        if (idx == -1) return null;\r\n        //assign name/label to the return obj\r\n        ret[d.id] = { name: d.values[idx].name, id: d.values[idx].id };\r\n        key.push(idx); //continue to compose the SDMX value access key\r\n      }\r\n    }\r\n\r\n    //Access the value and assign it to the ret obj\r\n    key = key.join(':');\r\n    if (this.props.latest_datapoints[key]) {\r\n      ret['obs_val'] = this.props.latest_datapoints[key];\r\n      ret['attr'] = [];\r\n      //Start from 1:the first one is the obs value. Stop at len-1: the last one is the time period\r\n      for (let a = 1; a < ret['obs_val'].length - 1; a++) {\r\n        if (ret['obs_val'][a] != null && !isNaN(ret['obs_val'][a])) {\r\n          ret['attr'].push({\r\n            n: this.props.sdmx.structure.attributes.observation[a - 1].name,\r\n            v: this.props.sdmx.structure.attributes.observation[a - 1].values[ret['obs_val'][a]]\r\n              .name,\r\n          });\r\n        }\r\n      }\r\n    } else ret['obs_val'] = null;\r\n\r\n    return ret;\r\n  };\r\n\r\n  //Get all the values for the selected geo areas and the unique selection of the other dims\r\n  getFilteredVals = () => {\r\n    if (typeof this.props == 'undefined' || !this.props) return null;\r\n    if (typeof this.props.sdmx == 'undefined' || !this.props.sdmx) return null;\r\n\r\n    let vals = [];\r\n    let geoDim = this.props.sdmx.structure.dimensions.observation.find(\r\n      i => i.id == this.props.ref_area_dim_id,\r\n    );\r\n    geoDim.values.forEach(v => {\r\n      vals.push(this.getValue(v.id, this.props.selection));\r\n    });\r\n    return vals;\r\n  };\r\n\r\n  onEachLayer = layer => {\r\n    //search the value associated to the map shape\r\n    let val = null;\r\n    for (let i = 0; i < this.filteredVals.length; i++) {\r\n      if (\r\n        this.filteredVals[i][this.props.ref_area_dim_id]['id'] == layer.feature.properties.ISO3_CODE\r\n      ) {\r\n        val = this.filteredVals[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    //The calculated_style attrib is used to reassign the values after the on_mouse_over\r\n    if (val && val.obs_val) {\r\n      let scaledOpacity = -1;\r\n      if (!isNaN(val.obs_val[0])) {\r\n        scaledOpacity = this.getColorBucket(val.obs_val[0]);\r\n      }\r\n\r\n      const oldStyle = {\r\n        weight: 1,\r\n        fillOpacity: map_styles.fillOpacity,\r\n        color: map_styles.mapColors[scaledOpacity],\r\n      };\r\n      layer.setStyle(oldStyle);\r\n\r\n      layer.feature.properties['calculated_style'] = oldStyle;\r\n    } else {\r\n      layer.setStyle(map_styles.poly_disabled);\r\n      layer.feature.properties['calculated_style'] = map_styles.poly_disabled;\r\n    }\r\n\r\n    layer.feature.properties['values'] = val;\r\n  };\r\n\r\n  highlighFeature = e => {\r\n    let layer = e.target;\r\n    layer.setStyle(map_styles.poly_highlight);\r\n    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {\r\n      layer.bringToFront();\r\n    }\r\n\r\n    this.infobox.update(layer.feature.properties);\r\n  };\r\n\r\n  resetHighlight = e => {\r\n    let layer = e.target;\r\n    if (layer.feature.properties.calculated_style) {\r\n      layer.setStyle(layer.feature.properties.calculated_style);\r\n    }\r\n    this.infobox.update();\r\n  };\r\n\r\n  zoomToFeature = e => {\r\n    this.map.fitBounds(e.target.getBounds());\r\n  };\r\n\r\n  onEachFeature = (feature, layer) => {\r\n    layer.on('mouseover', this.highlighFeature);\r\n    layer.on('mouseout', this.resetHighlight);\r\n    layer.on('click', this.zoomToFeature);\r\n  };\r\n\r\n  getColorBucket = val => {\r\n    for (let i = 0; i < this.steps.length - 1; i++) {\r\n      if (val >= this.steps[i] && val < this.steps[i + 1]) return i;\r\n    }\r\n    if (val == this.steps[this.steps.length - 1]) return this.steps.length - 2;\r\n    return null;\r\n  };\r\n\r\n  _createLegendHTML = () => {\r\n    let ret = '';\r\n    let step1 = 0;\r\n    let step2 = 0;\r\n    for (let i = 0; i < this.steps.length - 1; i++) {\r\n      step1 = Math.round(this.steps[i] * 10) / 10;\r\n      step2 = Math.round(this.steps[i + 1] * 10) / 10;\r\n      ret +=\r\n        '<i style=\"background:' +\r\n        map_styles.mapColors[i] +\r\n        '\"></i> ' +\r\n        step1 +\r\n        '&ndash;' +\r\n        step2 +\r\n        '<br>';\r\n    }\r\n    return ret;\r\n  };\r\n\r\n  createLegend = map => {\r\n    const div = L.DomUtil.create('div', 'legend');\r\n    div.innerHTML = this._createLegendHTML(1, 1);\r\n\r\n    return div;\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.map = L.map('de_map', {\r\n      center: [0, 0],\r\n      attributionControl: false,\r\n    });\r\n    this.countryLayer = L.geoJSON(this.props.shape, {\r\n      style: map_styles.poly_disabled,\r\n      onEachFeature: this.onEachFeature,\r\n    }).addTo(this.map);\r\n\r\n    this.infobox = L.control();\r\n\r\n    this.legend = L.control({ position: 'bottomright' });\r\n    this.legend.onAdd = this.createLegend;\r\n\r\n    this.infobox.onAdd = function(map) {\r\n      this._div = L.DomUtil.create('div', 'map_info');\r\n      this.update();\r\n      return this._div;\r\n    };\r\n\r\n    this.infobox.update = function(props) {\r\n      if (!props) {\r\n        this._div.innerHTML = '<b>Hover on any active area</b>';\r\n        return;\r\n      }\r\n      let val = '';\r\n      let attribs = '';\r\n\r\n      if (props.values && props.values.obs_val) {\r\n        const dim_sel = [];\r\n        for (let k in props.values) {\r\n          if (props.values.hasOwnProperty(k) && k != props.ref_area_dim_id && k != 'obs_val') {\r\n            dim_sel.push(props.values[k].name);\r\n          }\r\n        }\r\n        val = props.values.obs_val[0];\r\n        props.values.attr.forEach(a => {\r\n          attribs = attribs + '<span class=\"attr_lbl\">' + a.n + ': </span>' + a.v + '<br>';\r\n        });\r\n\r\n        this._div.innerHTML =\r\n          '<b>' +\r\n          props.NAME_ENGL +\r\n          '</b>' +\r\n          '<div id=\"map_time_period_val\">' +\r\n          'Time period: ' +\r\n          props.values.obs_val[props.values.obs_val.length - 1] +\r\n          '</div>' +\r\n          /*'<div id=\"map_vars\">' +\r\n          dim_sel.join(', ') +\r\n          '</div>' +*/\r\n          '<div id=\"map_val\">' +\r\n          val +\r\n          '</div>' +\r\n          '<div id=\"map_attribs\">' +\r\n          attribs +\r\n          '</div>';\r\n      } else {\r\n        this._div.innerHTML =\r\n          '<b>' +\r\n          props.NAME_ENGL +\r\n          '</b>' +\r\n          '<div id=\"map_time\">Change your filters to get the value</div>' +\r\n          '<div id=\"map_val\"></div>';\r\n      }\r\n    };\r\n\r\n    this.infobox.addTo(this.map);\r\n\r\n    this.map.fitBounds(this.countryLayer.getBounds());\r\n\r\n    this.countryLayer.eachLayer(this.onEachLayer);\r\n\r\n    this.map.invalidateSize();\r\n  }\r\n\r\n  render() {\r\n    this.valMin = Number.MAX_VALUE;\r\n    this.valMax = Number.MIN_VALUE;\r\n    this.valRange = this.valMax;\r\n    this.obs_val_count = 0;\r\n    this.steps = [];\r\n\r\n    //Calculate the max/min to scale the colors\r\n    if (typeof this.props.sdmx != 'undefined') {\r\n      this.filteredVals = this.getFilteredVals();\r\n      this.filteredVals.forEach(v => {\r\n        if (v.obs_val) this.obs_val_count += 1;\r\n      });\r\n      this.filteredVals.forEach(v => {\r\n        if (v.obs_val && !isNaN(v.obs_val[0])) {\r\n          let toCompare = parseFloat(v.obs_val[0]);\r\n\r\n          if (toCompare < this.valMin) {\r\n            this.valMin = toCompare;\r\n          }\r\n          if (toCompare > this.valMax) {\r\n            this.valMax = toCompare;\r\n          }\r\n        }\r\n      });\r\n\r\n      this.valRange = this.valMax - this.valMin;\r\n\r\n      let step = this.valRange / map_styles.mapColors.length;\r\n      for (let i = 0; i < map_styles.mapColors.length; i++) {\r\n        this.steps.push(this.valMin + step * i);\r\n      }\r\n      this.steps.push(this.valMax);\r\n    }\r\n\r\n    if (typeof this.map != 'undefined' && typeof this.props.sdmx != 'undefined') {\r\n      this.countryLayer.eachLayer(this.onEachLayer);\r\n\r\n      this.legend.addTo(this.map);\r\n\r\n      if (this.obs_val_count == 0) {\r\n        this.infobox.update({ show: false });\r\n      }\r\n    }\r\n\r\n    return (\r\n      <React.Fragment>\r\n        <MapFilterGroup\r\n          filters={this.props.filters}\r\n          selection={this.props.selection}\r\n          onValueChange={this.updateSel}\r\n        />\r\n\r\n        <div id=\"de_map_container\" style={{ position: 'relative', height: '500px' }}>\r\n          <div id=\"de_map\" />\r\n          <div\r\n            id=\"de_map_message\"\r\n            style={this.obs_val_count == 0 ? { display: '' } : { display: 'none' }}\r\n          >\r\n            <h5>Change your selection</h5>\r\n            <div>\r\n              No values available for the current selection, please change your filters combination\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  let refAreaDimId = getMapRefAreaDimId();\r\n  let filters = [];\r\n\r\n  if (typeof state.sdmx != 'undefined') {\r\n    for (let i = 0; i < state.sdmx.data.structure.dimensions.observation.length; i++) {\r\n      let d = state.sdmx.data.structure.dimensions.observation[i];\r\n      //the filters: all the dimensions excluding the geo one and the time one\r\n      if (d.id != refAreaDimId && d.id != TIME_PERIOD_ID) {\r\n        filters.push(d);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Get an alternate block of data points:\r\n  //only keep the latest data point for any combination of the other dimensions.\r\n  const latest = getLatestDatapoints(state.sdmx.data);\r\n\r\n  return {\r\n    shape: state.sdmx.map,\r\n    sdmx: state.sdmx.data,\r\n    latest_datapoints: latest,\r\n    filters: filters,\r\n    selection: state.sdmx.map_selection,\r\n    ref_area_dim_id: refAreaDimId,\r\n  };\r\n};\r\n\r\nfunction mapDispatchToProps(dispatch, props) {\r\n  return {\r\n    changeFilter: filter =>\r\n      dispatch({\r\n        type: CHANGE_MAP_FILTERS,\r\n        payload: { filter },\r\n      }),\r\n  };\r\n}\r\n\r\nMap.propTypes = {\r\n  shape: PropTypes.object,\r\n  sdmx: PropTypes.object,\r\n  latest_datapoints: PropTypes.object,\r\n  filters: PropTypes.array,\r\n  selection: PropTypes.object,\r\n  changeFilter: PropTypes.func,\r\n  ref_area_dim_id: PropTypes.string,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Map);\r\n","import * as R from 'ramda';\r\n\r\n/*\r\nReturns a copy of the dataset values only keeping the latest datapoint for any combination of dimensions\r\ne.g:\r\nAGO:CME_MR0T5:_T:1990\r\nAGO:CME_MR0T5:_T:2000\r\nAGO:CME_MR0T5:_T:1995\r\nget merged into:\r\nAGO:CME_MR0T5:_T:2000 and returned with a new key where the year dimension is replaced by a _ (AGO:CME_MR0T5:_T:_)\r\nThe year value becames an attribute and gets appended at the end of the attributes array.\r\n*/\r\n\r\nexport const getLatestDatapoints = data => {\r\n  const TIME_PERIOD_ID = 'TIME_PERIOD';\r\n  let time_dim_keyPosition = -1;\r\n  let time_dim_values = null;\r\n  let time_key_priority = [];\r\n  let new_keys = {};\r\n\r\n  for (let i = 0; i < data.structure.dimensions.observation.length; i++) {\r\n    if (data.structure.dimensions.observation[i].id == TIME_PERIOD_ID) {\r\n      time_dim_keyPosition = i;\r\n      time_dim_values = [...data.structure.dimensions.observation[i].values];\r\n      break;\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < time_dim_values.length; i++) {\r\n    time_dim_values[i]['key_id'] = i;\r\n  }\r\n  //inverse sort\r\n  time_dim_values.sort((a, b) => {\r\n    if (a.start < b.start) return 1;\r\n    if (a.start > b.start) return -1;\r\n    return 0;\r\n  });\r\n\r\n  time_dim_values.forEach(v => {\r\n    time_key_priority.push('' + v.key_id);\r\n  });\r\n\r\n  let recent_time_key = '';\r\n  let time_score = -1;\r\n\r\n  for (const [k, v] of Object.entries(data.dataSets[0].observations)) {\r\n    recent_time_key = k.split(':');\r\n    time_score = time_key_priority.indexOf(recent_time_key[time_dim_keyPosition]);\r\n    recent_time_key[time_dim_keyPosition] = '_';\r\n    recent_time_key = recent_time_key.join(':');\r\n    if (new_keys[recent_time_key] && new_keys[recent_time_key] > time_score) {\r\n      new_keys[recent_time_key] = time_score;\r\n    } else {\r\n      new_keys[recent_time_key] = time_score;\r\n    }\r\n  }\r\n\r\n  let ret = {};\r\n  let getkey = '';\r\n  let obs_val_attribs = null;\r\n  for (const [k, v] of Object.entries(new_keys)) {\r\n    getkey = k.replace('_', time_key_priority[v]);\r\n    obs_val_attribs = data.dataSets[0].observations[getkey];\r\n    ret[k] = [...obs_val_attribs];\r\n    //adds the time label\r\n    ret[k].push(\r\n      data.structure.dimensions.observation[time_dim_keyPosition].values[time_key_priority[v]].id,\r\n    );\r\n  }\r\n\r\n  return ret;\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport SisHeader from '@sis-cc/dotstatsuite-ui-header';\r\nimport viewerConfig from '../Viewer/config';\r\nimport Toolbar from '../ToolbarUnicef';\r\nimport Map from './Map';\r\n\r\nfunction MapWrapper(props) {\r\n  return (\r\n    <React.Fragment>\r\n      <div className=\"header_download\">\r\n        <SisHeader title={props.title} fonts={viewerConfig.fonts.header} />\r\n        <Toolbar />\r\n      </div>\r\n      <Map />\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    title: state.sdmx.data.structure.name,\r\n  };\r\n};\r\n\r\nMapWrapper.propTypes = {\r\n  title: PropTypes.string,\r\n};\r\n\r\nexport default connect(mapStateToProps)(MapWrapper);\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, branch, renderComponent, withProps } from 'recompose';\r\nimport * as R from 'ramda';\r\nimport { VXNoData } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { getViewer } from '../../selectors/vis';\r\nimport Table from '../Table';\r\nimport Chart from '../Chart';\r\nimport MapWrapper from '../Map';\r\nimport viewerConfig from './config';\r\n\r\nexport default compose(\r\n  connect(createStructuredSelector({ type: getViewer })),\r\n  withProps({ viewerConfig }),\r\n  branch(\r\n    R.pipe(R.prop('data'), R.isNil),\r\n    renderComponent(() => <VXNoData message={<FormattedMessage id=\"vx.no.data\" />} />),\r\n  ),\r\n  branch(\r\n    ({ type }) => R.equals(type, 'table'),\r\n    renderComponent(Table),\r\n    renderComponent(MapWrapper),\r\n  ),\r\n)(Chart);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport * as R from 'ramda';\r\nimport { VXFilterContainerCollapsible } from '@sis-cc/dotstatsuite-ui-components';\r\nimport List from '@material-ui/core/List';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nconst Footnotes = ({ footnotes }) => (\r\n  <VXFilterContainerCollapsible\r\n    titleLabel={<FormattedMessage id=\"footnotes\" />}\r\n    isOpen={true}\r\n    noScroll\r\n  >\r\n    <List dense>\r\n      {R.map(({ id, label, values }) => (\r\n        <ListItem key={id}>\r\n          <ListItemText\r\n            primary={R.defaultTo(id, label)}\r\n            secondary={R.pipe(R.pluck('name'), R.join(' | '))(values)}\r\n          />\r\n        </ListItem>\r\n      ))(footnotes)}\r\n    </List>\r\n  </VXFilterContainerCollapsible>\r\n);\r\n\r\nFootnotes.propTypes = {\r\n  footnotes: PropTypes.array,\r\n};\r\n\r\nexport default Footnotes;\r\n","import * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, mapProps } from 'recompose';\r\nimport { getCustomAttributes } from '../../selectors/sdmx';\r\nimport Footnotes from './Footnotes';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      attributes: getCustomAttributes,\r\n    }),\r\n  ),\r\n  mapProps(\r\n    R.pipe(\r\n      R.prop('attributes'),\r\n      R.pick(['footnotes']),\r\n      R.prop('footnotes'),\r\n      R.reject(\r\n        R.pipe(\r\n          R.prop('id'),\r\n          R.flip(R.includes)(['UNIT_MEASURE']), // UNICEF specific\r\n        ),\r\n      ),\r\n      R.assoc('footnotes', R.__, {}),\r\n    ),\r\n  ),\r\n)(Footnotes);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { VXLoader } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { RulesDriver } from '@sis-cc/dotstatsuite-components';\r\nimport Tools from '../Tools';\r\nimport Viewer from '../Viewer';\r\nimport Footnotes from '../Footnotes';\r\n\r\nconst Main = ({\r\n  data,\r\n  enhancedData,\r\n  isRtl,\r\n  isNarrow,\r\n  isFullscreen,\r\n  isLoadingData,\r\n  display,\r\n  formaterIds,\r\n  type,\r\n  options,\r\n  dataUrl,\r\n}) => (\r\n  <RulesDriver\r\n    data={enhancedData}\r\n    display={display}\r\n    formaterIds={formaterIds}\r\n    type={type}\r\n    options={options}\r\n    sdmxUrl={dataUrl}\r\n    source={{ link: window.location.href }}\r\n    render={({ chartData, chartOptions, properties }) => (\r\n      <div>\r\n        {isLoadingData && (\r\n          <VXLoader\r\n            isNarrow={isNarrow}\r\n            isRtl={isRtl}\r\n            loadingLabel={<FormattedMessage id=\"de.visualisation.data.loading\" />}\r\n            isLarge\r\n          />\r\n        )}\r\n        {!isLoadingData && (\r\n          <React.Fragment>\r\n            <Viewer\r\n              chartData={chartData}\r\n              chartOptions={chartOptions}\r\n              data={data}\r\n              isNarrow={isNarrow}\r\n              isRtl={isRtl}\r\n            />\r\n            <br />\r\n            <Footnotes />\r\n            <div style={{ textAlign: 'right', fontWeight: '300' }}>V1.15</div>\r\n          </React.Fragment>\r\n        )}\r\n      </div>\r\n    )}\r\n  />\r\n);\r\n\r\nMain.propTypes = {\r\n  data: PropTypes.object,\r\n  enhancedData: PropTypes.object,\r\n  display: PropTypes.string,\r\n  formaterIds: PropTypes.object,\r\n  type: PropTypes.string,\r\n  options: PropTypes.object,\r\n  dataUrl: PropTypes.string,\r\n  isNarrow: PropTypes.bool,\r\n  isRtl: PropTypes.bool,\r\n  isLoadingData: PropTypes.bool,\r\n  isFullscreen: PropTypes.bool,\r\n};\r\n\r\nexport default Main;\r\n","import * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport { getDataLimited } from '../../selectors/sdmx';\r\nimport { getLocale, getIsPending } from '../../selectors/app';\r\nimport { getDisplay, getPeriod, getDataquery, getDataflow, getViewer } from '../../selectors/vis';\r\nimport { getDataUrl } from '../../lib/sdmx';\r\nimport { getSdmxAttribute, chartOptions } from '../../lib/settings';\r\nimport Main from './Main';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      isLoadingData: getIsPending('getData'),\r\n      display: getDisplay,\r\n      type: getViewer,\r\n      data: getDataLimited,\r\n      dataflow: getDataflow,\r\n      dataquery: getDataquery,\r\n      locale: getLocale,\r\n      period: getPeriod,\r\n    }),\r\n  ),\r\n  withProps(({ data, dataflow, dataquery, locale, period }) => ({\r\n    dataUrl: getDataUrl({ configArgs: { dataflow, dataquery, locale }, requestArgs: { period } }),\r\n    options: chartOptions,\r\n    formaterIds: {\r\n      decimals: getSdmxAttribute('decimals'),\r\n      prefscale: getSdmxAttribute('prefscale'),\r\n    },\r\n    enhancedData: data,\r\n  })),\r\n)(Main);\r\n\r\n/*\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      isLoadingData: getIsPending('getData'),\r\n      display: getDisplay,\r\n      type: getViewer,\r\n      data: getData,\r\n      dataflow: getDataflow,\r\n      dataquery: getDataquery,\r\n      locale: getLocale,\r\n      period: getPeriod,\r\n    }),\r\n  ),\r\n  withProps(({ data, dataflow, dataquery, locale, period }) => ({\r\n    dataUrl: getDataUrl({ configArgs: { dataflow, dataquery, locale }, requestArgs: { period } }),\r\n    options: chartOptions,\r\n    formaterIds: {\r\n      decimals: getSdmxAttribute('decimals'),\r\n      prefscale: getSdmxAttribute('prefscale'),\r\n    },\r\n    enhancedData: R.over(\r\n      R.lensPath(['structure', 'dimensions', 'observation']),\r\n      //R.append({ id: 'FREQ', values: [{ id: 'A' }] }), is this hardcoded?\r\n      R.append({ id: 'Frequency', values: [{ id: 'Annual' }] }),\r\n      data,\r\n    ),\r\n  })),\r\n)(Main);\r\n*/\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport { Tree } from '@blueprintjs/core';\r\nimport { getSelection } from '../../selectors/sdmx';\r\n\r\nimport { VXFilterContainerCollapsible } from '@sis-cc/dotstatsuite-ui-components';\r\n\r\n//TODO:\r\n//REMOVE HierarchicalCodelist (version1)\r\n//Make the dimension to attach the hierarchy to a param.\r\n//Disable the codes not in the codelist\r\n\r\nclass HierarchicalCodelist extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { expandedNodes: [], isOpen: false };\r\n  }\r\n\r\n  /*This doesn't get called... why?!?*/\r\n  onChangeIsOpen = () => {\r\n    this.setState({ isOpen: !this.state.isOpen });\r\n  };\r\n\r\n  handleNodeExpand = nodeData => {\r\n    nodeData.isExpanded = true;\r\n    this.setState({ expandedNodes: this.state.expandedNodes.concat(nodeData.id) });\r\n  };\r\n  handleNodeCollapse = nodeData => {\r\n    nodeData.isExpanded = false;\r\n\r\n    //this.setState(this.state);\r\n    const newExpanded = [...this.state.expandedNodes];\r\n    const idx = newExpanded.indexOf(nodeData.id);\r\n    if (idx >= 0) newExpanded.splice(idx, 1);\r\n    this.setState({ expandedNodes: newExpanded });\r\n  };\r\n\r\n  handleNodeClick = nodeData => {\r\n    this.props.changeSelection('REF_AREA', nodeData.codeID, this.props.dimensions);\r\n  };\r\n\r\n  expandNodes = (node, toExpand) => {\r\n    if (toExpand.includes(node.id)) {\r\n      node.isExpanded = true;\r\n    }\r\n    if (node.childNodes && node.childNodes.length > 0) {\r\n      node.childNodes.forEach(n => {\r\n        this.expandNodes(n, toExpand);\r\n      });\r\n    }\r\n  };\r\n\r\n  render() {\r\n    //Expand nodes\r\n    if (!this.props.hierarchy) return null;\r\n    if (this.props.hierarchy) {\r\n      this.props.hierarchy.forEach(n => {\r\n        this.expandNodes(n, this.state.expandedNodes);\r\n      });\r\n    }\r\n\r\n    const hierarchyName = this.props.hierarchyName;\r\n    if (hierarchyName == null) return null;\r\n\r\n    if (this.props.isCollapsible) {\r\n      return (\r\n        <div className=\"TableConfig_wrapper\">\r\n          <VXFilterContainerCollapsible\r\n            titleLabel={hierarchyName}\r\n            isOpen={this.state.isOpen}\r\n            noScroll={true}\r\n            onChangeIsOpen={this.onChangeIsOpen}\r\n          >\r\n            <Tree\r\n              className=\"hierarchy_tree\"\r\n              contents={this.props.hierarchy}\r\n              onNodeExpand={this.handleNodeExpand}\r\n              onNodeCollapse={this.handleNodeCollapse}\r\n              onNodeClick={this.handleNodeClick}\r\n            />\r\n          </VXFilterContainerCollapsible>\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"TableConfig_wrapper\">\r\n          {!this.props.isCollapsible && hierarchyName != null && <h6>{hierarchyName}</h6>}\r\n          <Tree\r\n            contents={this.props.hierarchy}\r\n            onNodeExpand={this.handleNodeExpand}\r\n            onNodeCollapse={this.handleNodeCollapse}\r\n            onNodeClick={this.handleNodeClick}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst createTreeNode = (hierarchyNode, selCodes, codesInCodelist, depth = 0) => {\r\n  let isSelCode = false;\r\n  let selCodeParent = false;\r\n  let selCodeCount = 0;\r\n  let inCodelist = false;\r\n  if (selCodes && selCodes.length > 0 && selCodes.includes(hierarchyNode.codeID)) {\r\n    isSelCode = true;\r\n    selCodeParent = true;\r\n    selCodeCount++;\r\n  }\r\n  if (\r\n    codesInCodelist &&\r\n    codesInCodelist.length > 0 &&\r\n    codesInCodelist.includes(hierarchyNode.codeID)\r\n  ) {\r\n    inCodelist = true;\r\n  }\r\n\r\n  let childNodes = null;\r\n  if (hierarchyNode.codes && hierarchyNode.codes.length > 0) {\r\n    childNodes = [];\r\n    hierarchyNode.codes.forEach(c => {\r\n      const ch = createTreeNode(c, selCodes, depth + 1);\r\n      childNodes.push(ch);\r\n      selCodeParent = selCodeParent || ch.selCodeParent;\r\n      selCodeCount = selCodeCount + ch.selCodeCount;\r\n    });\r\n  }\r\n\r\n  const ret = {\r\n    id: hierarchyNode.id,\r\n    codeID: hierarchyNode.codeID,\r\n    label: hierarchyNode.name,\r\n    selCodeParent: selCodeParent,\r\n    selCodeCount: selCodeCount,\r\n\r\n    depth: depth,\r\n  };\r\n\r\n  if (selCodeParent && !isSelCode) {\r\n    ret.secondaryLabel = <span className=\"hier_selChildCount\">{selCodeCount}</span>;\r\n  }\r\n  if (isSelCode) {\r\n    ret.className = 'hier_sel';\r\n  } else {\r\n    ret.className = 'hier_unsel';\r\n  }\r\n  if (childNodes && childNodes.length > 0) {\r\n    ret['childNodes'] = childNodes;\r\n  }\r\n\r\n  return ret;\r\n};\r\n\r\nconst createTreeContents = (hierarchy, selItems, dims) => {\r\n  if (!hierarchy || !hierarchy.hierarchies) return [];\r\n\r\n  //MAKE dimIndex (INDEX) A PARAM\r\n  const dimIndex = 0;\r\n  const selCodes = [];\r\n\r\n  if (selItems && selItems.length > 0) {\r\n    selItems[dimIndex].values.forEach(v => {\r\n      selCodes.push(v.id);\r\n    });\r\n  }\r\n\r\n  const codesInCodelist = [];\r\n  if (dims[dimIndex]) {\r\n    dims[dimIndex].values.forEach(v => {\r\n      codesInCodelist.push(v.id);\r\n    });\r\n  }\r\n\r\n  const ret = [];\r\n  hierarchy.hierarchies.forEach(hi => {\r\n    ret.push(createTreeNode(hi, selCodes, codesInCodelist));\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nHierarchicalCodelist.propTypes = {\r\n  hierarchy: PropTypes.array,\r\n  hierarchyName: PropTypes.string,\r\n  dimensions: PropTypes.array,\r\n  changeSelection: PropTypes.func,\r\n  selItems: PropTypes.array,\r\n  isCollapsible: PropTypes.bool,\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    hierarchy: createTreeContents(state.sdmx.hierarchy, getSelection(state), state.sdmx.dimensions),\r\n    hierarchyName: state.sdmx.hierarchy ? state.sdmx.hierarchy.name : null,\r\n    dimensions: state.sdmx.dimensions,\r\n    selItems: getSelection(state),\r\n  };\r\n};\r\n\r\nfunction mapDispatchToProps(dispatch, props) {\r\n  //return bindActionCreators({incrementValue: incrementValue}, dispatch);\r\n  return {\r\n    changeSelection: (filterId, valueId, dims) =>\r\n      dispatch({\r\n        type: '@@vis/sdmx/CHANGE_DATAQUERY',\r\n        payload: { filterId, valueId, dimensions: dims },\r\n      }),\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(HierarchicalCodelist);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport {\r\n  DELayout,\r\n  DELayoutContent,\r\n  DELayoutSide,\r\n  DELayoutMain,\r\n  VXLoader,\r\n  VXFilterContainerCollapsible,\r\n} from '@sis-cc/dotstatsuite-ui-components';\r\nimport NarrowFilters from '../NarrowFilters';\r\nimport FilterPeriod from '../FilterPeriod';\r\nimport FilterSelection from '../FilterSelection';\r\nimport Filters from '../Filters';\r\nimport TableConfig from '../TableConfig';\r\nimport Main from '../Main';\r\nimport Lastnobs from '../Lastnobs';\r\nimport DataflowNavigator from '../DataflowNavigator';\r\nimport HierarchicalCodelist2 from '../HierarchicalCodelist';\r\nimport { showDataflowNavigator, getStickyDims, getDataflowsOnEvidence } from '../../lib/settings';\r\n\r\nconst App = ({\r\n  isNarrow,\r\n  isRtl,\r\n  isLoadingStructure,\r\n  isLoadingData,\r\n  isFullscreen,\r\n  lastnobs_active,\r\n  viewerId,\r\n}) => (\r\n  <DELayout isNarrow={isNarrow} isRtl={isRtl} isFull={isFullscreen}>\r\n    <DELayoutContent>\r\n      {isLoadingStructure && (\r\n        <VXLoader\r\n          isNarrow={isNarrow}\r\n          isRtl={isRtl}\r\n          loadingLabel={<FormattedMessage id=\"de.visualisation.loading\" />}\r\n          isLarge\r\n        />\r\n      )}\r\n    </DELayoutContent>\r\n    {!isLoadingStructure && (\r\n      <DELayoutSide>\r\n        {isNarrow && (\r\n          <NarrowFilters isNarrow={isNarrow} isRtl={isRtl} lastnobs_active={lastnobs_active} />\r\n        )}\r\n\r\n        {!isNarrow && (\r\n          <div>\r\n            <Lastnobs />\r\n            <div style={lastnobs_active ? { opacity: 0.4, pointerEvents: 'none' } : {}}>\r\n              <FilterPeriod isNarrow={isNarrow} isRtl={isRtl} />\r\n            </div>\r\n            <FilterSelection isNarrow={isNarrow} isRtl={isRtl} />\r\n            <Filters isNarrow={isNarrow} isRtl={isRtl} />\r\n\r\n            <HierarchicalCodelist2 isCollapsible={true} />\r\n\r\n            {viewerId == 'table' && (\r\n              <div className=\"TableConfig_wrapper\">\r\n                <VXFilterContainerCollapsible\r\n                  titleLabel={<FormattedMessage id=\"de.table.layout.title\" />}\r\n                  isOpen={false}\r\n                  noScroll={true}\r\n                >\r\n                  {!isLoadingData && <TableConfig isRtl={isRtl} />}\r\n                </VXFilterContainerCollapsible>\r\n              </div>\r\n            )}\r\n\r\n            {showDataflowNavigator == 1 && (\r\n              <DataflowNavigator\r\n                stickyDims={getStickyDims}\r\n                dataflowsOnEvidence={getDataflowsOnEvidence}\r\n              />\r\n            )}\r\n          </div>\r\n        )}\r\n      </DELayoutSide>\r\n    )}\r\n    {!isLoadingStructure && (\r\n      <DELayoutMain>\r\n        <Main isNarrow={isNarrow} isRtl={isRtl} isFullscreen={isFullscreen} />\r\n      </DELayoutMain>\r\n    )}\r\n  </DELayout>\r\n);\r\n\r\nApp.propTypes = {\r\n  isNarrow: PropTypes.bool,\r\n  isRtl: PropTypes.bool,\r\n  isLoadingStructure: PropTypes.bool,\r\n  isLoadingData: PropTypes.bool,\r\n  isFullscreen: PropTypes.bool,\r\n  lastnobs_active: PropTypes.bool,\r\n  viewerId: PropTypes.string,\r\n};\r\n\r\nexport default App;\r\n","import * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, branch, renderNothing } from 'recompose';\r\nimport { getIsPending, getIsRtl } from '../../selectors/app';\r\nimport { getIsFullscreen, getDataflow, getLastnobservations } from '../../selectors/vis';\r\nimport { getViewer } from '../../selectors/vis';\r\n\r\nimport withResponsiveness from '../../hocs/withResponsiveness';\r\nimport App from './App';\r\n\r\nexport default compose(\r\n  withResponsiveness,\r\n  connect(\r\n    createStructuredSelector({\r\n      isLoadingStructure: getIsPending('getStructure'),\r\n      isLoadingData: getIsPending('getData'),\r\n      isRtl: getIsRtl,\r\n      isFullscreen: getIsFullscreen,\r\n      viewerId: getViewer,\r\n\r\n      dataflow: getDataflow,\r\n      lastnobs_active: getLastnobservations,\r\n      selItems: getSelection,\r\n    }),\r\n  ),\r\n  branch(R.pipe(R.prop('dataflow'), R.isNil), renderNothing),\r\n)(App);\r\n","import React from 'react';\r\nimport { render } from 'react-dom';\r\nimport { Provider } from 'react-redux';\r\nimport '@blueprintjs/core/dist/blueprint.css';\r\nimport { I18nProvider, initialize as initializeI18n } from './i18n';\r\nimport { createStore, reducer } from './core';\r\nimport ThemeProvider from './theme';\r\nimport ErrorBoundary from './components/Error';\r\nimport App from './components/App';\r\nimport { changeDataflow, loadDataflows, loadHierarchy, loadMap } from './ducks/vis';\r\nimport './index.css';\r\nimport meta from '../../package.json';\r\n\r\nvar ES6_Error = false;\r\nif (!(typeof window.ES6_Error === 'undefined')) {\r\n  ES6_Error = window.ES6_Error;\r\n}\r\nif (ES6_Error) {\r\n  throw new Error('Browser not Supported');\r\n}\r\n\r\nconsole.info(`${meta.name}@${meta.version}`); // eslint-disable-line no-console\r\n\r\ninitializeI18n(window.SETTINGS.i18n);\r\nconst locale = window.SETTINGS.i18n.locales[window.SETTINGS.i18n.localeId];\r\n\r\n//Is the lastnobs param active?\r\nlet lnobs = false;\r\nif (window.DATAFLOW.lastnobservations && window.DATAFLOW.lastnobservations > 0) {\r\n  lnobs = true;\r\n}\r\n\r\nconst initialState = {\r\n  app: {\r\n    logs: [],\r\n    pending: {},\r\n    locale,\r\n  },\r\n  vis: {\r\n    filter: undefined, // id of the expanded filter: ''\r\n    viewer: 'table', // id of the viewer element to display\r\n    action: undefined, // id of the current tool action: ''\r\n    period: undefined, // period: [start, end]\r\n    dataflow: undefined, // dataflow identifiers: {datasourceId, dataflowId, agencyId, version}\r\n    isFullscreen: false, // fullscreen mode\r\n    dataquery: undefined, // dataquery: ''\r\n    display: 'label', // sdmx display mode: '' in label, code, both\r\n    timeDimensionInverted: { TIME_PERIOD: true }, // sdmx time direction: obj of bools, true asc - false desc\r\n    layout: undefined, // layout of the table\r\n    dimensionGetter: 'label', // accessor of the dimension for labelling,\r\n    lastnobservations: lnobs, //is the lastnObservation option checked?,\r\n    map: undefined, //the map\r\n    helpUrl: null,\r\n    downloadFullEnabled: '1',\r\n  },\r\n  sdmx: {\r\n    dimensions: [],\r\n    data: undefined,\r\n    layout: {},\r\n    dataflows: {},\r\n    map_selection: {}, //the map selection\r\n  },\r\n};\r\nif (window.SETTINGS.helpUrl) {\r\n  initialState.vis.helpUrl = window.SETTINGS.helpUrl;\r\n}\r\nif (window.SETTINGS.timeDimensionOrder) {\r\n  if (window.SETTINGS.timeDimensionOrder == 'asc') {\r\n    initialState.vis.timeDimensionInverted.TIME_PERIOD = false;\r\n  } else if (window.SETTINGS.timeDimensionOrder == 'desc') {\r\n    initialState.vis.timeDimensionInverted.TIME_PERIOD = true;\r\n  }\r\n}\r\n\r\nif (window.SETTINGS.downloadFullEnabled) {\r\n  initialState.vis.downloadFullEnabled = window.SETTINGS.downloadFullEnabled;\r\n}\r\n\r\nconst store = createStore(initialState, reducer);\r\n\r\nconsole.log('initialized with DATAFLOW:', window.DATAFLOW); // eslint-disable-line no-console\r\nstore.dispatch(changeDataflow(window.DATAFLOW));\r\nif (window.SETTINGS.unicef.showDataflowNavigator) store.dispatch(loadDataflows());\r\n\r\nlet map_dataflow_id = window.DATAFLOW.agencyId + ':' + window.DATAFLOW.dataflowId;\r\nif (\r\n  window.SETTINGS.map &&\r\n  window.SETTINGS.map[map_dataflow_id] &&\r\n  window.SETTINGS.map[map_dataflow_id].geojson_url\r\n) {\r\n  store.dispatch(loadMap(window.SETTINGS.map[map_dataflow_id].geojson_url));\r\n}\r\nif (window.SETTINGS.hierarchy && window.SETTINGS.hierarchy.agencyId) {\r\n  store.dispatch(loadHierarchy(window.SETTINGS, window.DATAFLOW));\r\n}\r\n\r\nconst ROOT = document.getElementById('root');\r\nROOT.addEventListener('unicef_changeDataflow', event =>\r\n  store.dispatch(changeDataflow(event.detail)),\r\n);\r\nconsole.log(`listen unicef_changeDataflow event`); // eslint-disable-line no-console\r\n\r\nrender(\r\n  <ErrorBoundary isFinal>\r\n    <Provider store={store}>\r\n      <ThemeProvider theme={{}} isRtl={locale.isRtl}>\r\n        <I18nProvider localeId={locale.id} messages={window.I18N}>\r\n          <ErrorBoundary>\r\n            <App />\r\n          </ErrorBoundary>\r\n        </I18nProvider>\r\n      </ThemeProvider>\r\n    </Provider>\r\n  </ErrorBoundary>,\r\n  ROOT,\r\n);\r\n","module.exports = __webpack_public_path__ + \"static/media/data-explorer-logo.png\";"],"sourceRoot":""}